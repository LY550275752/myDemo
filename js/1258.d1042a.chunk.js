"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[1258],{91258:(e,o,t)=>{t.r(o),t.d(o,{default:()=>h});var r=t(89810),l=t(36967),s=t(6298),n=t(48402),a=t(73827),i=t(54478),d=t(17999),c=t(5341),u=function(e,o,t,r){return new(t||(t=Promise))((function(l,s){function n(e){try{i(r.next(e))}catch(e){s(e)}}function a(e){try{i(r.throw(e))}catch(e){s(e)}}function i(e){var o;e.done?l(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(n,a)}i((r=r.apply(e,o||[])).next())}))};const p={class:"modify-password"},w={key:0,class:"form-item-label"},m={key:0,class:"form-item-label"},f={class:"password-suggest"},v={key:0,class:"form-item-label"},y={key:1,class:"password-tip"},g=(0,r.defineComponent)({__name:"modifyPassword",props:{isModifyByOld:{type:Boolean,default:!0},sign:{type:String,default:""},phoneOrEmail:{type:String,default:""},accounts:{type:Object,default:null}},emits:["enter"],setup(e,{emit:o}){const t=e,g=(0,c.mL)(),{isForceModify:h}=(0,r.inject)("$options"),k=(0,r.inject)("$dialog"),C=n.nC.get(s.g),P=((0,d.tv)(),(0,r.ref)()),B=(0,r.reactive)({oldPassword:"",newPassword:"",newPasswordCopy:""}),b={oldPassword:[{required:!0,message:"原密码不能为空",trigger:"blur"}],newPassword:[{required:!0,message:"新密码不能为空",trigger:"blur"},{validator:(e,o,t)=>{if(l.ZP.notSelectPassword(o)){var r=V.value.filter((e=>!e.result));r.length>0?t(new Error(r[0].message)):t()}else t(new Error("不能使用该密码"))},trigger:"blur"}],newPasswordCopy:[{required:!0,message:"再次输入新密码",trigger:"blur"},{validator:(e,o,t)=>{o!==B.newPassword?t(new Error("两次密码输入不一致")):t()},trigger:"blur"}]},V=(0,r.ref)([{test:e=>l.ZP.lenRule(e)&&l.ZP.typeRule(e),result:!1,message:"8-26位,必须含有字母、数字和特殊字符"},{test:e=>u(this,void 0,void 0,(function*(){F.value||(F.value=yield C.getAuthProfile());let o=F.value||t.accounts;return!o||l.ZP.notContainerAccount([o.mobilephone,o.userAccount,o.email?o.email.split("@")[0]:""],e)})),result:!1,message:"密码内容不能含有手机号、邮箱和账号"},{test:l.ZP.rowStrRule,result:!1,message:"密码不能使用连续3个及以上键位排序字符，如123，Qwe等"}]);var E=(0,r.ref)(!1),F=(0,r.ref)(null),N=(0,r.ref)(!1);function x(e){if(/[\u4E00-\u9FA5\uFF00-\uFFFF\s]/.test(e))return e=e.replace(/[\uFF00-\uFFFF\u4E00-\u9FA5\s]/g,""),void(B.newPassword=e);V.value.forEach((o=>u(this,void 0,void 0,(function*(){o.result=!!e&&(yield o.test(e))})))),B.newPassword=e}function _(){const e=V.value.every((e=>e.result));N.value=!e}function A(){N.value=!0}function O(){return u(this,void 0,void 0,(function*(){P.value&&(yield P.value.validate(((e,o)=>u(this,void 0,void 0,(function*(){if(e)try{E.value=!0;(t.isModifyByOld||h?yield function(){return u(this,void 0,void 0,(function*(){try{const e={userAccount:"",password:(0,i.JQ)(B.oldPassword),newEncPwd1:(0,i.FB)(B.newPasswordCopy),newEncPwd2:(0,i.JQ)(B.newPasswordCopy)};F.value&&(e.userAccount=F.value.userAccount);yield C.resetPassword(e);return k.closeCurrent(),C.logout(),!0}catch(e){return a.z8.error(e.message),!1}}))}():yield function(){return u(this,void 0,void 0,(function*(){try{if(!t.sign||!t.phoneOrEmail)return void a.z8.error("请进行身份验证");const e="string"==typeof t.phoneOrEmail,o={emailAddress:e?t.phoneOrEmail:void 0,mobilePhone:e?void 0:t.phoneOrEmail,sign:t.sign,encPwd1:(0,i.FB)(B.newPasswordCopy),encPwd2:(0,i.JQ)(B.newPasswordCopy)};return yield C.forgetPassword(o),k.closeAll(),!0}catch(e){return a.z8.error(e.message),!1}}))}())&&a.z8.success("修改密码成功")}catch(e){}finally{E.value=!1}})))))}))}return(0,r.onMounted)((()=>{(0,r.nextTick)((()=>u(this,void 0,void 0,(function*(){var e=k.getCurrentDialogId(),r={title:(t.isModifyByOld?"修改":"忘记密码-设置新")+"密码",drawable:!1};h?r.onBack=null:t.isModifyByOld?r.onBack=()=>{o("enter")}:r.onBack=null,k.config(e,r),F.value=yield C.getAuthProfile()}))))})),(o,t)=>{const l=(0,r.resolveComponent)("el-input"),s=(0,r.resolveComponent)("el-form-item"),n=(0,r.resolveComponent)("circle-check"),a=(0,r.resolveComponent)("el-icon"),i=(0,r.resolveComponent)("circle-close"),d=(0,r.resolveComponent)("el-popover"),c=(0,r.resolveComponent)("el-button"),u=(0,r.resolveComponent)("el-form");return(0,r.openBlock)(),(0,r.createElementBlock)("div",p,[(0,r.createVNode)(u,{model:B,rules:b,"label-width":"0",ref_key:"passwordForm",ref:P},{default:(0,r.withCtx)((()=>[e.isModifyByOld?((0,r.openBlock)(),(0,r.createBlock)(s,{key:0,class:"form-item",prop:"oldPassword"},{default:(0,r.withCtx)((()=>[(0,r.unref)(g)?((0,r.openBlock)(),(0,r.createElementBlock)("label",w,"原密码")):(0,r.createCommentVNode)("",!0),(0,r.createVNode)(l,{size:"large",modelValue:B.oldPassword,"onUpdate:modelValue":t[0]||(t[0]=e=>B.oldPassword=e),placeholder:"请输入原密码",type:"password","show-password":""},null,8,["modelValue"])])),_:1})):(0,r.createCommentVNode)("",!0),(0,r.createVNode)(s,{class:"form-item",prop:"newPassword","show-message":!1},{default:(0,r.withCtx)((()=>[(0,r.unref)(g)?((0,r.openBlock)(),(0,r.createElementBlock)("label",m,"新密码")):(0,r.createCommentVNode)("",!0),(0,r.createVNode)(d,{placement:"right",width:"318",visible:(0,r.unref)(N),"onUpdate:visible":t[1]||(t[1]=e=>(0,r.isRef)(N)?N.value=e:N=e)},{reference:(0,r.withCtx)((()=>[(0,r.createVNode)(l,{"model-value":B.newPassword,onInput:x,onFocus:A,onBlur:_,maxlength:"26",size:"large",placeholder:"请输入新的密码",type:"password","show-password":""},null,8,["model-value"])])),default:(0,r.withCtx)((()=>[(0,r.createElementVNode)("ul",f,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(V.value,((e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("li",{key:o},[e.result?((0,r.openBlock)(),(0,r.createBlock)(a,{key:0,class:"password-suggest--check"},{default:(0,r.withCtx)((()=>[(0,r.createVNode)(n)])),_:1})):((0,r.openBlock)(),(0,r.createBlock)(a,{key:1,class:"password-suggest--close"},{default:(0,r.withCtx)((()=>[(0,r.createVNode)(i)])),_:1})),(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(e.message),1)])))),128))])])),_:1},8,["visible"])])),_:1}),(0,r.createVNode)(s,{class:"form-item",prop:"newPasswordCopy"},{default:(0,r.withCtx)((()=>[(0,r.unref)(g)?((0,r.openBlock)(),(0,r.createElementBlock)("label",v,"再次输入")):(0,r.createCommentVNode)("",!0),(0,r.createVNode)(l,{maxlength:"26",size:"large",modelValue:B.newPasswordCopy,"onUpdate:modelValue":t[2]||(t[2]=e=>B.newPasswordCopy=e),placeholder:"再次输入新密码",onKeyup:(0,r.withKeys)(O,["enter"]),type:"password","show-password":""},null,8,["modelValue","onKeyup"])])),_:1}),(0,r.unref)(g)?((0,r.openBlock)(),(0,r.createElementBlock)("p",y," 8-20位大小写字母、数字或符号、须同时包含字母和数字")):(0,r.createCommentVNode)("",!0),(0,r.createVNode)(s,null,{default:(0,r.withCtx)((()=>[(0,r.createVNode)(c,{loading:(0,r.unref)(E),disabled:(0,r.unref)(E),class:"submit",type:"primary",onClick:O},{default:(0,r.withCtx)((()=>[(0,r.createTextVNode)("重置密码")])),_:1},8,["loading","disabled"])])),_:1})])),_:1},8,["model"])])}}});const h=(0,t(57775).Z)(g,[["__scopeId","data-v-fa32d3c0"]])}}]);