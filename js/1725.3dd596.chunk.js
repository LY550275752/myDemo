"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[1725],{99465:(e,t,s)=>{function i(e,t,s){return i=(i,a)=>{const n=`$debounce$${a}`,o=`$debounce$result$${a}`;return function(...a){this[o]||(this[o]=s?s():void 0),clearTimeout(this[n]),t&&(this[o]=t(this[o],...a),a=[this[o]]),this[n]=setTimeout((()=>{i.apply(this,a),this[o]=s?s():void 0}),e)}},(e,t,s)=>{let a=null,n=null;if("function"==typeof s.value?(a="value",n=s.value):"function"==typeof s.get&&(a="get",n=s.get),!n)throw new Error("not supported");a&&(s[a]=i(n,t))};var i}s.d(t,{Ds:()=>i})},1725:(e,t,s)=>{s.d(t,{tM:()=>d,g0:()=>r,pX:()=>C,Vh:()=>a});var i=s(48402);Symbol("MessageCenter");var a,n,o,r,d,g;!function(e){e.MESSAGE_CENTER="1",e.REPORT="2"}(a||(a={})),function(e){e.DESK_LIST="1",e.PROFILE_REP="2",e.TOOLBAR_REP="4"}(n||(n={})),function(e){e[e.CARD=0]="CARD",e[e.DIALOG=1]="DIALOG",e[e["APP-DESKTOP"]=2]="APP-DESKTOP",e[e["APP-MAIN"]=3]="APP-MAIN"}(o||(o={})),function(e){e[e.CARD=0]="CARD",e[e.BUTTON=1]="BUTTON"}(r||(r={})),function(e){e["OPEN-DESKTOP-DIALOG"]="openDesktopDialog",e["SEND-ACTION-TO-AGENT"]="sendActionToAgent",e["EMPTY-COMMAND"]="emptyCommand",e["OPEN-WEB-DIALOG"]="openWebDialog"}(d||(d={})),function(e){e[e["APP-START-SEUCESS"]=2]="APP-START-SEUCESS",e[e["APP-STRATING"]=1]="APP-STRATING",e[e["APP-WINDOWS-ERROR"]=105]="APP-WINDOWS-ERROR",e[e["APP-START-ERROR"]=104]="APP-START-ERROR",e[e["APP-START-FAILED"]=103]="APP-START-FAILED",e[e["APP-NOT-FOUND"]=102]="APP-NOT-FOUND",e[e["PARAM-ERROR"]=101]="PARAM-ERROR"}(g||(g={}));var h,c,p,u,l,f,v=s(74178),m=s(6298),A=s(59927),M=s(19816),I=s(88538),L=s(92720),y=s(73827),E=s(86756),T=s(99465),R=s(14334),D=s(6522),S=s(55304),b=s(88533),P=function(e,t,s,i){var a,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(a=e[r])&&(o=(n<3?a(o):n>3?a(t,s,o):a(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},N=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};let C=class{constructor(e,t,s,i,a,n){this.request=e,this.database=t,this.auth=s,this.clink=i,this.env=a,this.desktop=n,this.appList=[],this.basicAgentMessageList=[],this.advancedAgentMessageList=[],this.remoteMessageList=[],this._onMessageCenterSettingUpdate=v.ju.createEmitter(),this.onMessageCenterSettingUpdate=v.ju.createEmitterListener(this._onMessageCenterSettingUpdate),this._onFunctionBarStatusChange=v.ju.createEmitter(),this.onFunctionBarStatusChange=v.ju.createEmitterListener(this._onFunctionBarStatusChange),this._onToolbarStatusChange=v.ju.createEmitter(),this.onToolbarStatusChange=v.ju.createEmitterListener(this._onToolbarStatusChange),this._onReloadDataInFrame=v.ju.createEmitter(),this.onReloadDataInFrame=v.ju.createEmitterListener(this._onReloadDataInFrame),this._onActionToAgent=v.ju.createEmitter(),this.onActionToAgent=v.ju.createEmitterListener(this._onActionToAgent);this.auth.getAuthProfile();this.registerListeners()}get location(){return this.desktop.activeConnection?"desktop":"main"}get appIdCanPlayBeep(){var e=[];return this.appList.forEach((t=>{!0===t.setting.isShowInMessageCenter&&!1===t.setting.isSilence&&!0===t.setting.isBeep&&e.push(t.appId)})),e}get appIdShowInMessageCenter(){var e=[];return this.appList.forEach((t=>{!0===t.setting.isShowInMessageCenter&&e.push(t.appId)})),e}get appIdCanNotify(){var e=[];return this.appList.forEach((t=>{!1===t.setting.isSilence&&!0===t.setting.isShowInMessageCenter&&e.push(t.appId)})),e}registerListeners(){}resetData(){this.basicAgentMessageList=[],this.advancedAgentMessageList=[],this.remoteMessageList=[]}initAppList(){return N(this,void 0,void 0,(function*(){if(!(yield this.auth.getAuthProfile()))return;this.appList=[];const e=yield this.request.api({url:"api/cdserv/client/message/apps",method:"get"});var t=e.data?e.data:[],s=t.length;for(let e=0;e<s;e++){let s=yield this.getAppById(t[e].appId);s&&s.setting?t[e].setting=s.setting:t[e].setting={isShowInMessageCenter:!0,isSilence:!1,isBeep:!0},t[e].iconUrl=yield this.getAppIcon(t[e].appId)}this.updateAppList(t,!1),this.appList=(0,L.cloneDeep)(t),M.k.info("[message-center]:应用列表",this.appList)}))}getAppIcon(e){return N(this,void 0,void 0,(function*(){let t=yield this.request.api({method:"GET",url:`/api/cdserv/client/message/app/icon/${e}`,responseType:"blob"});return URL.createObjectURL(new Blob([t.data],{type:"image/jpeg"}))}))}updateNotificationMode(e){return N(this,void 0,void 0,(function*(){const t=`${(yield this.auth.getAuthProfile()).userAccount}_notificationMode`;yield this.database.update(t,e)}))}getNotificationMode(){return N(this,void 0,void 0,(function*(){const e=`${(yield this.auth.getAuthProfile()).userAccount}_notificationMode`;return yield this.database.find(e)}))}getAllApp(){return N(this,void 0,void 0,(function*(){const e=`${(yield this.auth.getAuthProfile()).userAccount}_apps`,t=yield this.database.find(e);return t||[]}))}getAppById(e){return N(this,void 0,void 0,(function*(){return(yield this.getAllApp()).find((t=>t.appId===e))}))}updateApp(e){return N(this,void 0,void 0,(function*(){const t=yield this.getAllApp();t.forEach((t=>{t.appId===e.appId&&(t.setting=e.setting)})),this.appList=(0,L.cloneDeep)(t),this.updateAppList(t,!0)}))}updateAppList(e,t){return N(this,void 0,void 0,(function*(){const s=`${(yield this.auth.getAuthProfile()).userAccount}_apps`;this.database.update(s,e),t&&this.emitEvent()}))}getAllMsgId(){return N(this,void 0,void 0,(function*(){const e=`${(yield this.auth.getAuthProfile()).userAccount}_msgId`,t=yield this.database.find(e);return t||[]}))}saveToMsgIdTable(e){return N(this,void 0,void 0,(function*(){const t=`${(yield this.auth.getAuthProfile()).userAccount}_msgId`;var s=yield this.getAllMsgId();s.push(e),yield this.database.update(t,s)}))}getIsNotified(e){return N(this,void 0,void 0,(function*(){return(yield this.getAllMsgId()).includes(e)}))}getAllIgnoredMsgId(){return N(this,void 0,void 0,(function*(){const e=`${(yield this.auth.getAuthProfile()).userAccount}_ignoredMsgId`;var t=yield this.database.find(e);return null===t?[]:t}))}saveIgnoredMsgId(e){return N(this,void 0,void 0,(function*(){const t=`${(yield this.auth.getAuthProfile()).userAccount}_ignoredMsgId`;var s=yield this.getAllIgnoredMsgId();s.push(e),yield this.database.insert(t,s)}))}getIsIgnored(e){return N(this,void 0,void 0,(function*(){return(yield this.getAllIgnoredMsgId()).includes(e)}))}handleAppMessageDelete(e){return N(this,void 0,void 0,(function*(){if(M.k.info("[message-center]:删除应用消息",e),this.basicAgentMessageList=this.basicAgentMessageList.filter((t=>t.appId!==e)),this.advancedAgentMessageList=this.advancedAgentMessageList.filter((t=>t.appId!==e)),this.remoteMessageList.length>0){var t=[];this.remoteMessageList.forEach((s=>N(this,void 0,void 0,(function*(){s.appId===e&&t.push(s.msgId),30===t.length&&(yield this.toReadMessage(t.join(",")),t=[])})))),t.length>0&&this.toReadMessage(t.join(","))}else this.emitEvent()}))}handleMessageDelete(e){e.agentMsgId?(M.k.info("[message-center]:删除agent消息",e.agentMsgId),this.basicAgentMessageList=this.basicAgentMessageList.filter((t=>t.agentMsgId!==e.agentMsgId)),this.advancedAgentMessageList=this.advancedAgentMessageList.filter((t=>t.agentMsgId!==e.agentMsgId))):(M.k.info("[message-center]:删除业管消息",e.msgId),this.toReadMessage(e.msgId.toString())),this.emitEvent()}handleReadAllAnnouncement(){M.k.info("[message-center]:已读所有公告");var e=this.remoteMessageList.filter((e=>1===e.source&&0===e.haveRead));if(0!==e.length){var t=[];e.forEach((e=>{e.haveRead=1,t.push(e.msgId),30===t.length&&(this.toReadMessage(t.join(",")),t=[])})),t.length>0&&this.toReadMessage(t.join(",")),this.remoteMessageList.forEach((e=>{1===e.source&&0===e.haveRead&&(e.haveRead=1)}))}}handleDeleteAllAppMessage(){if(M.k.info("[message-center]:删除所有应用消息"),this.basicAgentMessageList=[],this.advancedAgentMessageList=[],this.remoteMessageList.length>0){var e=[];this.remoteMessageList.forEach((t=>{3===t.source&&(e.push(t.msgId),30===e.length&&(this.toReadMessage(e.join(",")),e=[]))})),e.length>0&&this.toReadMessage(e.join(",")),this.remoteMessageList=this.remoteMessageList.filter((e=>3!==e.source))}this.emitEvent()}handleReadSingleMessage(e){return N(this,void 0,void 0,(function*(){e.agentMsgId?(this.basicAgentMessageList=this.basicAgentMessageList.filter((t=>t.agentMsgId!==e.agentMsgId)),this.advancedAgentMessageList=this.advancedAgentMessageList.filter((t=>t.agentMsgId!==e.agentMsgId)),this.emitEvent()):0===e.haveRead&&(yield this.toReadMessage(e.msgId.toString()))}))}initAnnouncementList(){var e=[],t=[];return this.remoteMessageList.forEach((s=>{1===s.source&&(e.push(s),t.push(s.msgId))})),e=e.sort(((e,t)=>t.validTime-e.validTime||t.msgId-e.msgId)),M.k.info("[message-center]:公告id列表",t),e}initMessageListOfApp(){return N(this,void 0,void 0,(function*(){var e=[],t=this.remoteMessageList.filter((e=>3===e.source&&this.appIdShowInMessageCenter.includes(e.appId)));for(let n=0;n<this.appList.length;n++){var s=t.filter((e=>e.appId===this.appList[n].appId));if("desktop"===this.location){var i=this.basicAgentMessageList.filter((e=>e.appId===this.appList[n].appId)),a=this.advancedAgentMessageList.filter((e=>e.appId===this.appList[n].appId));s=s.concat(i,a)}if(s.length>0){let t={validTime:(s=s.sort(((e,t)=>t.validTime-e.validTime)))[0].validTime,messageList:s,source:3,app:this.appList[n]};e.push(t)}}return e=e.sort(((e,t)=>t.validTime-e.validTime))}))}initDataInNewMessage(){return N(this,void 0,void 0,(function*(){var e=[];return this.appList.forEach((t=>{let s=[];if(this.remoteMessageList.forEach((e=>N(this,void 0,void 0,(function*(){3===e.source&&e.appId===t.appId&&t.setting.isShowInMessageCenter&&s.push(e)})))),this.basicAgentMessageList.forEach((e=>{e.appId===t.appId&&t.setting.isShowInMessageCenter&&s.push(e)})),this.advancedAgentMessageList.forEach((e=>{e.appId===t.appId&&t.setting.isShowInMessageCenter&&s.push(e)})),s.length>0){s=s.sort(((e,t)=>t.validTime-e.validTime));let i={validTime:s[0].validTime,msgId:s[0].msgId||s[0].agentMsgId,messageList:s,source:3,app:t};e.push(i)}})),this.remoteMessageList.forEach((t=>{1===t.source&&0===t.haveRead&&e.push(t)})),e=e.sort(((e,t)=>t.validTime-e.validTime||t.msgId-e.msgId))}))}onAgentMessageReceive(e){return N(this,void 0,void 0,(function*(){switch(e.msgType){case 1:var t=e.msgData;this.basicAgentMessageList=this.basicAgentMessageList.filter((e=>e.agentMsgId!==t.agentMsgId));const i=yield this.getAppById(t.appId);i&&(t.appData=i),this.basicAgentMessageList.push(t);break;case 2:var s=e.msgData;this.advancedAgentMessageList=this.advancedAgentMessageList.filter((e=>e.agentMsgId!==s.agentMsgId)),this.advancedAgentMessageList.push(s);const a=yield this.getAppById(s.appId);a&&(s.appData=a)}this.appIdCanNotify.includes(e.msgData.appId)&&this.handleAgentMessage(),this.emitEvent()}))}handleMessageAction(e,t,s){return N(this,void 0,void 0,(function*(){try{switch(e.command){case d["OPEN-DESKTOP-DIALOG"]:this.openMessageDetail({data:t,source:a.MESSAGE_CENTER});break;case d["OPEN-WEB-DIALOG"]:this.handleWebAction(e,{appId:t.appId,msgId:t.msgId},"message");break;case d["SEND-ACTION-TO-AGENT"]:if("main"===this.location)return y.z8.info("请前往虚机内操作"),void(s&&s());this.handleAgentAction(e,{msgId:t.msgId,appId:t.appId},s);break;case d["EMPTY-COMMAND"]:t.msgId&&this.toReadMessage(t.msgId.toString())}}catch(e){M.k.error(e)}}))}handleAgentMessageAction(e){return N(this,void 0,void 0,(function*(){if(this.basicAgentMessageList.findIndex((t=>t.agentMsgId===e.agentMsgId))>-1)this.openMessageDetail({data:e,source:a.MESSAGE_CENTER});else{const s=yield this.getAppById(e.appId),i=(yield this.saveTemporary({data:JSON.stringify(e.agentDataXfer)})).data;if(s){var t=yield this.handleWebUrl(e.detailUrl,s.appCode);t=`${t}?detailId=${i}`,this.openWebDialog(t,s.appName)}setTimeout((()=>{this.advancedAgentMessageList=this.advancedAgentMessageList.filter((t=>t.agentMsgId!==e.agentMsgId)),this.emitEvent()}),400)}}))}handleAppAction(e,t){return N(this,void 0,void 0,(function*(){M.k.info("[message-center]处理应用动作",e,t);try{switch(e.command){case d["OPEN-WEB-DIALOG"]:this.handleWebAction(e,{appId:t.appId},"app");break;case d["SEND-ACTION-TO-AGENT"]:if("main"===this.location)return void y.z8.info("请前往云电脑内操作");this.handleAgentAction(e,{appId:t.appId})}}catch(e){M.k.error(e)}}))}handleAgentAction(e,t,s){return N(this,void 0,void 0,(function*(){const i=e.body?JSON.parse(e.body):{},a=i.timeout?i.timeout:5e3,n={type:"sendActionToAgent",data:Object.assign(Object.assign({},t),{reqData:i}),timeout:a};return new Promise((()=>{this.clink.whenAgentConnected().then((()=>{var e=e=>{this.handleActionResponse(e)};s?this._onActionToAgent.fire(n,e):this._onActionToAgent.fire(n,e,s)}))}))}))}handleActionResponse(e){return N(this,void 0,void 0,(function*(){M.k.info("[message-center]:agent回复",e);const t=yield this.getAppById(e.appId),s=t?t.appName:"应用程序";var i="";switch(e.rspData.code){case g["APP-START-SEUCESS"]:b.$x.emit(b.eM.CLOSE_ALL_DIALOG),e.msgId&&(yield this.toReadMessage(e.msgId.toString()));break;case g["APP-START-FAILED"]:case g["PARAM-ERROR"]:case g["APP-WINDOWS-ERROR"]:case g["APP-START-ERROR"]:i=`${s}打开失败(代码${e.rspData.code})`;break;case g["APP-NOT-FOUND"]:i=`未找到${s}`}i.length>0&&E.T.confirm(i,"提示",{showCancelButton:!1,confirmButtonText:"确定",type:"warning"})}))}handleWebAction(e,t,s){return N(this,void 0,void 0,(function*(){if(e.body&&e.body.length>0){const s=JSON.parse(e.body);var{url:i,windowName:a,width:n,height:o}=s;if(i){const e=yield this.getAppById(t.appId);e&&(i=yield this.handleWebUrl(i,e.appCode),this.openWebDialog(i,a,n,o))}}"message"===s&&t.msgId&&(yield this.toReadMessage(t.msgId.toString()))}))}handleWebUrl(e,t){return N(this,void 0,void 0,(function*(){if(e.startsWith("http"))return e;{const a=yield this.getAppBasicUrl(t);if(200===a.status)return`${a.data.webForwardUrl}${e}`;{const t=yield this.request.getHost();var s=new URL(t),i=yield this.getPort();return`${s.protocol}//${s.hostname}:${i}${e}`}}}))}getPort(){return N(this,void 0,void 0,(function*(){const e="9500",t="443",s="1443",i="443";if((yield this.request.getDirectConfig()).active)return i;var a="";switch(this.env.getRegion()){case"guizhou":a=e;break;case"guangdong":a=t;case"guangzhou":a=s;break;default:a="443"}return a}))}closeWebDialog(){b.$x.emit(b.eM.CLOSE_DIALOG,"webview")}openWebDialog(e,t,s,i){M.k.info("[message-center]:web url",e),this.closeWebDialog(),b.$x.emit(b.eM.OPEN_DIALOG,{name:"webview",options:{params:{url:e,isMain:!0},title:t,width:s||560,height:i||560}})}openMessageDetail(e){this.handleReadSingleMessage(e.data),b.$x.emit(b.eM.OPEN_DIALOG,{name:"messageDetail",options:{params:e}})}openMessageDetailTest(e){b.$x.emit(b.eM.OPEN_DIALOG,{name:"messageDetail",options:{params:e}})}handleAgentMessage(){return N(this,void 0,void 0,(function*(){var e=[];this.basicAgentMessageList.forEach((t=>N(this,void 0,void 0,(function*(){e.push(t)})))),this.advancedAgentMessageList.forEach((t=>N(this,void 0,void 0,(function*(){e.push(t)})))),e.length>0&&this.handleNotify()}))}handleRequestMessage(e){return N(this,void 0,void 0,(function*(){}))}handleCommonMessage(e){return N(this,void 0,void 0,(function*(){if(0===this.remoteMessageList.length)return;var e=[];let t=this.remoteMessageList.length;for(let i=0;i<t;i++){var s=this.remoteMessageList[i];(yield this.getIsNotified(s.msgId))||((3===s.source&&this.appIdCanNotify.includes(s.appId)||1===s.source)&&e.push(s),this.saveToMsgIdTable(s.msgId))}e.length>0&&this.handleNotify()}))}handleAlertMessage(){if(0!==this.remoteMessageList.length){var e=[];if(this.remoteMessageList.forEach((t=>N(this,void 0,void 0,(function*(){(yield this.getIsNotified(t.msgId))||1===t.source&&1===t.alertPopup&&("desktop"===this.location||"main"===this.location&&t.extraShowScenarios.includes(n.DESK_LIST))&&e.push(t)})))),e.length>0){const t=(e=e.sort(((e,t)=>t.msgId-e.msgId)))[0];this.openMessageDetail({data:t,source:a.MESSAGE_CENTER})}}}getUnreadMessage(){var e=[];return this.remoteMessageList.forEach((t=>{0===t.haveRead&&e.push(t)})),this.basicAgentMessageList.forEach((t=>N(this,void 0,void 0,(function*(){e.push(t)})))),this.advancedAgentMessageList.forEach((t=>N(this,void 0,void 0,(function*(){e.push(t)})))),e}getRemoteMessageList(){return N(this,void 0,void 0,(function*(){var e=yield this.getMessageFromRequest({pageSize:1e6,requireForceMsgDesktopIds:[],notDetailsMsgIds:[]});this.remoteMessageList=e&&e.data?e.data.list:[];var t=yield this.getAllApp();this.remoteMessageList.forEach((e=>{if(3===e.source){var s=t.find((t=>t.appId===e.appId));s&&(e.appData=s)}})),this.emitEvent()}))}handleNotify(){return N(this,void 0,void 0,(function*(){var e=this.getUnreadMessage();const t=yield this.getDesktopMode();if(0!==e.length&&!t){var s=e.filter((e=>1===e.source||this.appIdCanNotify.includes(e.appId))),i=!1;s.length>1&&(i=!0);var a=!1;if(s.forEach((e=>{(e.source&&1===e.source||e.appData&&e.appData.setting&&e.appData.setting.isBeep)&&(a=!0)})),s.length>0){M.k.info("[message-center]:fianlNotifyList",s);var n=(s=s.sort(((e,t)=>e.msgId&&t.msgId?t.validTime-e.validTime||t.msgId-e.msgId:t.validTime-e.validTime)))[0];b.$x.emit(b.eM.MESSAGE_NOTIFY,{message:n,unreadBtn:i,beep:a})}}}))}checkAlertMessage(e){return N(this,void 0,void 0,(function*(){yield this.getRemoteMessageList();var t=(0,L.cloneDeep)(this.remoteMessageList);if((t=t.filter((e=>1===e.alertPopup))).length>0){const s=(t=t.sort(((e,t)=>t.validTime-e.validTime||t.msgId-e.msgId)))[0];!(yield this.getIsIgnored(s.msgId))&&s.extraShowScenarios.includes(e)&&this.openMessageDetail({data:s,source:a.REPORT})}}))}checkToolbar(){return N(this,void 0,void 0,(function*(){"main"!==this.location&&(this.remoteMessageList.filter((e=>0===e.haveRead)).concat(this.basicAgentMessageList,this.advancedAgentMessageList).filter((e=>this.appIdShowInMessageCenter.includes(e.appId)||1===e.source)).length>0?this._onToolbarStatusChange.fire(!0):this._onToolbarStatusChange.fire(!1))}))}checkFunctionBar(){return N(this,void 0,void 0,(function*(){"desktop"!==this.location&&(this.remoteMessageList.filter((e=>0===e.haveRead&&(this.appIdShowInMessageCenter.includes(e.appId)||1===e.source))).length>0?this._onFunctionBarStatusChange.fire(!0):this._onFunctionBarStatusChange.fire(!1))}))}emitEvent(){this.checkFunctionBar(),this.checkToolbar(),this._onReloadDataInFrame.fire(),this._onMessageCenterSettingUpdate.fire()}getDesktopMode(){return N(this,void 0,void 0,(function*(){const e=yield this.getNotificationMode();if(e)return e.isQuiteMode;{const e={isQuiteMode:!1};this.updateNotificationMode(e)}return!1}))}formatTime(e){function t(e){return(1==String(e).length?"0":"")+e}var s=(new Date).getTime(),i=(s-e)/1e3,a=new Date(s),n=new Date(e),o=n.getFullYear(),r=n.getMonth()+1,d=n.getDate(),g=n.getHours(),h=n.getMinutes();n.getSeconds();if(i<60)return"刚刚";if(i<3600)return Math.floor(i/60)+"分钟前";if(a.getFullYear()==o&&a.getMonth()+1==r&&a.getDate()==d)return"今天"+t(g)+":"+t(h);var c=new Date(s-864e5);return c.getFullYear()==o&&c.getMonth()+1==r&&c.getDate()==d?"昨天"+t(g)+":"+t(h):a.getFullYear()==o?t(r)+"月"+t(d)+"日 "+t(g)+":"+t(h):o+"年"+t(r)+"月"+t(d)+"日 "+t(g)+":"+t(h)}getMessageFromRequest(e){return N(this,void 0,void 0,(function*(){if("main"===this.location){let t=yield this.desktop.getDesktopList(),s=[];t.forEach((e=>{e.objType===S.Bt.NORMAL&&s.push(e.desktopId)})),e.requireForceMsgDesktopIds=s}return yield this.request.api({url:"api/cdserv/client/msgcenter/page",headers:{"Content-Type":"application/json"},method:"post",data:e})}))}toReadMessage(e){return N(this,void 0,void 0,(function*(){if(0===e.length)return;const t=yield this.request.api({url:`/api/cdserv/client/msgcenter/readAck?msgId=${e}`,method:"get"});var s=e.split(","),i=[];return this.remoteMessageList.forEach((e=>{3!==e.source&&1!==e.source||s.includes(e.msgId.toString())?1===e.source&&s.includes(e.msgId.toString())&&(e.haveRead=1,i.push(e)):i.push(e)})),this.remoteMessageList=i,this.emitEvent(),t}))}saveTemporary(e){return N(this,void 0,void 0,(function*(){return yield this.request.api({url:"/api/cdserv/client/msgcenter/thirdPartyData/saveTemporary",method:"post",data:e})}))}getAppBasicUrl(e){return N(this,void 0,void 0,(function*(){const t=`/api/cdserv/client/getThirdPartyRelatedUrlConf?code=${e}`;return yield this.request.api({url:t,method:"get"})}))}};P([(0,T.Ds)(1e3),O("design:type",Function),O("design:paramtypes",[]),O("design:returntype",Promise)],C.prototype,"handleAgentMessage",null),P([(0,T.Ds)(1e3),O("design:type",Function),O("design:paramtypes",[Boolean]),O("design:returntype",Promise)],C.prototype,"handleRequestMessage",null),C=P([(0,i.Xn)(),O("design:paramtypes",["function"==typeof(h=void 0!==I.cf&&I.cf)?h:Object,"function"==typeof(c=void 0!==A.v&&A.v)?c:Object,"function"==typeof(p=void 0!==m.g&&m.g)?p:Object,"function"==typeof(u=void 0!==R.WY&&R.WY)?u:Object,"function"==typeof(l=void 0!==D.Xb&&D.Xb)?l:Object,"function"==typeof(f=void 0!==S.hD&&S.hD)?f:Object])],C)}}]);