(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[2695],{77140:e=>{e.exports="object"==typeof self?self.FormData:window.FormData},51882:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var o=i(48402),n=i(44876);function r(){return o.nC.get(n.yG)}},44876:(e,t,i)=>{"use strict";i.d(t,{yG:()=>b});var o,n,r,a=i(48402),s=i(88538),d=i(52134),l=i(59927),u=i(19816),c=i(77140),p=i(6298),h=i(54478),f=i(47690),v=i.n(f),m=function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function a(e){try{d(o.next(e))}catch(e){r(e)}}function s(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((o=o.apply(e,t||[])).next())}))};let b=class{constructor(e,t,i){this.request=e,this.auth=t,this.database=i,this.ack="QDE5LXl1bmRpYW5uYW8=Q0xPVURfREVTS1RPUC0y",this.reportUser=null,this.table="reporter",this.reportPhones="reportPhones",this.reportEmails="reportEmails",this.reportContacts="reportContacts"}getAllReportUsers(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.table)}))}getAllReportPhones(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportPhones)}))}getAllReportEmails(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportEmails)}))}getAllReportContacts(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportContacts)}))}saveReportUser(e){return g(this,void 0,void 0,(function*(){if(!e||!e.username)return;u.k.info("save report user: ",e.username);const t=yield this.database.find(this.table);let i={[e.username]:e};t&&(i=Object.assign(t,i)),this.database.update(this.table,i)}))}saveReportContact(e){return g(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report contact: ",e);let t=yield this.database.find(this.reportContacts);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportContacts,t)}))}saveReportPhone(e){return g(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report phone: ",e);let t=yield this.database.find(this.reportPhones);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportPhones,t)}))}saveReportEmail(e){return g(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report email: ",e);let t=yield this.database.find(this.reportEmails);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportEmails,t)}))}removeReportUser(e){return g(this,void 0,void 0,(function*(){u.k.info("remove report user: ",e);let t=yield this.database.find(this.table);t&&(delete t[e],this.database.update(this.table,t))}))}removeReportContact(e){return g(this,void 0,void 0,(function*(){u.k.info("remove report contact: ",e);let t=yield this.database.find(this.reportContacts);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportContacts,t)}}))}removeReportPhone(e){return g(this,void 0,void 0,(function*(){u.k.info("remove report phone: ",e);let t=yield this.database.find(this.reportPhones);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportPhones,t)}}))}removeReportEmail(e){return g(this,void 0,void 0,(function*(){u.k.info("remove report email: ",e);let t=yield this.database.find(this.reportEmails);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportEmails,t)}}))}uploadReportImage(e){return g(this,void 0,void 0,(function*(){u.k.info("upload report image: ",e.files.path);let t=this.auth.getAuthProfile();const i=new c,o=Date.now();let n={appInfo:{appId:d.kJ,operStaff:d.eW,orgId:d.TY,sign:"",tenantId:(null==t?void 0:t.tenantId)||-2,timeStamp:o}};n.appInfo.sign=(0,d.gw)(o,d.eW,n.appInfo.tenantId);for(let e in n.appInfo)i.append(e,n.appInfo[e]);i.append("files",null,{filename:e.files.name,contentType:e.files.type});return yield this.request.api({url:"api/v2/client/uploadWsheetFile",method:"post",headers:i.getHeaders(),data:i})}))}submitReport(e){return g(this,void 0,void 0,(function*(){u.k.info("create worksheet",e);const t=yield this.request.api({url:"api/wsheet/client/createWorkSheet",method:"post",data:e});let i=e.wheetInfo.mobilePhone;const o=yield this.auth.getAuthProfile();return o&&(i=o.userAccount),t.data}))}setEvaluation(e){return g(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getEvaluation(e){return g(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}setUrge(e){return g(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getUrge(e){return g(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}uploadReportFeedback(e){return g(this,void 0,void 0,(function*(){const t=new c;t.append("files",e.files,e.files.name);return(yield this.request.api({method:"post",url:"api/wsheet/client/uploadFeedbackFile",headers:{"Content-Type":"multipart/form-data,multipart/*"},params:{wsheetId:e.wsheetId},data:t})).data}))}downloadFile(e){return g(this,void 0,void 0,(function*(){const t=(yield this.request.api({url:"api/v2/client/downloadWsheetFile",method:"get",params:e,responseType:"stream"})).data;return t.pipe(null),u.k.info(t),t}))}getDownloadItemInfo(e){return g(this,void 0,void 0,(function*(){}))}getHistoryReport(e){return g(this,void 0,void 0,(function*(){return yield this.request.api({url:"api/v2/client/qryWorkSheet",method:"post",data:e})}))}getFeedback(e){return g(this,void 0,void 0,(function*(){return(yield this.request.api({url:"api/wsheet/client/qryFeedbackMsg",method:"get",params:e})).data}))}replyReportFeedback(e){return g(this,void 0,void 0,(function*(){return(yield this.request.api({method:"post",url:"api/wsheet/client/replyWorkSheet",data:e})).data}))}getkey(){return window.atob(this.ack.slice(20)+this.ack.slice(0,20))}uploadLog(e,t){return g(this,void 0,void 0,(function*(){let i=u.k.getLogs();if(0!==i.length)try{let o=v()().format("YYYY-MM-DD-HH-mm-ss"),n=`web-${e}-${o}.log`,r=(0,h.JQ)(`${n}${e}${this.getkey()}`),a={url:"api/cdserv/client/clientlog/genReportUrl",method:"get",params:{fileName:n,account:e,checksum:r}};t&&(a.params.wsheetId=t);let s=new File(i,n),d=yield this.request.api(a);yield this.request.send({url:decodeURIComponent(d.data),method:"put",data:s,headers:{"Content-Type":"application/octet-stream"},maxContentLength:1/0}),u.k.cleanLogs()}catch(e){u.k.error(`日志上传失败:${e.message}`)}}))}};b=m([(0,a.Xn)(),y("design:paramtypes",["function"==typeof(o=void 0!==s.cf&&s.cf)?o:Object,"function"==typeof(n=void 0!==p.g&&p.g)?n:Object,"function"==typeof(r=void 0!==l.v&&l.v)?r:Object])],b)},32695:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>p});var o=i(89810),n=i(51882),r=i(88533),a=i(86614),s=function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function a(e){try{d(o.next(e))}catch(e){r(e)}}function s(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((o=o.apply(e,t||[])).next())}))};const d={class:"replyContent"},l={class:"action"},u={class:"top"},c=(0,o.defineComponent)({__name:"reply",setup(e){const t=(0,o.inject)("detail"),i=((0,n.Z)(),(0,o.ref)("")),c=(0,o.ref)(!1);(0,o.provide)("replying",c);(0,o.computed)((()=>t.value.workSheetVO||{}));function p(){return s(this,void 0,void 0,(function*(){if(!i.value)return;const e=Date.now(),t={params:{feedbackMsg:i.value},createdTime:e,feedbackSource:2,feedbackMsg:i.value,replying:!0,retry:!1};r.$x.emit("init-report-feedback",t),i.value=""}))}return(e,t)=>{const n=(0,o.resolveComponent)("el-input"),r=(0,o.resolveComponent)("el-button");return(0,o.openBlock)(),(0,o.createElementBlock)("div",d,[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("div",u,[(0,o.createVNode)(a.default)]),(0,o.createVNode)(n,{rows:4,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),"show-word-limit":"",type:"textarea",maxlength:"200"},null,8,["modelValue"])]),(0,o.createVNode)(r,{type:"primary",class:"submit mt-2",onClick:p},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("回复")])),_:1})])}}});const p=(0,i(57775).Z)(c,[["__scopeId","data-v-525e6934"]])},86614:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var o=i(89810),n=i(51882),r=i(88533);const a={class:"uploadFile"},s=["accept"],d=(0,o.defineComponent)({__name:"uploadFile",setup(e){(0,n.Z)();const t=(0,o.ref)(),i=(0,o.inject)("detail"),d=(0,o.computed)((()=>i.value&&i.value.workSheetVO||{})),l=(0,o.ref)("image/png, image/jpg, image/jpeg"),u=(0,o.inject)("$message");return(e,i)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",a,[(0,o.createElementVNode)("input",{type:"file",ref_key:"file",ref:t,name:"files",onChange:i[0]||(i[0]=e=>function(e){if(!e)return;const t=e.size/1024/1024<5;if("image/jpeg"!==e.type&&"image/png"!==e.type&&"image/jpg"!==e.type)return u({type:"error",message:"只能上传 jpg/png 格式的图片"}),!1;if(!t)return u({type:"error",message:"上传图片大小不能超过 5MB!"}),!1;let i="",o=new FileReader;o.readAsDataURL(e),o.onload=()=>{i=o.result;const t={params:{id:d.value.wsheetIdString,files:e},createdTime:Date.now(),feedbackSource:2,feedbackAttach:o.result,feedbackMsg:"",replying:!0,retry:!1};r.$x.emit("init-report-feedback",t)}}(e.target.files[0])),accept:l.value,id:"files",style:{display:"none"}},null,40,s),(0,o.createElementVNode)("i",{class:"iconfont icon-folder",onClick:i[1]||(i[1]=e=>(0,o.unref)(t).click())})]))}});const l=(0,i(57775).Z)(d,[["__scopeId","data-v-25207b19"]])}}]);