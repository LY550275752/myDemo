"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[3135],{56706:(e,t,a)=>{a.d(t,{Z:()=>u});var l=a(65431),r=a(89810);const u=(0,l.Q_)("ball",(()=>({showBall:(0,r.ref)(!0),showPanel:(0,r.ref)(!0),usePanel:(0,r.ref)(!1),showConfig:(0,r.ref)(!1),showSetting:(0,r.ref)(!1),showReport:(0,r.ref)(!1),showReportHistory:(0,r.ref)(!1),showReportFeedback:(0,r.ref)(!1),showReportForm:(0,r.ref)(!1),reportTitle:(0,r.ref)("报障"),reportCloseIcon:(0,r.ref)("cross"),reportCloseIconPosition:(0,r.ref)("top-right"),feedbackId:(0,r.ref)(null)})))},63135:(e,t,a)=>{a.d(t,{R:()=>I});var l=a(89810),r=a(65431),u=a(52134),o=a(92720),n=a(64566),i=a(61273),v=(a(15807),a(94684),a(9021)),d=a(66527),s=a(48402),c=a(6522),p=a(6298),f=a(72900),h=a(44876),g=a(17999),m=a(55304),y=a(56706),w=function(e,t,a,l){return new(a||(a=Promise))((function(r,u){function o(e){try{i(l.next(e))}catch(e){u(e)}}function n(e){try{i(l.throw(e))}catch(e){u(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,n)}i((l=l.apply(e,t||[])).next())}))};const I=(0,r.Q_)("report",(()=>{const e=(0,g.yj)(),t=(0,g.tv)(),a=s.nC.get(c.Xb),I=s.nC.get(p.g),b=s.nC.get(h.yG),k=s.nC.get(m.hD),S=(0,v.C)(),{logged:F,authData:R}=(0,r.Jk)(S),D=(0,y.Z)(),{feedbackId:T}=(0,r.Jk)(D),C=(0,l.ref)(null),P=(0,l.ref)(""),A=(0,l.ref)({appId:u.kJ,operStaff:u.eW,orgId:u.TY,sign:"",tenantId:-2,timeStamp:0}),E=(0,l.computed)((()=>`${a.getAPIHost()}/api/v2/client/uploadWsheetFile`)),N=(0,l.ref)(!1),_=(0,l.ref)(!1),x=(0,l.ref)({}),M=(0,l.ref)(null),V=(0,l.ref)(""),j=(0,l.ref)([]),O=(0,l.ref)(""),H=(0,l.ref)(""),q=(0,l.ref)([]),z=(0,l.ref)(""),L=(0,l.ref)(""),J=(0,l.ref)(""),$=(0,l.computed)((()=>{let e=[];return Object.keys(u.x_).forEach((t=>{let a=u.x_[t],l=u.CZ[t];l&&e.push({id:a,label:l,name:l,text:l,value:t})})),e})),B=(0,l.ref)(!1),Q=(0,l.ref)(1),U=(0,l.ref)(10),W=(0,l.ref)(0),Y=(0,l.ref)(!1),Z=(0,l.ref)([]),G=(0,l.ref)({}),X=((0,l.ref)(!1),(0,l.ref)(!1)),K=(0,l.ref)(!1),ee=(0,l.ref)(!1),te=(0,l.computed)((()=>ae.value.length>=ue.value)),ae=(0,l.ref)([]),le=(0,l.ref)(1),re=(0,l.ref)(20),ue=(0,l.ref)(0),oe=(0,l.ref)(""),ne=(0,l.ref)(!1),ie=(0,l.computed)((()=>{let e=[];return ae.value.map((t=>{if(t.feedbackAttach)if(t.feedbackAttach.match("data:image"))e.push(t.feedbackAttach);else{const a=t.feedbackAttach.split(",");e=e.concat(a)}})),e})),ve=(0,l.ref)(!1);function de(e){return ae.value.findIndex((t=>t.createdTime===e))}return{uploadUrl:E,loadingDesktops:N,loadingHistory:B,reporting:_,reportUserName:P,reportType:C,reportTypeText:O,reportFiles:q,reportDesktop:M,reportDesktopText:V,reportDesktops:j,reportTypes:$,reportDesc:H,reportContact:z,reportPhone:L,reportEmail:J,reportData:A,reportHeaders:x,historyPage:Q,refreshHistory:K,historyList:Z,finishedHistory:Y,historyDetail:G,showHistoryDetail:X,feedbackList:ae,feedbackTotal:ue,getReportDesktops:function(){return w(this,void 0,void 0,(function*(){N.value=!0;try{(yield k.getDesktopList()).map((t=>{j.value.push({id:t.desktopId,label:t.objName,name:t.objName,text:t.objName,value:t.desktopId}),"phone_screen"===e.name&&e.query.id===t.desktopId&&(M.value={id:t.desktopId,label:t.objName,name:t.objName,text:t.objName,value:t.desktopId},V.value=t.objName)})),N.value=!1}catch(e){n.F.fail(e.message),N.value=!1}}))},addReportFiles:function(e){e.index?q.value[e.index]=e.value:q.value.push(e.value)},deleteReportFiles:function(e){q.value.splice(e,1)},updateReportType:function(e){C.value=(0,o.cloneDeep)(e),O.value=e.name||"",e.id===u.Y5.TEST&&(H.value="测试单，请直接关单")},updateReportDesktop:function(e){M.value=(0,o.cloneDeep)(e),V.value=e.name||""},updateReportDesc:function(e){H.value=e},updateReportContact:function(e){z.value=e},updateReportPhone:function(e){L.value=e},updateReportEmail:function(e){J.value=e},initReportParams:function(){return w(this,void 0,void 0,(function*(){const e=yield I.getAuthProfile(),t=Date.now();A.value.timeStamp=t,e&&(A.value.tenantId=e.tenantId),A.value.sign=(0,u.gw)(t,u.eW,A.value.tenantId);const l={version:a.getAppVersionCode(),deviceCode:a.getDeviceCode(),deviceType:a.getDeviceType(),appModel:a.getAppModel()};let{deviceType:r,deviceCode:o,version:n,appModel:i}=l;x.value[d.zu.DEVICECODE]=o,x.value[d.zu.DEVICETYPE]=r.toString(),x.value[d.zu.REQUESTID]=Date.now().toString(),x.value[d.zu.TIMESTAMP]=Date.now().toString(),x.value[d.zu.VERSION]=n.toString(),x.value[d.zu.APPMODEL]=i.toString()}))},submitReport:function(){var r,u,o;return w(this,void 0,void 0,(function*(){if(!P.value&&!F.value)return void(0,n.F)("请输入用户名");if(!z.value)return void(0,n.F)("请输入联系人");if(!C.value)return void(0,n.F)("请选择故障类型");if(!H.value)return void(0,n.F)("请输入故障描述");if(!L.value)return void(0,n.F)("请输入手机号码");if(!(0,f.p)(L.value))return void(0,n.F)("手机号码格式不正确");if(!J.value)return void(0,n.F)("请输入邮箱地址");if(!(0,f.Jh)(J.value))return void(0,n.F)("邮箱地址格式不正确");_.value=!0;const v=yield I.getAuthProfile();let d=P.value;(null==v?void 0:v.userId)&&(d=String(null===(r=M.value)||void 0===r?void 0:r.id));const s={appInfo:(0,l.toRaw)(A.value),wheetInfo:{clientVersion:a.getAppVersionCode()+"",contactName:z.value,emails:J.value,fileInfo:[],isLogin:(null==v?void 0:v.userId)?1:0,mobilePhone:L.value,userAcount:P.value,wsheetDesc:H.value,wsheetIp:"",wsheetLevel:1,wsheetObj:d,wsheetObjType:(null==v?void 0:v.userId)?2:0,wsheetSource:a.getDeviceType()+"",wsheetSubtypeId:Number(null===(u=C.value)||void 0===u?void 0:u.id),wsheetTitle:`${z.value} ${null===(o=C.value)||void 0===o?void 0:o.name}`,wsheetTypeId:1e3}};q.value.map((e=>{e.attachIdStrings[0]&&s.wheetInfo.fileInfo.push({attachId:e.attachIdStrings[0],createdTime:0})}));try{const a=yield b.submitReport(s);_.value=!1,a.wsheetIdString&&i.V.alert({message:"我们的技术人员正在处理您的故障，处理结果将第一时间通过电话反馈给您，请密切关注并确保电话畅通"}).then((()=>{"phone_screen"===e.name?D.$reset():window.history.state?window.history.go(-1):t.replace({name:"phone_home",query:{module:"phone"}})}))}catch(e){_.value=!1,n.F.fail(e.message)}}))},updateReportFiles:function(e){q.value=(0,o.cloneDeep)(e)},initReporter:function(){var e,t,a,l;J.value||(J.value=(null===(e=R.value)||void 0===e?void 0:e.email)||""),L.value||(L.value=(null===(t=R.value)||void 0===t?void 0:t.mobilephone)||""),z.value||(z.value=(null===(a=R.value)||void 0===a?void 0:a.userName)||""),P.value||(P.value=(null===(l=R.value)||void 0===l?void 0:l.userAccount)||"")},getReportHistory:function(e=1,t){return w(this,void 0,void 0,(function*(){t?K.value=!0:Q.value=e,B.value=!0;const a=yield I.getAuthProfile(),r={appInfo:(0,l.toRaw)(A.value),workSheetReqVO:{pageNum:e||Q.value,pageSize:U.value,userAcount:null==a?void 0:a.userAccount}};try{const e=yield b.getHistoryReport(r);if(e.data.list){let t=Z.value.map((e=>e.workSheetVO.wsheetIdString));W.value=e.data.total,e.data.list.map((e=>{t.includes(e.workSheetVO.wsheetIdString)||Z.value.push(e)})),Z.value=Z.value.sort(((e,t)=>t.workSheetVO.createdTime-e.workSheetVO.createdTime))}K.value=!1,B.value=!1,Y.value=Z.value.length>=W.value}catch(e){n.F.fail(e.message),K.value=!1,B.value=!1}}))},updateCurrentHistoryDetail:function(e,t){G.value=e,t&&(X.value=t)},feedbackPage:le,loadingFeedback:ee,finishedFeedback:te,replying:ne,feedbackReplyContent:oe,feedbackImages:ie,scrollBottom:ve,getReportFeedback:function(t){return w(this,void 0,void 0,(function*(){ee.value=!0,t&&(le.value=t);let a={pageNum:le.value,pageSize:re.value,wsheetId:""};"phone_screen"===e.name?a.wsheetId=String(T.value):a.wsheetId=String(e.query.id);const l=ae.value.map((e=>e.replyId));try{const e=yield b.getFeedback(a);ue.value=e.total,e.list.map((e=>{l.includes(e.replyId)||ae.value.unshift(e)})),ae.value.sort(((e,t)=>e.createdTime-t.createdTime)),ee.value=!1}catch(e){ee.value=!1,n.F.fail(e.message)}}))},retryFeedbackMsg:function(t){return w(this,void 0,void 0,(function*(){ne.value=!0;const a=de(t.createdTime);ae.value[a]=t;let l={wsheetId:"",feedbackMsg:t.feedbackMsg};"phone_screen"===e.name?l.wsheetId=String(T.value):l.wsheetId=String(e.query.id);try{yield b.replyReportFeedback(l),ne.value=!1,ae.value[a]&&(ae.value[a].replying=!1,ae.value[a].retry=!1,ve.value=!0)}catch(e){ne.value=!1,ae.value[a]&&(ae.value[a].replying=!1,ae.value[a].retry=!0),n.F.fail(e.message)}}))},submitFeedbackMsg:function(){return w(this,void 0,void 0,(function*(){if(!oe.value)return;ne.value=!0;const t={createdTime:Date.now(),feedbackSource:2,feedbackMsg:oe.value,replying:!0,retry:!1};ae.value.push(t),ue.value+=1;let a={feedbackMsg:oe.value,wsheetId:""};"phone_screen"===e.name?a.wsheetId=String(T.value):a.wsheetId=String(e.query.id),oe.value="";const l=ae.value.length-1;try{yield b.replyReportFeedback(a),ne.value=!1,ae.value[l]&&(ae.value[l].replying=!1,ae.value[l].retry=!1,ve.value=!0)}catch(e){ne.value=!1,ae.value&&ae.value[l]&&(ae.value[l].replying=!1,ae.value[l].retry=!0),n.F.fail(e.message)}}))},submitFeedbackFile:function(t){return w(this,void 0,void 0,(function*(){ne.value=!0;const a=de(t.createdTime);a>=0?ae.value[a]=t:(ae.value.push(t),ue.value+=1);let r={wsheetId:"",files:(0,l.toRaw)(t.params.files),file:t.params.file};"phone_screen"===e.name?r.wsheetId=String(T.value):r.wsheetId=String(e.query.id);const u=a>=0?a:ae.value.length-1;try{const t=yield b.uploadReportFeedback(r);if(0==t.retCode){(yield b.replyReportFeedback({wsheetId:String(e.query.id),attachIds:t.attachIdStrings}))?ae.value[u]&&(ae.value[u].replying=!1,ae.value[u].retry=!1,ve.value=!0):ae.value[u]&&(ae.value[u].replying=!1,ae.value[u].retry=!0)}ne.value=!1}catch(e){ne.value=!1,ae.value&&ae.value[u]&&(ae.value[u].replying=!1,ae.value[u].retry=!0),n.F.fail(e.message)}}))},updateFeedbackReplyContent:function(e){oe.value=e},updateScrollBottom:function(e){ve.value=e}}}))}}]);