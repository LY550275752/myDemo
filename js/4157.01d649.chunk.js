"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[4157],{99465:(e,t,n)=>{function o(e,t,n){return o=(o,i)=>{const u=`$debounce$${i}`,a=`$debounce$result$${i}`;return function(...i){this[a]||(this[a]=n?n():void 0),clearTimeout(this[u]),t&&(this[a]=t(this[a],...i),i=[this[a]]),this[u]=setTimeout((()=>{o.apply(this,i),this[a]=n?n():void 0}),e)}},(e,t,n)=>{let i=null,u=null;if("function"==typeof n.value?(i="value",u=n.value):"function"==typeof n.get&&(i="get",u=n.get),!u)throw new Error("not supported");i&&(n[i]=o(u,t))};var o}n.d(t,{Ds:()=>o})},10074:(e,t,n)=>{n.d(t,{n:()=>k});var o=n(89810),i=n(65431),u=n(48402),a=n(14334),r=n(55304),c=n(19816),l=n(66527),s=n(90245);const v={[s.N$.ACTIVE]:{text:"云手机已开机，准备连接云手机...",timeout:100},[s.N$.SUSPENED]:{text:"云手机已休眠，正在为您唤醒休眠的云手机，大约需要3分钟，请耐心等待…",timeoutText:"本次唤醒云手机时间过长，请退出重试",timeout:180},[s.N$.SHUTOFF]:{text:"云手机已关机，正在为您开机，大约需要2分钟，请耐心等待…",timeoutText:"本次开机时间过长，请退出重试",timeout:120},[s.N$.DELETE]:{text:"云手机已删除，如有疑问请联系客服。"},[s.N$.TASKRUNING]:{1301:{text:"正在为您开机，大约需要2分钟，请耐心等待…",timeoutText:"本次开机时间过长，请退出重试",timeout:120},1313:{text:"云手机已休眠，正在为您唤醒休眠的云手机，大约需要5分钟，请耐心等待…",timeoutText:"本次唤醒云手机时间过长，请退出重试",timeout:300},1302:{text:"云手机重启中，大约需要5分钟，请耐心等待…",timeoutText:"本次重启时间过长，请退出重试",timeout:300},1314:{text:"云手机已休眠，正在为您唤醒休眠的云手机，大约需要3分钟，请耐心等待…",timeoutText:"本次唤醒云手机时间过长，请退出重试",timeout:180},1300:{text:"云手机正在准备中，预计需要10分钟，请耐心等待，也可以稍后再试",timeoutText:"云手机准备时间过长，请退出重试",timeout:600},1303:{text:"云手机正在重装中，预计需要10分钟，请耐心等待，也可以稍后再试",timeoutText:"本次重装时间过长，请退出重试",timeout:600},1309:{text:"云手机正在重装中，预计需要10分钟，请耐心等待，也可以稍后再试",timeoutText:"本次重装时间过长，请退出重试",timeout:600},1200:{text:"云手机正在重装中，预计需要10分钟，请耐心等待，也可以稍后再试",timeoutText:"本次重装时间过长，请退出重试",timeout:600},1307:{text:"云手机正在扩容中，预计需要3分钟，请耐心等待",timeoutText:"本次扩容时间过长，请退出重试",timeout:180},1316:{text:"云手机正在扩容中，预计需要3分钟，请耐心等待",timeoutText:"本次扩容时间过长，请退出重试",timeout:180},1318:{text:"云手机正在磁盘回滚中，预计需要3分钟，请耐心等待",timeoutText:"本次磁盘回滚时间过长，请退出重试",timeout:180},1304:{text:"云手机已关机，正在为您开机，大约需要3分钟，请耐心等待…",timeoutText:"本次开机时间过长，请退出重试",timeout:180},1306:{text:"云手机正在迁移中，预计需要10分钟，请耐心等待，也可以稍后再试",timeoutText:"本次迁移时间过长，请退出重试",timeout:600},1311:{text:"云手机正在准备中，预计需要10分钟，请耐心等待，也可以稍后再试",timeoutText:"云手机准备时间过长，请退出重试",timeout:600}},[s.N$.ERROR]:{text:"云手机处于错误状态中，正在尝试修复并连接，预计需要10分钟...",timeoutText:"本次尝试修复并连接失败，请退出重试",timeout:180},[s.N$.OTHER]:{text:"云手机正在尝试连接中…",timeoutText:"本次尝试连接失败，请退出重试",timeout:180},[s.N$.DEFAULT]:{text:"正在为您查询云手机状态...",timeoutText:"查询云手机状态失败，请退出重试",timeout:180},[s.N$.PREEMPTION]:{text:"正在为您连接云手机，请稍等...",timeoutText:"连接云手机超时，请退出重试",timeout:600}};var d,f=n(72900),p=n(28706),h=n(35582),m=n(6522),g=n(31182),y=function(e,t,n,o){return new(n||(n=Promise))((function(i,u){function a(e){try{c(o.next(e))}catch(e){u(e)}}function r(e){try{c(o.throw(e))}catch(e){u(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};!function(e){e[e.READY=0]="READY",e[e.FIRST_IMAGE=1]="FIRST_IMAGE",e[e.CONNECTED=2]="CONNECTED",e[e.COMPLETED=3]="COMPLETED"}(d||(d={}));const k=(0,i.Q_)("connect",(()=>{const e=u.nC.get(a.WY),t=u.nC.get(m.Xb),n=u.nC.get(r.hD),i=(0,g.x)(),s=(0,o.computed)((()=>t.getSystemModel()===h.D0.PHONE?"云手机":"云电脑")),k=(0,o.ref)(!1),E=(0,o.ref)([]),D=(0,o.ref)([]),T=(0,o.ref)(!1),x=(0,o.ref)(!1),C=(0,o.ref)(!1),I=(0,o.ref)(0),N=(0,o.ref)(null),F=(0,o.ref)({connectFlag:!1,clinkFlag:!1}),w=(0,o.ref)(!1),$=(0,o.ref)(new Set),R=(0,o.ref)(5),S=(0,o.ref)(d.READY),b=(0,o.ref)(null),O=(0,o.ref)(""),P=(0,o.ref)({text:`${s.value}连接中，请耐心等待`,timeoutText:"本次连接时间过长，请退出重试",timeout:180});function A(){return y(this,void 0,void 0,(function*(){if(E.value=[],T.value=!1,!n.connection.connectionInfo||n.connection.connectionInfo.goingRetry)throw x.value=!0,new Error("获取连接信息失败，请退出重试");let e=n.connection.connectionInfo.desktopInfo,t=1===e.clinkIpv6LvsEnable,o=1===e.clinkLvsEnable;if(t||o){if(T.value=!0,E.value.push(e.clinkLvsInHost),C.value)return;return E.value.push(e.clinkLvsOutHost),E.value.push(e.clinkLvsInHostBak),E.value.push(e.clinkLvsOutHostBak),void c.k.info("loopUrlList",E.value.join(","))}}))}function L(){return y(this,void 0,void 0,(function*(){c.k.info("-call function startClink"),F.value.connectFlag=!0,_(),I.value<70&&(I.value=70);try{N.value=yield n.getClinkRunData(n.connection.id)}catch(e){return C.value?void j():(e.name===l.Hx.errorName&&(x.value=!0),void H(e))}try{yield M()}catch(e){e.name===l.Hx.errorName&&(x.value=!0),H(e)}}))}function M(){return y(this,void 0,void 0,(function*(){if(N.value){if(N.value.flowChartConfig=1,T.value){let e=!0;for(;e;){let t=E.value.shift();if(!t)return C.value?void j():void H(new Error(`${s.value}连接失败，请退出重试`));e=!1;let o=(0,f.Oh)(t);D.value.push(t),N.value.host=o.host,N.value.port=o.port.toString(),(0,f.ds)(o.host)||(c.k.info("clink ws server from api"),N.value.uri=`wss://${t}/clinkProxy/${n.connectionInfo.desktopId}`),c.k.info(`clink connect host:${o.host}, port:${o.port}, cacheMode:`,C)}}else D.value.push(`${N.value.host}:8011`);return e.stop(),e.run((0,o.toRaw)(N.value))}H(new Error(`${s.value}连接失败，请退出重试`))}))}function H(e){O.value=e.message,w.value=!0,_(),n.stopLoopConnect(),c.k.error("connect failed:",e.message)}function _(){b.value&&clearInterval(b.value)}function j(){return y(this,void 0,void 0,(function*(){w.value=!1,$.value.clear(),S.value=d.READY;try{C.value=!1,c.k.info("reconnect desktop");let e=yield n.connectDesktop(n.connection.id);e.connectionInfo&&!e.connectionInfo.goingRetry||(yield n.loopConnectDesktop(e.id)),yield A(),L()}catch(e){e.name===l.Hx.errorName&&(x.value=!0),H(e)}}))}return{connectDesktop:function(){return y(this,void 0,void 0,(function*(){try{if(!n.connection.connectionInfo||n.connection.connectionInfo.goingRetry){let e=yield n.loopConnectDesktop(n.connection.id);if(!e.connectionInfo||e.connectionInfo.goingRetry)return}yield A(),L()}catch(e){e.name===l.Hx.errorName&&(x.value=!0),H(new Error("获取连接信息失败，请退出重试"))}}))},getDesktopState:function(){return y(this,void 0,void 0,(function*(){let e;const t={objId:n.connection.desktop.objId,objType:n.connection.desktop.objType};try{e=yield n.getDesktopState(t)}catch(t){n.connection.desktop.isPreemption?e={desktopState:r.N$.PREEMPTION,runningTask:0}:(e={desktopState:r.N$.DEFAULT,runningTask:0},t.name===l.Hx.errorName&&(x.value=!0))}const{runningTask:o,desktopState:i}=e;if(w.value)return;let u=null;try{u=r.N$.TASKRUNING===i&&o?v[i][o]:v[i]}catch(e){}u&&(P.value=u),O.value=P.value.text,function(){y(this,void 0,void 0,(function*(){const e=yield function(e,t,n,o,i=800){return y(this,void 0,void 0,(function*(){return new Promise((u=>{const a=Math.ceil(1e3*n/i),r=Number(((t-e)/a).toFixed(1)),c=()=>{(o(e=(e+=r)>=t?t:e)||t===e)&&(b.value&&clearInterval(b.value),u(-1))};b.value=setInterval(c,i),c()}))}))}(0,70,P.value.timeout||180,(e=>(I.value=e,F.value.connectFlag)));c.k.info("connect-progress end ",e,F.value.connectFlag),-1!==e||F.value.connectFlag||H(new Error(P.value.timeoutText||`连接${s.value}超时，请退出重试`))}))}()}))},registerListener:function(){e.onChannelStateChange.on((e=>{if(S.value!==d.COMPLETED&&e.state===a.Dz.CONNECTED)if($.value.add(e["channel-name"]),$.value.size>=R.value)I.value=96;else{let e=70+Number(($.value.size/R.value*26).toFixed(2));I.value=Math.max(e,I.value)}})),e.onClinkStateChange.on((e=>{if(S.value!==d.COMPLETED){switch(e.state){case a.j4.CONNECTING:S.value=d.READY,O.value=`正在为您连接${s.value}，请稍等...`;break;case a.j4.CONNECTED:S.value|=d.CONNECTED;break;case a.j4.FIRSTIMAGE:S.value|=d.FIRST_IMAGE;break;case a.j4.CONNECTFAILED:S.value=d.READY,function(e){y(this,void 0,void 0,(function*(){c.k.info("Connect CONNECTFAILED"),S.value=d.READY,C.value?j():T.value?M():H(new Error(`${s.value}连接失败,请退出重试`))}))}()}S.value===d.COMPLETED&&(I.value=100,n.updateDesktopConnection({id:n.connection.id,clinkConfig:N.value||void 0}),setTimeout((()=>{k.value=!0,p.N.connected(),i.checkVersion()}),100))}}))},exit:function(e){n.disconnectDesktopConnection()},init:function(){k.value=!1,F.value={connectFlag:!1,clinkFlag:!1},E.value=[],x.value=!1,I.value=0,N.value=null,C.value=!1,S.value=d.READY,b.value=null,O.value=""},connected:k,connectState:S,msg:O,isError:w,cacheMode:C,loopUrlList:E,loopMode:T,clinkRunData:N,readyChannels:$,channelsNumber:R,isAPIError:x,loopUrlListToNet:D}}))},10111:(e,t,n)=>{n.d(t,{l:()=>m});var o=n(89810),i=n(65431),u=n(48402),a=n(55304),r=n(64566),c=n(61273),l=(n(15807),n(94684),n(66527)),s=n(6298),v=n(92720),d=n(17999),f=n(10074),p=function(e,t,n,o){return new(n||(n=Promise))((function(i,u){function a(e){try{c(o.next(e))}catch(e){u(e)}}function r(e){try{c(o.throw(e))}catch(e){u(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};function h(e,t){let n=36e5,o=864e5;return parseInt((t-e)/parseInt(o))+"天"+parseInt((t-e)%parseInt(o)/parseInt(n))+"小时"+parseInt(parseInt((t-e)%parseInt(o)%parseInt(n))/parseInt(6e4))+"分钟"}const m=(0,i.Q_)("desktops",(()=>{const e=u.nC.get(a.hD),t=u.nC.get(s.g),n=(0,f.n)(),i=(0,d.yj)(),m=(0,o.ref)({}),g=(0,o.ref)([]),y=(0,o.ref)(!1),k=(0,o.ref)(null),E=(0,o.ref)(!1),D=(0,o.ref)(!1),T=((0,o.ref)(!1),(0,o.ref)(!1)),x=(0,o.ref)(!1),C=(0,o.ref)(""),I=(0,o.ref)({}),N=(0,o.ref)(!1),F=(0,o.ref)(!1),w=(0,o.ref)(!1),$=(0,o.ref)(""),R=(0,o.ref)(""),S=(0,o.ref)(""),b=(0,o.ref)([]),O=(0,o.ref)([]);return{desktops:g,loading:y,connecting:E,connected:D,connection:k,currentDesktop:m,configData:I,loadingConfig:T,errorConfig:x,isEmpty:N,isRename:F,isPool:w,updateCurrentDesktop:function(e){m.value=(0,v.cloneDeep)(e)},getDesktops:function(){return p(this,void 0,void 0,(function*(){y.value=!0;try{const t=yield e.getDesktopList();g.value=t,y.value=!1}catch(e){r.F.fail(e.message),y.value=!1}}))},handleConnectDesktop:function(n){return p(this,void 0,void 0,(function*(){!function(n,o,i){p(this,void 0,void 0,(function*(){try{k.value=yield e.createDesktopConnection(n)}catch(e){return void r.F.fail(e.message)}try{o(),yield e.connectDesktop(k.value.id,1),yield function(){var n;return p(this,void 0,void 0,(function*(){(yield t.getAuthProfile())&&(null===(n=k.value)||void 0===n?void 0:n.id)&&e.activateDesktopConnection(k.value.id)}))}()}catch(t){if(e.deleteDesktopConnection(k.value.id),t.code===l.or.DESKTOP_LIMIT||t.code===l.or.DESKTOP_EMPTY||t.code===l.or.DESKTOP_Preemption)yield c.V.alert({title:"提示",message:t.message});else if(r.F.fail(t.message),t.name!==l.Hx.errorName){const e=3==process.env.APP_MODEL?"云手机":"云电脑";yield c.V.alert({title:`${e}连接失败`,message:`请检查本地网络是否正常或重新连接${e}`})}}finally{i()}}))}(n,(()=>{E.value=!0}),(()=>{E.value=!1}))}))},restart:function(t,n,o){return p(this,void 0,void 0,(function*(){const i=t.strategy&&t.strategy.rebootMsg,u=i||"该操作可能会导致您未保存的数据丢失，是否确认重启？";c.V.confirm({title:"提示",message:u}).then((()=>p(this,void 0,void 0,(function*(){n();try{yield function(t){return p(this,void 0,void 0,(function*(){const n=yield new Promise(((n,o)=>{e.reboot(t.objId,!1,1).then((e=>{e&&n("重启进行中，请稍候")})).catch((e=>{o(e)}))}));r.F.success(n)}))}(t)}catch(e){r.F.fail(e.message)}finally{o()}}))))}))},getDesktopConfig:function(){var t,n,o,u;return p(this,void 0,void 0,(function*(){if(!i.query.id||!i.query.oid||!i.query.type)return;r.F.loading({message:"正在获取配置",forbidClick:!0});const a={desktopId:i.query.id,objType:i.query.type,objId:i.query.oid};N.value=!1,T.value=!0,x.value=!1;try{const i=yield e.getHardwareFeature(a);if(r.F.clear(),i.dataDiskGB||(N.value=!0),I.value=i,i.createDate&&i.nowDate&&i.expireDate){$.value=function(e){const t=new Date(e);return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日${t.getHours()}时`}(i.expireDate),R.value=h(i.createDate,i.nowDate);let e=i.expireDate-i.createDate,t=i.nowDate-i.createDate;S.value=t>=e?h(0,0):h(t,e)}b.value=(null===(n=null===(t=i.linkInfo)||void 0===t?void 0:t.linkPhone)||void 0===n?void 0:n.split(","))||[],O.value=(null===(u=null===(o=i.linkInfo)||void 0===o?void 0:o.linkEmail)||void 0===u?void 0:u.split(","))||[],T.value=!1,r.F.clear()}catch(e){r.F.clear(),C.value=e.message,T.value=!1,x.value=!0}}))},reboot:function(t){return p(this,void 0,void 0,(function*(){c.V.confirm({message:"云手机即将重启，手机内未保存的数据将丢失，是否确定重启"}).then((()=>p(this,void 0,void 0,(function*(){const o={desktopId:String(i.query.id),operationType:a.Q3.RESET};r.F.loading({message:"正在重启",forbidClick:!0});try{yield e.operate(o),t?(r.F.clear(),n.exit(String(i.query.id))):r.F.success("重启成功")}catch(e){r.F.fail(e.message)}})))).catch((()=>{}))}))},powerOff:function(){return p(this,void 0,void 0,(function*(){c.V.confirm({message:"云手机即将关机，手机内未保存的数据将丢失，是否确定关机"}).then((()=>p(this,void 0,void 0,(function*(){const t={desktopId:i.query.id,operationType:a.Q3.SHUTDOWN};r.F.loading({message:"正在关机",forbidClick:!0});try{yield e.operate(t),r.F.clear(),n.exit(String(i.query.id))}catch(e){r.F.fail(e.message)}})))).catch((()=>{}))}))},restore:function(){return p(this,void 0,void 0,(function*(){c.V.confirm({message:"将云手机重装至初始状态，系统内用户个人数据将被清除，如非系统故障，一般情况下不建议使用"}).then((()=>p(this,void 0,void 0,(function*(){const t={desktopId:i.query.id,operationType:a.Q3.RESTORE};r.F.loading({message:"正在重装",forbidClick:!0});try{yield e.operate(t),r.F.clear(),n.exit(String(i.query.id))}catch(e){r.F.fail(e.message)}})))).catch((()=>{}))}))}}}))},31182:(e,t,n)=>{n.d(t,{x:()=>d});var o=n(65431),i=n(61273),u=n(64566),a=n(17999),r=n(48402),c=n(55304),l=n(48703),s=n(35582),v=(n(15807),n(94684),function(e,t,n,o){return new(n||(n=Promise))((function(i,u){function a(e){try{c(o.next(e))}catch(e){u(e)}}function r(e){try{c(o.throw(e))}catch(e){u(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))});const d=(0,o.Q_)("version",(()=>{const e=r.nC.get(c.hD),t=r.nC.get(l.G),n=(0,a.yj)();return{checkVersion:function(o){return v(this,void 0,void 0,(function*(){const a=e.connection.desktop.objId,r={desktopId:Number(a)};try{const l=yield t.getMirrorVersion(r),d=yield t.getVersion({osType:s.ft.ANDROID,softwareCode:l.softwareCode});l.versionCode<d.versionCode&&"phone_screen"===n.name&&i.V.confirm({message:`有新的版本 ${d.versionName}`,confirmButtonText:"立即更新",cancelButtonText:"取消",showCancelButton:!d.forceUpdate,theme:d.forceUpdate?"round-button":"default"}).then((()=>v(this,void 0,void 0,(function*(){try{yield e.operate({desktopId:a,operationType:c.Q3.DESK_SYSTEM_UPGRADE}),e.disconnectDesktopConnection()}catch(e){u.F.fail(e.message)}})))).catch((()=>{})),l.versionCode===d.versionCode&&o&&"phone_screen"===n.name&&u.F.success("系统已最新")}catch(e){}}))}}}))}}]);