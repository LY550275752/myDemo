"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[4248],{49264:(e,t,n)=>{function o(e,t="yyyy-MM-dd",n="--"){if(!e)return n;let o=new Date(e);if(e=e+60*o.getTimezoneOffset()*1e3- -288e5,o.setTime(e),"Invalid Date"===o.toString())return n;let i={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds(),"q+":Math.floor((o.getMonth()+3)/3),S:o.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}n.d(t,{m:()=>o})},35247:(e,t,n)=>{n.d(t,{Yi:()=>d,bC:()=>u,wz:()=>s,we:()=>r,Du:()=>a,bL:()=>y});var o=n(48402),i=n(6298),l=n(6522),c=n(88538);const a={1:"云电脑",2:"云电脑",3:"云手机"};var r;!function(e){e[e.UNDO=0]="UNDO",e[e.IGNORE=1]="IGNORE"}(r||(r={}));const s={1:"非工作时间异常",2:"登录地点异常","1#2":"非工作时间异常和登录地点异常"},d={10:"瘦终端",11:"瘦终端",15:"IPTV",20:"Android Phone",25:"PC",26:"WinXP-PC",30:"iPhone",35:"Android Pad",40:"iPad",45:"Mac",60:"Web客户端",90:"Web"},u={10:{color:"#32CC93",name:"equipment-1"},11:{color:"#32CC93",name:"equipment-1"},15:{color:"#4CA7FB",name:"equipment-3"},20:{color:"#4CA7FB",name:"equipment-3"},25:{color:"#FD893A",name:"equipment-4"},26:{color:"#FD893A",name:"equipment-4"},30:{color:"#4CA7FB",name:"equipment-2"},35:{color:"#4CA7FB",name:"equipment-3"},40:{color:"#4CA7FB",name:"equipment-2"},45:{color:"#FD893A",name:"equipment-5"},def:{color:"#FD893A",name:"equipment-6"}};var m,p,g,f=function(e,t,n,o){var i,l=arguments.length,c=l<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(c=(l<3?i(c):l>3?i(t,n,c):i(t,n))||c);return l>3&&c&&Object.defineProperty(t,n,c),c},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e,t,n,o){return new(n||(n=Promise))((function(i,l){function c(e){try{r(o.next(e))}catch(e){l(e)}}function a(e){try{r(o.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}r((o=o.apply(e,t||[])).next())}))};let y=class{constructor(e,t,n){this.auth=e,this.request=t,this.env=n}getLogs(e){return h(this,void 0,void 0,(function*(){e.oneDay||1!==e.pageNum||(e.lastRecordLoginTime=0,e.lastRecordUserLogId=0);return(yield this.getApi("api/cdserv/client/getLogs",e)).data}))}getExcepLogCounts(e){return h(this,void 0,void 0,(function*(){const t=yield this.auth.getAuthProfile();if(!e||!t)return;const n={desktopId:e,userId:t.userId};return(yield this.getApi("api/cdserv/client/getExcepLogCounts",n)).data}))}ignoreAllExcepLogs(){return h(this,void 0,void 0,(function*(){return yield this.postApi("api/cdserv/client/ignoreAllExcepLogs")}))}handleExcepLog(e){return h(this,void 0,void 0,(function*(){return yield this.postApi("api/cdserv/client/handleExcepLog",e)}))}getDeviceList(){return h(this,void 0,void 0,(function*(){return(yield this.getApi("api/cdserv/client/device/list")).data}))}deviceUnbind(e){return h(this,void 0,void 0,(function*(){return yield this.postApi("api/cdserv/client/device/unbinding",e)}))}deviceEdit(e){return h(this,void 0,void 0,(function*(){return yield this.postApi("api/cdserv/client/device/edit",e)}))}getApi(e,t){return this.request.api({url:e,method:"GET",params:t})}postApi(e,t){return h(this,void 0,void 0,(function*(){return this.request.api({url:e,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t})}))}};y=f([(0,o.Xn)(),v("design:paramtypes",["function"==typeof(m=void 0!==i.g&&i.g)?m:Object,"function"==typeof(p=void 0!==c.cf&&c.cf)?p:Object,"function"==typeof(g=void 0!==l.Xb&&l.Xb)?g:Object])],y)},4248:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var o=n(89810),i=n(35247),l=n(48402),c=n(49264),a=n(5341),r=function(e,t,n,o){return new(n||(n=Promise))((function(i,l){function c(e){try{r(o.next(e))}catch(e){l(e)}}function a(e){try{r(o.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}r((o=o.apply(e,t||[])).next())}))};const s={class:"log"},d={key:0,class:"log-filter"},u=["infinite-scroll-disabled"],m={class:"log-main-date"},p={class:"log-main-list"},g=["onClick"],f={class:"log-main-list-item-name"},v={class:"log-main-list-item-name-detail"},h={key:0,class:"log-main-list-item-user-name"},y={key:1},k={key:0,class:"log-main-list-item-excep-mobile"},E={class:"log-main-list-item-login"},C={class:"log-main-list-item-logout"},N={key:1,class:"log-main-list-item-excep"},B={key:0,class:"log-main-loading"},x={key:1},D=(0,o.defineComponent)({__name:"LogListComp",props:{isException:{default:!1,type:Boolean},filter:{default:!1,type:Boolean}},emits:["click"],setup(e,{emit:t}){const n=e,D=(0,a.mL)(),V=l.nC.get(i.bL),L=i.wz;let b=i.we;const w=(0,o.ref)([]),T=(0,o.ref)(""),A=(0,o.ref)(!1),S=(0,o.ref)(!1),R=e=>e.getTime()>Date.now();let M=i.bC,q={pageNum:0,pageSize:10,lastRecordUserLogId:0,lastRecordLoginTime:0};const O=(0,o.computed)((()=>A.value||S.value));function P(e){return M[e]||M.def}function F(){q.pageNum++,function(e){r(this,void 0,void 0,(function*(){n.isException&&(e.isException=1),A.value=!0;try{const t=yield V.getLogs(e),n=t.list;S.value=!t.hasNextPage;const o=n[n.length-1];q.lastRecordUserLogId=o.userLogId,q.lastRecordLoginTime=o.loginTime;const i=new Map;n.forEach((e=>{const t=(0,c.m)(e.loginTime,"yyyy年MM月dd日 hh:mm:ss"),n=(0,c.m)(e.logoutTime,"yyyy年MM月dd日 hh:mm:ss","-- --"),[o,l]=t.split(" "),[a,r]=n.split(" ");i.has(o)||i.set(o,[]);const s=i.get(o);e.loginTimeStr=l,e.logoutTimeStr=r,e.loginTime=t,e.logoutTime=n,s.push(e)}));for(let[e,t]of i){let n=w.value.find((t=>t.date===e));n?n.logList=n.logList.concat(t):w.value.push({date:e,logList:t})}A.value=!1}catch(e){}}))}(q)}function I(e){w.value=[],q.pageNum=0,S.value=!!e,q.pageSize=e?1e4:10,q.oneDay=e,F()}return(n,i)=>{const l=(0,o.resolveComponent)("el-date-picker"),c=(0,o.resolveComponent)("WarningFilled"),a=(0,o.resolveComponent)("el-icon"),r=(0,o.resolveComponent)("el-tooltip"),V=(0,o.resolveDirective)("infinite-scroll");return(0,o.openBlock)(),(0,o.createElementBlock)("div",s,[e.filter?((0,o.openBlock)(),(0,o.createElementBlock)("div",d,[(0,o.createVNode)(l,{modelValue:T.value,"onUpdate:modelValue":i[0]||(i[0]=e=>T.value=e),format:"YYYY年MM月DD日","value-format":"YYYY-MM-DD",onChange:I,type:"date",placeholder:"选择日期","disabled-date":R},null,8,["modelValue"])])):(0,o.createCommentVNode)("",!0),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("div",{"infinite-scroll-distance":10,"infinite-scroll-disabled":(0,o.unref)(O),class:"log-main"},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(w.value,((e,n)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:e.date+n},[(0,o.createElementVNode)("div",m,(0,o.toDisplayString)(e.date),1),(0,o.createElementVNode)("ul",p,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.logList,(e=>((0,o.openBlock)(),(0,o.createElementBlock)("li",{key:e.userLogId,onClick:n=>function(e){t("click",e)}(e),class:"log-main-list-item panel"},[(0,o.createElementVNode)("div",f,[(0,o.createElementVNode)("i",{style:(0,o.normalizeStyle)({background:P(e.deviceType).color}),class:(0,o.normalizeClass)(["log-main-list-item-name-icon iconfont","icon-"+P(e.deviceType).name])},null,6),(0,o.createElementVNode)("div",v,[(0,o.unref)(D)?((0,o.openBlock)(),(0,o.createElementBlock)("div",h,(0,o.toDisplayString)(e.userName),1)):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["log-main-list-item-device-name",{"log-main-list-item-name-excep":e.isException&&e.handleStatus===(0,o.unref)(b).UNDO}])},(0,o.toDisplayString)(e.deviceName),3),(0,o.unref)(D)?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)("div",y,(0,o.toDisplayString)(e.userIp),1))])]),(0,o.unref)(D)&&e.isException&&e.handleStatus===(0,o.unref)(b).UNDO?((0,o.openBlock)(),(0,o.createElementBlock)("div",k,[(0,o.createVNode)(a,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c)])),_:1}),(0,o.createElementVNode)("span",null,(0,o.toDisplayString)((0,o.unref)(L)[e.exceptionType]),1)])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("span",E,[(0,o.createTextVNode)(" 登录时间："),(0,o.createElementVNode)("span",null,(0,o.toDisplayString)(e.loginTimeStr),1)]),(0,o.createElementVNode)("span",C,[(0,o.createTextVNode)(" 下线时间："),(0,o.createElementVNode)("span",null,(0,o.toDisplayString)(e.logoutTimeStr),1)]),(0,o.unref)(D)?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)("span",N,[e.isException&&e.handleStatus===(0,o.unref)(b).UNDO?((0,o.openBlock)(),(0,o.createBlock)(r,{key:0,class:"item",effect:"dark",content:(0,o.unref)(L)[e.exceptionType],placement:"left"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(a,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c)])),_:1})])),_:2},1032,["content"])):(0,o.createCommentVNode)("",!0)]))],8,g)))),128))])])))),128)),!S.value&&A.value?((0,o.openBlock)(),(0,o.createElementBlock)("p",B,"加载中...")):(0,o.createCommentVNode)("",!0),S.value?((0,o.openBlock)(),(0,o.createElementBlock)("p",x,"没有更多了")):(0,o.createCommentVNode)("",!0)],8,u)),[[V,F]])])}}})}}]);