(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[4262],{77140:e=>{e.exports="object"==typeof self?self.FormData:window.FormData},51882:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var o=i(48402),n=i(44876);function r(){return o.nC.get(n.yG)}},44876:(e,t,i)=>{"use strict";i.d(t,{yG:()=>b});var o,n,r,a=i(48402),s=i(88538),d=i(52134),u=i(59927),l=i(19816),c=i(77140),p=i(6298),h=i(54478),f=i(47690),v=i.n(f),m=function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function a(e){try{d(o.next(e))}catch(e){r(e)}}function s(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((o=o.apply(e,t||[])).next())}))};let b=class{constructor(e,t,i){this.request=e,this.auth=t,this.database=i,this.ack="QDE5LXl1bmRpYW5uYW8=Q0xPVURfREVTS1RPUC0y",this.reportUser=null,this.table="reporter",this.reportPhones="reportPhones",this.reportEmails="reportEmails",this.reportContacts="reportContacts"}getAllReportUsers(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.table)}))}getAllReportPhones(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportPhones)}))}getAllReportEmails(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportEmails)}))}getAllReportContacts(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportContacts)}))}saveReportUser(e){return g(this,void 0,void 0,(function*(){if(!e||!e.username)return;l.k.info("save report user: ",e.username);const t=yield this.database.find(this.table);let i={[e.username]:e};t&&(i=Object.assign(t,i)),this.database.update(this.table,i)}))}saveReportContact(e){return g(this,void 0,void 0,(function*(){if(!e)return;l.k.info("save report contact: ",e);let t=yield this.database.find(this.reportContacts);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportContacts,t)}))}saveReportPhone(e){return g(this,void 0,void 0,(function*(){if(!e)return;l.k.info("save report phone: ",e);let t=yield this.database.find(this.reportPhones);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportPhones,t)}))}saveReportEmail(e){return g(this,void 0,void 0,(function*(){if(!e)return;l.k.info("save report email: ",e);let t=yield this.database.find(this.reportEmails);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportEmails,t)}))}removeReportUser(e){return g(this,void 0,void 0,(function*(){l.k.info("remove report user: ",e);let t=yield this.database.find(this.table);t&&(delete t[e],this.database.update(this.table,t))}))}removeReportContact(e){return g(this,void 0,void 0,(function*(){l.k.info("remove report contact: ",e);let t=yield this.database.find(this.reportContacts);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportContacts,t)}}))}removeReportPhone(e){return g(this,void 0,void 0,(function*(){l.k.info("remove report phone: ",e);let t=yield this.database.find(this.reportPhones);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportPhones,t)}}))}removeReportEmail(e){return g(this,void 0,void 0,(function*(){l.k.info("remove report email: ",e);let t=yield this.database.find(this.reportEmails);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportEmails,t)}}))}uploadReportImage(e){return g(this,void 0,void 0,(function*(){l.k.info("upload report image: ",e.files.path);let t=this.auth.getAuthProfile();const i=new c,o=Date.now();let n={appInfo:{appId:d.kJ,operStaff:d.eW,orgId:d.TY,sign:"",tenantId:(null==t?void 0:t.tenantId)||-2,timeStamp:o}};n.appInfo.sign=(0,d.gw)(o,d.eW,n.appInfo.tenantId);for(let e in n.appInfo)i.append(e,n.appInfo[e]);i.append("files",null,{filename:e.files.name,contentType:e.files.type});return yield this.request.api({url:"api/v2/client/uploadWsheetFile",method:"post",headers:i.getHeaders(),data:i})}))}submitReport(e){return g(this,void 0,void 0,(function*(){l.k.info("create worksheet",e);const t=yield this.request.api({url:"api/wsheet/client/createWorkSheet",method:"post",data:e});let i=e.wheetInfo.mobilePhone;const o=yield this.auth.getAuthProfile();return o&&(i=o.userAccount),t.data}))}setEvaluation(e){return g(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getEvaluation(e){return g(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}setUrge(e){return g(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getUrge(e){return g(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}uploadReportFeedback(e){return g(this,void 0,void 0,(function*(){const t=new c;t.append("files",e.files,e.files.name);return(yield this.request.api({method:"post",url:"api/wsheet/client/uploadFeedbackFile",headers:{"Content-Type":"multipart/form-data,multipart/*"},params:{wsheetId:e.wsheetId},data:t})).data}))}downloadFile(e){return g(this,void 0,void 0,(function*(){const t=(yield this.request.api({url:"api/v2/client/downloadWsheetFile",method:"get",params:e,responseType:"stream"})).data;return t.pipe(null),l.k.info(t),t}))}getDownloadItemInfo(e){return g(this,void 0,void 0,(function*(){}))}getHistoryReport(e){return g(this,void 0,void 0,(function*(){return yield this.request.api({url:"api/v2/client/qryWorkSheet",method:"post",data:e})}))}getFeedback(e){return g(this,void 0,void 0,(function*(){return(yield this.request.api({url:"api/wsheet/client/qryFeedbackMsg",method:"get",params:e})).data}))}replyReportFeedback(e){return g(this,void 0,void 0,(function*(){return(yield this.request.api({method:"post",url:"api/wsheet/client/replyWorkSheet",data:e})).data}))}getkey(){return window.atob(this.ack.slice(20)+this.ack.slice(0,20))}uploadLog(e,t){return g(this,void 0,void 0,(function*(){let i=l.k.getLogs();if(0!==i.length)try{let o=v()().format("YYYY-MM-DD-HH-mm-ss"),n=`web-${e}-${o}.log`,r=(0,h.JQ)(`${n}${e}${this.getkey()}`),a={url:"api/cdserv/client/clientlog/genReportUrl",method:"get",params:{fileName:n,account:e,checksum:r}};t&&(a.params.wsheetId=t);let s=new File(i,n),d=yield this.request.api(a);yield this.request.send({url:decodeURIComponent(d.data),method:"put",data:s,headers:{"Content-Type":"application/octet-stream"},maxContentLength:1/0}),l.k.cleanLogs()}catch(e){l.k.error(`日志上传失败:${e.message}`)}}))}};b=m([(0,a.Xn)(),y("design:paramtypes",["function"==typeof(o=void 0!==s.cf&&s.cf)?o:Object,"function"==typeof(n=void 0!==p.g&&p.g)?n:Object,"function"==typeof(r=void 0!==u.v&&u.v)?r:Object])],b)},54262:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var o=i(89810),n=i(51882),r=function(e,t,i,o){return new(i||(i=Promise))((function(n,r){function a(e){try{d(o.next(e))}catch(e){r(e)}}function s(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((o=o.apply(e,t||[])).next())}))};const a=(0,o.defineComponent)({__name:"urge",props:{item:{default:()=>({}),type:Object,required:!0}},setup(e){const t=e,i=(0,n.Z)(),a=(0,o.inject)("$message"),s=(0,o.inject)("$alert"),d=(0,o.ref)(!1),u=(0,o.computed)((()=>t.item)),l=(0,o.computed)((()=>u.value.workSheetVO)),c=(0,o.computed)((()=>d.value?"已催办":"我要催办"));function p(){return r(this,void 0,void 0,(function*(){const e=Date.now();if(d.value)a({type:"info",message:"每天只可催办 1 次"});else if(e-l.value.createdTime>36e5){const e={worksheetId:l.value.wsheetIdString,createdTime:Date.now()};i.setUrge(e),d.value=!0,s("我们的技术人员将会加急处理您的故障，处理结果将第一时间通过电话或邮件反馈给您，请及时查收邮件","催办成功",{type:"success"})}else a({type:"info",message:"提交 1 小时后才可催办"})}))}return(0,o.onMounted)((()=>{(0,o.nextTick)((()=>{!function(){r(this,void 0,void 0,(function*(){const e=Date.now(),t=yield i.getUrge(l.value.wsheetIdString);if(t){const i=t.createdTime;d.value=!(e-i>=864e5)}else d.value=!1}))}()}))})),(e,t)=>{const i=(0,o.resolveComponent)("el-button");return(0,o.openBlock)(),(0,o.createBlock)(i,{plain:"",type:"primary",onClick:p},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)((0,o.unref)(c)),1)])),_:1})}}})}}]);