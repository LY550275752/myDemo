"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[4525],{17008:(e,t,o)=>{o.d(t,{A:()=>p});var n=o(6522),i=o(88538),a=o(6298),l=o(55304),c=o(48402);Symbol("Device");var r,d,s,u,m=function(e,t,o,n){var i,a=arguments.length,l=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(l=(a<3?i(l):a>3?i(t,o,l):i(t,o))||l);return a>3&&l&&Object.defineProperty(t,o,l),l},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function l(e){try{r(n.next(e))}catch(e){a(e)}}function c(e){try{r(n.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,c)}r((n=n.apply(e,t||[])).next())}))};let p=class{constructor(e,t,o,n){this.Env=e,this.Auth=t,this.Desktop=o,this.Request=n,this.windowName="device",this.registerListeners()}registerListeners(){}bind(e){return v(this,void 0,void 0,(function*(){let t={verificationCode:e,deviceName:this.Env.getDeviceName(),deviceCode:this.Env.getDeviceCode(),deviceModel:this.Env.getDeviceModel(),sysVersion:this.Env.getOSVersion(),appVersion:this.Env.getAppVersion(),hostName:this.Env.getHostName(),deviceInfo:window.navigator.platform||"WebBrowser"},o=yield this.Request.api({method:"POST",url:"api/cdserv/client/device/binding",params:t,headers:{NEED_SIGN:!0,"Content-Type":"application/x-www-form-urlencoded"}});return this.Auth.updateAuthProfile({bondedDevice:!0}),this.Auth.saveAccountData(),o.data}))}unbind(){return v(this,void 0,void 0,(function*(){return!1}))}getBindCaptchaCode(e){return v(this,void 0,void 0,(function*(){if(!this.Auth.getAuthProfile())throw new Error("帐号未登录");return yield this.Request.api({method:"GET",url:"api/auth/client/validateCode/captcha",params:Object.assign(Object.assign({},e),{_t:Date.now()}),responseType:"blob"})}))}sendBindSMSCode(e){return v(this,void 0,void 0,(function*(){if(!this.Auth.getAuthProfile())throw new Error("帐号未登陆");return(yield this.Request.api({url:"api/cdserv/client/device/getSmsCode",method:"GET",params:e,headers:{NEED_SIGN:!0}})).data}))}};p=m([(0,c.Xn)(),f("design:paramtypes",["function"==typeof(r=void 0!==n.Xb&&n.Xb)?r:Object,"function"==typeof(d=void 0!==a.g&&a.g)?d:Object,"function"==typeof(s=void 0!==l.hD&&l.hD)?s:Object,"function"==typeof(u=void 0!==i.cf&&i.cf)?u:Object])],p)},84525:(e,t,o)=>{o.r(t),o.d(t,{default:()=>D});var n=o(89810),i=o(73827),a=o(6298),l=o(17008),c=o(48402),r=o(5341),d=function(e,t,o,n){return new(o||(o=Promise))((function(i,a){function l(e){try{r(n.next(e))}catch(e){a(e)}}function c(e){try{r(n.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,c)}r((n=n.apply(e,t||[])).next())}))};const s=e=>((0,n.pushScopeId)("data-v-249c689e"),e=e(),(0,n.popScopeId)(),e),u={class:"box"},m=s((()=>(0,n.createElementVNode)("p",{class:"box-desc"},"在此设备登录需要认证身份；请使用登记的电话号码验证登录",-1))),f={class:"box-form"},v={class:"box-form-item"},p={key:0,class:"form-item-label"},h={class:"box-form-item"},b={key:0,class:"form-item-label"},y={class:"box-form-item-code"},k=["src"],g={key:1,class:"mask"},C=[s((()=>(0,n.createElementVNode)("i",{class:"el-icon-loading"},null,-1)))],V={class:"box-form-item"},w={key:0,class:"form-item-label"},N={key:0},E={key:1},x={key:0,class:"box-form-item"},B=(0,n.defineComponent)({__name:"deviceBind",setup(e){const t=(0,r.mL)(),o=c.nC.get(a.g),s=c.nC.get(l.A);let B=(0,n.reactive)(null);const D=(0,n.inject)("$dialogHelper"),_=(0,n.reactive)({phone:"",code:"",sms:""}),j=(0,n.ref)(""),A=(0,n.ref)(!1),S=(0,n.ref)(!1),O=((0,n.ref)(0),(0,n.ref)(!1)),R=(0,n.ref)(!1),P=(0,n.ref)(0),T=(0,n.ref)(0);function z(){return d(this,void 0,void 0,(function*(){try{P.value=0,T.value=Date.now(),_.code="";const e=yield s.getBindCaptchaCode({width:120,height:40});j.value=URL.createObjectURL(new Blob([e.data],{type:"image/jpeg"}))}catch(e){}}))}function I(){return d(this,void 0,void 0,(function*(){if(B&&!(R.value||P.value>0||O.value))if(""!==_.code){R.value=!0;try{yield s.sendBindSMSCode({mobilePhone:B.mobilephone,captchaCode:_.code}),T.value=Date.now()+6e4,M()}catch(e){z(),i.z8.error(e.message)}finally{R.value=!1}}else i.z8.error("请输入图形验证码")}))}function M(){P.value=Math.ceil((T.value-Date.now())/1e3),P.value>0&&setTimeout((()=>{M()}),1e3)}function L(){return d(this,void 0,void 0,(function*(){if(!O.value&&B)if(_.sms.trim()){O.value=!0;try{const e=yield s.bind(_.sms.trim());(0,n.nextTick)((()=>{D.close(e)}))}catch(e){z(),_.sms="",_.code="",P.value=0,i.z8.error(e.message)}finally{O.value=!1}}else i.z8.error("请输入短信验证码")}))}return(0,n.onMounted)((()=>d(this,void 0,void 0,(function*(){B=yield o.getAuthProfile(),D.config({title:"登录验证"}),B&&(_.phone=B.mobilephone),z()})))),(e,o)=>{const i=(0,n.resolveComponent)("el-input"),a=(0,n.resolveComponent)("el-link"),l=(0,n.resolveComponent)("el-button");return(0,n.openBlock)(),(0,n.createElementBlock)("section",u,[m,(0,n.createElementVNode)("div",f,[(0,n.createElementVNode)("div",v,[(0,n.unref)(t)?((0,n.openBlock)(),(0,n.createElementBlock)("label",p,"手机号")):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(i,{disabled:!0,modelValue:_.phone,"onUpdate:modelValue":o[0]||(o[0]=e=>_.phone=e)},null,8,["modelValue"])]),(0,n.createElementVNode)("div",h,[(0,n.unref)(t)?((0,n.openBlock)(),(0,n.createElementBlock)("label",b,"图形码")):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(i,{placeholder:"请输入图形验证码",modelValue:_.code,"onUpdate:modelValue":o[1]||(o[1]=e=>_.code=e)},{suffix:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",y,[j.value.length>0?((0,n.openBlock)(),(0,n.createElementBlock)("img",{key:0,onClick:z,class:"img",src:j.value,alt:""},null,8,k)):(0,n.createCommentVNode)("",!0),A.value?((0,n.openBlock)(),(0,n.createElementBlock)("div",g,C)):(0,n.createCommentVNode)("",!0),S.value?((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:2,onClick:z,class:"mask"},[(0,n.createVNode)(a,{underline:!1,class:"captcha-error",type:"danger"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("获取失败，点击重试")])),_:1})])):(0,n.createCommentVNode)("",!0)])])),_:1},8,["modelValue"])]),(0,n.createElementVNode)("div",V,[(0,n.unref)(t)?((0,n.openBlock)(),(0,n.createElementBlock)("label",w,"验证码")):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(i,{placeholder:"请输入短信验证码",disabled:O.value,modelValue:_.sms,"onUpdate:modelValue":o[2]||(o[2]=e=>_.sms=e)},{suffix:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{onClick:I,loading:R.value,disabled:P.value>0||O.value,type:"text",class:"box-form-item-sms"},{default:(0,n.withCtx)((()=>[P.value>0?((0,n.openBlock)(),(0,n.createElementBlock)("span",N,(0,n.toDisplayString)(P.value)+"秒后重试 ",1)):((0,n.openBlock)(),(0,n.createElementBlock)("span",E,"发送验证码"))])),_:1},8,["loading","disabled"])])),_:1},8,["disabled","modelValue"])]),(0,n.unref)(t)?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createElementBlock)("div",x,[(0,n.createVNode)(l,{loading:O.value,type:"primary",size:"medium",class:"box-form-item-submit",onClick:L},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 确定 ")])),_:1},8,["loading"])]))]),(0,n.unref)(t)?((0,n.openBlock)(),(0,n.createBlock)(l,{key:0,loading:O.value,type:"primary",size:"medium",class:"box-form-item-submit",onClick:L},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 确定 ")])),_:1},8,["loading"])):(0,n.createCommentVNode)("",!0)])}}});const D=(0,o(57775).Z)(B,[["__scopeId","data-v-249c689e"]])}}]);