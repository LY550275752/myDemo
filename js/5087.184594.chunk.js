"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[5087],{77770:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});var l=a(89810),o=a(39093),r=a(88533);const c=(0,l.defineComponent)({__name:"back",props:{from:{default:"list",type:String}},setup(e){const t=e;function a(){r.$x.emit("change-report-page",{to:t.from})}return(e,t)=>{const r=(0,l.resolveComponent)("el-icon");return(0,l.openBlock)(),(0,l.createElementBlock)("div",{class:"back",onClick:a},[(0,l.createVNode)(r,null,{default:(0,l.withCtx)((()=>[(0,l.createVNode)((0,l.unref)(o.Z))])),_:1})])}}});const n=(0,a(57775).Z)(c,[["__scopeId","data-v-5be2a57c"]])},16013:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var l=a(89810),o=a(8770),r=a(55516),c=a(35393),n=a(88533);const i={key:0,class:"iconfont icon-user"},u={class:"info"},s={class:"who mb-2 fs-12"},d={class:"desc mb-2 d-flex align-center"},m={key:0,class:"text fs-12"},f={style:{direction:"ltr"}},v={class:"image-slot"},p={key:0,class:"replying mr-2"},k={class:"time my-4"},g=(0,l.defineComponent)({__name:"feedbackItem",props:{item:{default:()=>({}),type:Object,required:!0}},setup(e){const t=e,a=(0,l.ref)([]),g=(0,l.inject)("$filter"),y=(0,l.computed)((()=>t.item)),h=(0,l.computed)((()=>2===y.value.feedbackSource)),b=(0,l.computed)((()=>2===y.value.feedbackSource?"我":0===y.value.feedbackSource?"客服":3===y.value.feedbackSource?"运维":"-"));function N(){n.$x.emit("init-report-feedback",y.value)}return(0,l.onMounted)((()=>{y.value.feedbackAttach&&(y.value.feedbackAttach.match("data:image")?a.value=[y.value.feedbackAttach]:a.value=y.value.feedbackAttach.split(","))})),(e,t)=>{const n=(0,l.resolveComponent)("el-icon"),V=(0,l.resolveComponent)("el-image");return(0,l.openBlock)(),(0,l.createElementBlock)("div",{class:(0,l.normalizeClass)(["feedbackItem",(0,l.unref)(h)&&"is-reverse"])},[(0,l.createElementVNode)("div",{class:(0,l.normalizeClass)(["avatar",(0,l.unref)(h)&&"primary"])},[(0,l.unref)(h)?((0,l.openBlock)(),(0,l.createElementBlock)("i",i)):(0,l.createCommentVNode)("",!0)],2),(0,l.createElementVNode)("div",u,[(0,l.createElementVNode)("div",s,(0,l.toDisplayString)((0,l.unref)(b)),1),(0,l.createElementVNode)("div",d,[(0,l.createElementVNode)("div",null,[(0,l.unref)(y).feedbackMsg?((0,l.openBlock)(),(0,l.createElementBlock)("div",m,[(0,l.createElementVNode)("span",f,(0,l.toDisplayString)((0,l.unref)(y).feedbackMsg),1)])):(0,l.createCommentVNode)("",!0),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(a.value,((e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)("div",{key:t,class:"imageItem"},[e?((0,l.openBlock)(),(0,l.createBlock)(V,{key:0,class:"img",src:e,fix:"cover"},{error:(0,l.withCtx)((()=>[(0,l.createElementVNode)("div",v,[(0,l.createVNode)(n,null,{default:(0,l.withCtx)((()=>[(0,l.createVNode)((0,l.unref)(o.Z))])),_:1})])])),_:2},1032,["src"])):(0,l.createCommentVNode)("",!0)])))),128))]),(0,l.unref)(h)&&(0,l.unref)(y).replying?((0,l.openBlock)(),(0,l.createElementBlock)("div",p,[(0,l.createVNode)(n,{class:"is-loading",size:"16"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)((0,l.unref)(r.Z))])),_:1})])):(0,l.createCommentVNode)("",!0),(0,l.unref)(h)&&(0,l.unref)(y).retry?((0,l.openBlock)(),(0,l.createElementBlock)("div",{key:1,class:"retry mr-2",onClick:N},[(0,l.createVNode)(n,{color:"red",size:"16"},{default:(0,l.withCtx)((()=>[(0,l.createVNode)((0,l.unref)(c.Z))])),_:1})])):(0,l.createCommentVNode)("",!0)]),(0,l.createElementVNode)("div",k,(0,l.toDisplayString)((0,l.unref)(g).formatTime((0,l.unref)(y).createdTime)),1)])],2)}}});const y=(0,a(57775).Z)(g,[["__scopeId","data-v-5caf6050"]])},55087:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var l=a(89810),o=a(32695),r=a(51882),c=a(16013),n=a(77770),i=a(88533),u=a(53408),s=a(5341),d=function(e,t,a,l){return new(a||(a=Promise))((function(o,r){function c(e){try{i(l.next(e))}catch(e){r(e)}}function n(e){try{i(l.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(c,n)}i((l=l.apply(e,t||[])).next())}))};const m={class:"reportFeedback"},f={class:"feedbackContent d-flex flex-column"},v={class:"loadMore"},p=(0,l.defineComponent)({__name:"feedbackList",props:{source:null,comefrom:null},setup(e){const t=e,a=(0,l.inject)("$dialogHelper"),p=(0,s.mL)(),k=(0,l.ref)([]),g=(0,l.ref)(null),y=(0,l.ref)(null),h=(0,l.ref)(0),b=(0,l.inject)("detail"),N=(0,l.inject)("$message"),V=(0,l.computed)((()=>b.value.workSheetVO||{})),B=(0,l.ref)("100%"),C=(0,r.Z)(),w=(0,l.ref)({page:1,limit:10,loading:!1,msg:"",total:0,retry:!1}),E=((0,l.computed)((()=>w.value.total<w.value.page*w.value.limit)),(0,l.computed)((()=>w.value.msg?w.value.msg:w.value.loading?"正在加载中...":w.value.total<w.value.page*w.value.limit?"没有更多数据":"点击加载更多")));function _(e){return d(this,void 0,void 0,(function*(){w.value.loading=!0,w.value.retry=!1;const t={wsheetId:V.value.wsheetIdString,pageNum:e,pageSize:w.value.limit},a=k.value.map((e=>e.replyId));try{const l=yield C.getFeedback(t);if(w.value.total=l.total,l.list.map((e=>{a.includes(e.replyId)||k.value.push(e)})),k.value.sort(((e,t)=>e.createdTime-t.createdTime)),k.value=Array.from(new Set(k.value)),w.value.loading=!1,1===e)x();else{const e=setTimeout((()=>{g.value.setScrollTop(y.value.clientHeight-h.value),h.value=y.value.clientHeight+0,clearTimeout(e)}),100)}}catch(e){w.value.msg=e.message,w.value.retry=!0,w.value.loading=!1}}))}function S(e){g.value&&(0===h.value&&(h.value=y.value.clientHeight),e.scrollTop<30&&!w.value.loading&&w.value.total>w.value.page*w.value.limit&&(w.value.page+=1,_(w.value.page)))}function x(){if(g.value){const e=setTimeout((()=>{const t=y.value.clientHeight-B.value;g.value.setScrollTop(t),clearTimeout(e)}),0)}}function I(e){e.retry=!0,e.replying=!1}function T(e){e.retry=!1,e.replying=!0}function M(e){e.retry=!1,e.replying=!1}function Z(e){return d(this,void 0,void 0,(function*(){T(e);let t={wsheetId:V.value.wsheetIdString,feedbackMsg:e.params.feedbackMsg};try{(yield C.replyReportFeedback(t))&&M(e)}catch(t){I(e),N({type:"error",message:t.message})}}))}function F(e){e.params.files?function(e){d(this,void 0,void 0,(function*(){T(e);let t={wsheetId:V.value.wsheetIdString,files:(0,l.toRaw)(e.params.files),file:e.params.file};try{const a=yield C.uploadReportFeedback(t);if(0==a.retCode){const t=yield C.replyReportFeedback({wsheetId:V.value.wsheetIdString,attachIds:a.attachIdStrings});t?M(e):(I(e),N({type:"error",message:t.msg}))}else N({type:"error",message:a.msg})}catch(t){I(e),N({type:"error",message:t.message})}}))}(e):Z(e)}return(0,l.onMounted)((()=>{(0,l.nextTick)((()=>{_(1)})),a.config({onBack:()=>i.$x.emit("change-report-page",{to:t.comefrom||"list"})})})),(0,i.pv)({"get-report-feedback":_,"init-report-feedback":function(e){const t=k.value.findIndex((t=>t.createdTime===e.createdTime));t>=0?(k.value[t]=e,F(k.value[t])):(w.value.total+=1,k.value.push(e),F(k.value[k.value.length-1])),x()},"reply-report-msg":Z}),(e,a)=>((0,l.openBlock)(),(0,l.createElementBlock)("div",m,[(0,l.unref)(p)?(0,l.createCommentVNode)("",!0):((0,l.openBlock)(),(0,l.createBlock)(n.default,{key:0,from:t.comefrom},null,8,["from"])),(0,l.createElementVNode)("div",f,[(0,l.createVNode)((0,l.unref)(u.Mr),{onScroll:S,"view-class":"feedbackScroll",height:B.value,ref_key:"scrollRef",ref:g},{default:(0,l.withCtx)((()=>[(0,l.createElementVNode)("div",{class:"feedbackList d-flex flex-column justify-start",ref_key:"scrollContentRef",ref:y},[(0,l.createElementVNode)("div",v,(0,l.toDisplayString)((0,l.unref)(E)),1),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(k.value,((e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)("div",{key:t},[(0,l.createVNode)(c.default,{item:e},null,8,["item"])])))),128))],512)])),_:1},8,["height"]),(0,l.createVNode)(o.default)])]))}});const k=(0,a(57775).Z)(p,[["__scopeId","data-v-5275f7f7"]])}}]);