"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[5802],{75802:(e,t,l)=>{l.r(t),l.d(t,{default:()=>T});var o=l(89810),a=l(48402),n=l(29671),c=l(6298),r=l(73827),i=l(5341),s=function(e,t,l,o){return new(l||(l=Promise))((function(a,n){function c(e){try{i(o.next(e))}catch(e){n(e)}}function r(e){try{i(o.throw(e))}catch(e){n(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(c,r)}i((o=o.apply(e,t||[])).next())}))};const u=e=>((0,o.pushScopeId)("data-v-eacd9184"),e=e(),(0,o.popScopeId)(),e),d={class:"device-bind"},m={key:0,class:"bind-title"},v=u((()=>(0,o.createElementVNode)("p",{class:"bind-desc"}," 为了确认您的身份，需验证手机号 ",-1))),p={class:"form"},f={class:"form-item form-item-input"},k={key:0,class:"form-item-label"},h={class:"form-item form-item-input"},V={key:0,class:"form-item-label"},y={class:"code-img"},b=["src"],C={key:0,class:"mask"},g=[u((()=>(0,o.createElementVNode)("i",{class:"el-icon-loading"},null,-1)))],N={class:"form-item form-item-input"},E={key:0,class:"form-item-label"},B={key:0},w={key:1},x={class:"form-item"},_=(0,o.defineComponent)({__name:"phoneValidate",props:{params:{type:Object,default:null}},setup(e){const t=(0,o.inject)("$dialogHelper"),l=a.nC.get(c.g),u=(0,o.inject)("$message"),{loginData:_}=(0,o.inject)("$options");let T=0,U=0;const L=(0,o.ref)("about:blank"),j=(0,o.ref)(!1),D=(0,o.ref)(!1),I=(0,o.ref)(!1),S=(0,o.ref)(0),z=(0,o.ref)(!1),P=(0,o.ref)({phone:"",code:"",sms:""}),$=(0,i.mL)();function q(e){return s(this,void 0,void 0,(function*(){if(D.value)return;D.value=!0,j.value=!1;let t={width:90,height:40,userInfo:P.value.phone};e&&(t.preUrl=L.value);try{let e=yield l.getCaptchaUrl(t);L.value=e,D.value=!1,T=0,j.value=!1}catch(e){D.value=!1,++T<3?q():(j.value=!0,T=0)}}))}function M(){let e=n.Qc(L.value,!0);e.query&&"direct"===e.query.mode?q(!0):j.value=!0}function A(){return s(this,void 0,void 0,(function*(){if(P.value.phone&&!(I.value||S.value>0||z.value))if(""!==P.value.code){I.value=!0;try{yield l.sendLoginSmsCode({mobilePhone:P.value.phone,captchaCode:P.value.code}),U=Date.now()+6e4,H()}catch(e){q(),r.z8.error(e.message)}I.value=!1}else u({type:"error",message:"请输入图形验证码"})}))}function H(){S.value=Math.ceil((U-Date.now())/1e3),S.value>0&&setTimeout((()=>{H()}),1e3)}(0,o.onMounted)((()=>{(0,o.nextTick)((()=>{t.config({title:(0,i.mL)()?"身份验证":"手机号验证"})}));let e=l.getAuthProfile();e&&(e.mobilephone&&(P.value.phone=e.mobilephone),q(),document.addEventListener("keypress",O))})),(0,o.onBeforeUnmount)((()=>{document.removeEventListener("keypress",O)}));const O=e=>{if(13===e.keyCode)Z()};function Q(){t.close()}function Z(){return s(this,void 0,void 0,(function*(){if(P.value.phone.trim())if(P.value.sms.trim())if(_){z.value=!0;try{_.smsCode=P.value.sms.trim(),yield l.login(_),(0,o.nextTick)((()=>{t.close(!0)}))}catch(e){u({type:"error",message:e.message}),P.value.sms="",q(),z.value=!1}}else u({type:"error",message:"请重新登录"});else u({type:"error",message:"请输入短信验证码"})}))}return(e,t)=>{const l=(0,o.resolveComponent)("el-input"),a=(0,o.resolveComponent)("el-link"),n=(0,o.resolveComponent)("el-button");return(0,o.openBlock)(),(0,o.createElementBlock)("section",d,[(0,o.unref)($)?((0,o.openBlock)(),(0,o.createElementBlock)("h4",m,"手机号验证")):(0,o.createCommentVNode)("",!0),v,(0,o.createElementVNode)("div",p,[(0,o.createElementVNode)("div",f,[(0,o.unref)($)?((0,o.openBlock)(),(0,o.createElementBlock)("label",k,"手机号")):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(l,{disabled:!0,modelValue:P.value.phone,"onUpdate:modelValue":t[0]||(t[0]=e=>P.value.phone=e)},null,8,["modelValue"])]),(0,o.createElementVNode)("div",h,[(0,o.unref)($)?((0,o.openBlock)(),(0,o.createElementBlock)("label",V,"图形码")):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(l,{placeholder:"请输入图形验证码",modelValue:P.value.code,"onUpdate:modelValue":t[3]||(t[3]=e=>P.value.code=e)},{suffix:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",y,[(0,o.createElementVNode)("img",{onError:M,onClick:t[1]||(t[1]=e=>q(!1)),class:"img",src:L.value,alt:""},null,40,b),D.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",C,g)):(0,o.createCommentVNode)("",!0),j.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:1,onClick:t[2]||(t[2]=e=>q(!1)),class:"mask"},[(0,o.createVNode)(a,{underline:!1,class:"captcha-error",type:"danger"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("获取失败，点击重试")])),_:1})])):(0,o.createCommentVNode)("",!0)])])),_:1},8,["modelValue"])]),(0,o.createElementVNode)("div",N,[(0,o.unref)($)?((0,o.openBlock)(),(0,o.createElementBlock)("label",E,"验证码")):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(l,{placeholder:"请输入短信验证码",disabled:z.value,modelValue:P.value.sms,"onUpdate:modelValue":t[4]||(t[4]=e=>P.value.sms=e)},{suffix:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{onClick:A,loading:I.value,disabled:S.value>0||z.value,type:"text",class:"btn-sms"},{default:(0,o.withCtx)((()=>[S.value>0?((0,o.openBlock)(),(0,o.createElementBlock)("span",B,(0,o.toDisplayString)(S.value)+"秒后重试 ",1)):((0,o.openBlock)(),(0,o.createElementBlock)("span",w,"发送验证码"))])),_:1},8,["loading","disabled"])])),_:1},8,["disabled","modelValue"])]),(0,o.createElementVNode)("div",x,[(0,o.createVNode)(n,{class:"bottom-btn cancel-btn",size:"medium",onClick:Q},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消")])),_:1}),(0,o.createVNode)(n,{loading:z.value,type:"primary",size:"medium",class:"bottom-btn",onClick:Z},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 确定 ")])),_:1},8,["loading"])])])])}}});const T=(0,l(57775).Z)(_,[["__scopeId","data-v-eacd9184"]])}}]);