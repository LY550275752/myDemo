(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[6614],{77140:e=>{e.exports="object"==typeof self?self.FormData:window.FormData},51882:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var o=i(48402),r=i(44876);function n(){return o.nC.get(r.yG)}},44876:(e,t,i)=>{"use strict";i.d(t,{yG:()=>b});var o,r,n,a=i(48402),s=i(88538),d=i(52134),l=i(59927),u=i(19816),p=i(77140),c=i(6298),h=i(54478),f=i(47690),v=i.n(f),m=function(e,t,i,o){var r,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(n<3?r(a):n>3?r(t,i,a):r(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e,t,i,o){return new(i||(i=Promise))((function(r,n){function a(e){try{d(o.next(e))}catch(e){n(e)}}function s(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}d((o=o.apply(e,t||[])).next())}))};let b=class{constructor(e,t,i){this.request=e,this.auth=t,this.database=i,this.ack="QDE5LXl1bmRpYW5uYW8=Q0xPVURfREVTS1RPUC0y",this.reportUser=null,this.table="reporter",this.reportPhones="reportPhones",this.reportEmails="reportEmails",this.reportContacts="reportContacts"}getAllReportUsers(){return y(this,void 0,void 0,(function*(){return yield this.database.find(this.table)}))}getAllReportPhones(){return y(this,void 0,void 0,(function*(){return yield this.database.find(this.reportPhones)}))}getAllReportEmails(){return y(this,void 0,void 0,(function*(){return yield this.database.find(this.reportEmails)}))}getAllReportContacts(){return y(this,void 0,void 0,(function*(){return yield this.database.find(this.reportContacts)}))}saveReportUser(e){return y(this,void 0,void 0,(function*(){if(!e||!e.username)return;u.k.info("save report user: ",e.username);const t=yield this.database.find(this.table);let i={[e.username]:e};t&&(i=Object.assign(t,i)),this.database.update(this.table,i)}))}saveReportContact(e){return y(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report contact: ",e);let t=yield this.database.find(this.reportContacts);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportContacts,t)}))}saveReportPhone(e){return y(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report phone: ",e);let t=yield this.database.find(this.reportPhones);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportPhones,t)}))}saveReportEmail(e){return y(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report email: ",e);let t=yield this.database.find(this.reportEmails);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportEmails,t)}))}removeReportUser(e){return y(this,void 0,void 0,(function*(){u.k.info("remove report user: ",e);let t=yield this.database.find(this.table);t&&(delete t[e],this.database.update(this.table,t))}))}removeReportContact(e){return y(this,void 0,void 0,(function*(){u.k.info("remove report contact: ",e);let t=yield this.database.find(this.reportContacts);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportContacts,t)}}))}removeReportPhone(e){return y(this,void 0,void 0,(function*(){u.k.info("remove report phone: ",e);let t=yield this.database.find(this.reportPhones);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportPhones,t)}}))}removeReportEmail(e){return y(this,void 0,void 0,(function*(){u.k.info("remove report email: ",e);let t=yield this.database.find(this.reportEmails);if(t){const i=t.indexOf(e);t.splice(i,1),this.database.update(this.reportEmails,t)}}))}uploadReportImage(e){return y(this,void 0,void 0,(function*(){u.k.info("upload report image: ",e.files.path);let t=this.auth.getAuthProfile();const i=new p,o=Date.now();let r={appInfo:{appId:d.kJ,operStaff:d.eW,orgId:d.TY,sign:"",tenantId:(null==t?void 0:t.tenantId)||-2,timeStamp:o}};r.appInfo.sign=(0,d.gw)(o,d.eW,r.appInfo.tenantId);for(let e in r.appInfo)i.append(e,r.appInfo[e]);i.append("files",null,{filename:e.files.name,contentType:e.files.type});return yield this.request.api({url:"api/v2/client/uploadWsheetFile",method:"post",headers:i.getHeaders(),data:i})}))}submitReport(e){return y(this,void 0,void 0,(function*(){u.k.info("create worksheet",e);const t=yield this.request.api({url:"api/wsheet/client/createWorkSheet",method:"post",data:e});let i=e.wheetInfo.mobilePhone;const o=yield this.auth.getAuthProfile();return o&&(i=o.userAccount),t.data}))}setEvaluation(e){return y(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getEvaluation(e){return y(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}setUrge(e){return y(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getUrge(e){return y(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}uploadReportFeedback(e){return y(this,void 0,void 0,(function*(){const t=new p;t.append("files",e.files,e.files.name);return(yield this.request.api({method:"post",url:"api/wsheet/client/uploadFeedbackFile",headers:{"Content-Type":"multipart/form-data,multipart/*"},params:{wsheetId:e.wsheetId},data:t})).data}))}downloadFile(e){return y(this,void 0,void 0,(function*(){const t=(yield this.request.api({url:"api/v2/client/downloadWsheetFile",method:"get",params:e,responseType:"stream"})).data;return t.pipe(null),u.k.info(t),t}))}getDownloadItemInfo(e){return y(this,void 0,void 0,(function*(){}))}getHistoryReport(e){return y(this,void 0,void 0,(function*(){return yield this.request.api({url:"api/v2/client/qryWorkSheet",method:"post",data:e})}))}getFeedback(e){return y(this,void 0,void 0,(function*(){return(yield this.request.api({url:"api/wsheet/client/qryFeedbackMsg",method:"get",params:e})).data}))}replyReportFeedback(e){return y(this,void 0,void 0,(function*(){return(yield this.request.api({method:"post",url:"api/wsheet/client/replyWorkSheet",data:e})).data}))}getkey(){return window.atob(this.ack.slice(20)+this.ack.slice(0,20))}uploadLog(e,t){return y(this,void 0,void 0,(function*(){let i=u.k.getLogs();if(0!==i.length)try{let o=v()().format("YYYY-MM-DD-HH-mm-ss"),r=`web-${e}-${o}.log`,n=(0,h.JQ)(`${r}${e}${this.getkey()}`),a={url:"api/cdserv/client/clientlog/genReportUrl",method:"get",params:{fileName:r,account:e,checksum:n}};t&&(a.params.wsheetId=t);let s=new File(i,r),d=yield this.request.api(a);yield this.request.send({url:decodeURIComponent(d.data),method:"put",data:s,headers:{"Content-Type":"application/octet-stream"},maxContentLength:1/0}),u.k.cleanLogs()}catch(e){u.k.error(`日志上传失败:${e.message}`)}}))}};b=m([(0,a.Xn)(),g("design:paramtypes",["function"==typeof(o=void 0!==s.cf&&s.cf)?o:Object,"function"==typeof(r=void 0!==c.g&&c.g)?r:Object,"function"==typeof(n=void 0!==l.v&&l.v)?n:Object])],b)},86614:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l});var o=i(89810),r=i(51882),n=i(88533);const a={class:"uploadFile"},s=["accept"],d=(0,o.defineComponent)({__name:"uploadFile",setup(e){(0,r.Z)();const t=(0,o.ref)(),i=(0,o.inject)("detail"),d=(0,o.computed)((()=>i.value&&i.value.workSheetVO||{})),l=(0,o.ref)("image/png, image/jpg, image/jpeg"),u=(0,o.inject)("$message");return(e,i)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",a,[(0,o.createElementVNode)("input",{type:"file",ref_key:"file",ref:t,name:"files",onChange:i[0]||(i[0]=e=>function(e){if(!e)return;const t=e.size/1024/1024<5;if("image/jpeg"!==e.type&&"image/png"!==e.type&&"image/jpg"!==e.type)return u({type:"error",message:"只能上传 jpg/png 格式的图片"}),!1;if(!t)return u({type:"error",message:"上传图片大小不能超过 5MB!"}),!1;let i="",o=new FileReader;o.readAsDataURL(e),o.onload=()=>{i=o.result;const t={params:{id:d.value.wsheetIdString,files:e},createdTime:Date.now(),feedbackSource:2,feedbackAttach:o.result,feedbackMsg:"",replying:!0,retry:!1};n.$x.emit("init-report-feedback",t)}}(e.target.files[0])),accept:l.value,id:"files",style:{display:"none"}},null,40,s),(0,o.createElementVNode)("i",{class:"iconfont icon-folder",onClick:i[1]||(i[1]=e=>(0,o.unref)(t).click())})]))}});const l=(0,i(57775).Z)(d,[["__scopeId","data-v-25207b19"]])}}]);