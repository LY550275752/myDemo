"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[6675],{80050:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var o=a(89810),l=a(65431),r=a(92720),n=a(14957),d=a(52704),s=(a(52719),a(3147),a(9021)),u=a(63135),i=a(10111),p=a(60685),c=a(92518),f=function(e,t,a,o){return new(a||(a=Promise))((function(l,r){function n(e){try{s(o.next(e))}catch(e){r(e)}}function d(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(n,d)}s((o=o.apply(e,t||[])).next())}))};const m={class:"reportContainer fill-height",style:{overflow:"auto"}},h=(0,o.createElementVNode)("div",{class:"my-4",style:{"border-top":"1px solid #f5f7fa"}},null,-1),v={style:{background:"#f5f7fa"},class:"pa-4"},g=(0,o.defineComponent)({__name:"Report",setup(e){const t=(0,s.C)(),a=((0,i.l)(),(0,u.R)()),{authData:g,logged:w}=(0,l.Jk)(t),{reportType:V,loadingDesktops:C,reportDesktop:b,reportDesktops:k,reportDesktopText:x,reporting:N,reportContact:y,reportPhone:R,reportEmail:_,reportTypeText:F,reportFiles:D,reportTypes:B,reportDesc:U,reportUserName:T}=(0,l.Jk)(a),E=(0,o.ref)(!1),q=(0,o.ref)(!1),P=(0,o.ref)(null),j=(0,o.computed)((()=>(0,r.cloneDeep)(k.value).map((e=>(b.value&&e.id===b.value.id&&(e.className="active",e.color="#2896FF"),e))))),S=(0,o.computed)((()=>(0,r.cloneDeep)(B.value).map((e=>(V.value&&e.id===V.value.id&&(e.className="active",e.color="#2896FF"),e))))),Z=(0,o.ref)({reportUserName:"",reportTypeText:"",reportDesc:"",reportContact:"",reportPhone:"",reportEmail:""});function z(){E.value=!0}function I(e){a.updateReportType(e),E.value=!1}function O(){q.value=!0}function J(e){a.updateReportDesktop(e),q.value=!1}function M(){return f(this,void 0,void 0,(function*(){a.submitReport()}))}return(0,o.watch)(w,(e=>{e&&(a.getReportDesktops(),a.initReporter())})),(0,o.onMounted)((()=>{w.value&&a.getReportDesktops(),a.initReporter()})),(e,t)=>{const l=(0,o.resolveComponent)("el-input"),r=(0,o.resolveComponent)("el-form-item"),s=(0,o.resolveComponent)("el-form"),u=(0,o.resolveComponent)("el-button");return(0,o.openBlock)(),(0,o.createElementBlock)("div",m,[(0,o.createVNode)(p.Z,{title:"报障受理",class:"fill-width mb-4"}),(0,o.createVNode)(s,{class:"pa-4 white fill-width","show-message":!1,"label-width":"80px",model:Z.value,size:"large"},{default:(0,o.withCtx)((()=>[(0,o.unref)(w)?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(r,{key:0,class:"white",label:"用户名","show-required":"",prop:"reportUserName"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{modelValue:(0,o.unref)(T),"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.isRef)(T)?T.value=e:null),placeholder:"请输入您的用户名",clearable:"",onChange:(0,o.unref)(a).updateReportUserName,disabled:e.resporting},null,8,["modelValue","onChange","disabled"])])),_:1})),(0,o.createVNode)(r,{class:"white",label:"故障类型","show-required":"",prop:"reportTypeText"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{placeholder:"请选择故障类型",onFocus:z,modelValue:(0,o.unref)(F),"onUpdate:modelValue":t[1]||(t[1]=e=>(0,o.isRef)(F)?F.value=e:null),readonly:"",disabled:e.resporting},null,8,["modelValue","disabled"]),(0,o.createVNode)((0,o.unref)(n.V),{show:E.value,"onUpdate:show":t[2]||(t[2]=e=>E.value=e),actions:(0,o.unref)(S),"cancel-text":"取消",description:"请选择故障类型",onSelect:I},null,8,["show","actions"])])),_:1}),(0,o.unref)(w)?((0,o.openBlock)(),(0,o.createBlock)(r,{key:1,class:"white",label:"选择桌面"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{placeholder:"请选择故障桌面",onFocus:O,modelValue:(0,o.unref)(x),"onUpdate:modelValue":t[3]||(t[3]=e=>(0,o.isRef)(x)?x.value=e:null),readonly:"",disabled:e.resporting},null,8,["modelValue","disabled"]),(0,o.createVNode)((0,o.unref)(n.V),{show:q.value,"onUpdate:show":t[4]||(t[4]=e=>q.value=e),actions:(0,o.unref)(j),"cancel-text":"取消",description:"请选择故障桌面",onSelect:J},null,8,["show","actions"])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(r,{class:"white",label:"故障描述","show-required":"",prop:"reportDesc"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{modelValue:(0,o.unref)(U),"onUpdate:modelValue":t[5]||(t[5]=e=>(0,o.isRef)(U)?U.value=e:null),type:"textarea",rows:3,placeholder:"请输入故障的情况",maxlength:"2000","show-word-limit":"",onChange:(0,o.unref)(a).updateReportDesc,disabled:e.resporting},null,8,["modelValue","onChange","disabled"])])),_:1}),(0,o.createVNode)(r,{class:"white",label:"上传图片"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c.Z,{ref_key:"uploader",ref:P},null,512)])),_:1}),h,(0,o.createVNode)(r,{class:"white",label:"联系人","show-required":"",prop:"reportContact"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{modelValue:(0,o.unref)(y),"onUpdate:modelValue":t[6]||(t[6]=e=>(0,o.isRef)(y)?y.value=e:null),placeholder:"请输入您的称呼",onChange:(0,o.unref)(a).updateReportContact,disabled:e.resporting},null,8,["modelValue","onChange","disabled"])])),_:1}),(0,o.createVNode)(r,{class:"white",label:"电话","show-required":"",prop:"reportPhone"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{modelValue:(0,o.unref)(R),"onUpdate:modelValue":t[7]||(t[7]=e=>(0,o.isRef)(R)?R.value=e:null),placeholder:"请输入电话号码",onChange:(0,o.unref)(a).updateReportPhone,disabled:e.resporting},null,8,["modelValue","onChange","disabled"])])),_:1}),(0,o.createVNode)(r,{class:"white",label:"邮箱","show-required":"",prop:"reportEmail"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{modelValue:(0,o.unref)(_),"onUpdate:modelValue":t[8]||(t[8]=e=>(0,o.isRef)(_)?_.value=e:null),placeholder:"请输入邮箱地址",onChange:(0,o.unref)(a).updateReportEmail,disabled:e.resporting},null,8,["modelValue","onChange","disabled"])])),_:1})])),_:1},8,["model"]),(0,o.createVNode)((0,o.unref)(d.L),{position:"bottom"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",v,[(0,o.createVNode)(u,{block:"",type:"primary",onClick:M,style:{"box-sizing":"border-box"},size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("提交")])),_:1})])])),_:1})])}}})},60685:(e,t,a)=>{a.d(t,{Z:()=>c});var o=a(89810),l=a(5415),r=a(17999),n=a(52704);a(3147);const d={class:"d-flex justify-space-between align-center white pa-4"},s={class:"fs-18 grey--text text--darken-4"},u=(i=()=>(0,o.createElementVNode)("div",null,null,-1),(0,o.pushScopeId)("data-v-86040814"),i=i(),(0,o.popScopeId)(),i);var i;const p=(0,o.defineComponent)({__name:"header",props:{title:{default:"",type:String}},setup(e){const t=(0,r.tv)(),a=(0,o.useAttrs)();function i(){a.onBack?a.onBack():window.history.state?window.history.go(-1):t.replace({name:"phone_home",query:{module:"phone"}})}return(t,a)=>{const r=(0,o.resolveComponent)("el-icon");return(0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(n.L),{class:"fill-width"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("header",d,[(0,o.createVNode)(r,{class:"pointer iconBack",onClick:i},{default:(0,o.withCtx)((()=>[(0,o.createVNode)((0,o.unref)(l.Z))])),_:1}),(0,o.createElementVNode)("div",s,(0,o.toDisplayString)(e.title),1),u])])),_:1})}}});const c=(0,a(57775).Z)(p,[["__scopeId","data-v-86040814"]])},92518:(e,t,a)=>{a.d(t,{Z:()=>f});var o=a(89810),l=a(64566),r=a(84117),n=(a(84298),a(71755),a(91459),a(15807),a(54199),a(39094),a(23582),a(69942),a(48402)),d=a(6522),s=a(6298),u=a(41461),i=a.n(u),p=a(63135),c=a(65431);const f=(0,o.defineComponent)({__name:"uploader",setup(e,{expose:t}){const a=n.nC.get(d.Xb),u=(n.nC.get(s.g),(0,o.ref)("image/jpg,image/png,image/jpeg")),f=(0,p.R)(),{reportData:m,reportHeaders:h}=(0,c.Jk)(f),v=(0,o.ref)([]),g=(0,o.computed)((()=>`${a.getAPIHost()}/api/v2/client/uploadWsheetFile`));function w(e,t){return f.deleteReportFiles(t.index),!0}function V(e,t){let a=new FormData;if(m.value){const e=m.value;Object.keys(m.value).forEach((t=>{a.append(t,e[t])}))}e.length?e.map(((e,t)=>{e.status="uploading",e.message="上传中...",a.append("files",e.file),i().post(g.value,a,{headers:Object.assign({"Content-Type":"multipart/form-data"},(0,o.toRaw)(h.value))}).then((a=>{a.data.code?(l.F.fail(a.data.msg),e.status="failed",e.message="上传失败"):(e.status="done",f.addReportFiles({index:t,value:a.data.data}))})).catch((t=>{e.status="failed",e.message="上传失败",l.F.fail(t.message)}))})):(e.status="uploading",e.message="上传中...",a.append("files",e.file),i().post(g.value,a,{headers:Object.assign({"Content-Type":"multipart/form-data"},(0,o.toRaw)(h.value))}).then((t=>{t.data.code?(l.F.fail(t.data.msg),e.status="failed",e.message="上传失败"):(e.status="done",f.addReportFiles({value:t.data.data}))})).catch((t=>{e.status="failed",e.message="上传失败",l.F.fail(t.message)})))}function C(e){return!0}function b(){(0,l.F)("上传图片大小不能超过 5MB!")}return(0,o.onMounted)((()=>{f.initReportParams()})),t({uploadFiles:v}),(e,t)=>((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(r.Q),{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),"max-count":3,multiple:"","after-read":V,"before-read":C,accept:u.value,"max-size":5242880,name:"files",onOversize:b,"before-delete":w},null,8,["modelValue","accept"]))}})}}]);