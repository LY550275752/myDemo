(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[6698,2773],{77140:e=>{e.exports="object"==typeof self?self.FormData:window.FormData},86631:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});var i=o(48402),n=o(6298);function r(){return i.nC.get(n.g)}},11210:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});var i=o(48402),n=o(6522);function r(){return i.nC.get(n.Xb)}},51882:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});var i=o(48402),n=o(44876);function r(){return i.nC.get(n.yG)}},44876:(e,t,o)=>{"use strict";o.d(t,{yG:()=>b});var i,n,r,a=o(48402),s=o(88538),l=o(52134),d=o(59927),c=o(19816),u=o(77140),p=o(6298),f=o(54478),h=o(47690),m=o.n(h),v=function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))};let b=class{constructor(e,t,o){this.request=e,this.auth=t,this.database=o,this.ack="QDE5LXl1bmRpYW5uYW8=Q0xPVURfREVTS1RPUC0y",this.reportUser=null,this.table="reporter",this.reportPhones="reportPhones",this.reportEmails="reportEmails",this.reportContacts="reportContacts"}getAllReportUsers(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.table)}))}getAllReportPhones(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportPhones)}))}getAllReportEmails(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportEmails)}))}getAllReportContacts(){return g(this,void 0,void 0,(function*(){return yield this.database.find(this.reportContacts)}))}saveReportUser(e){return g(this,void 0,void 0,(function*(){if(!e||!e.username)return;c.k.info("save report user: ",e.username);const t=yield this.database.find(this.table);let o={[e.username]:e};t&&(o=Object.assign(t,o)),this.database.update(this.table,o)}))}saveReportContact(e){return g(this,void 0,void 0,(function*(){if(!e)return;c.k.info("save report contact: ",e);let t=yield this.database.find(this.reportContacts);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportContacts,t)}))}saveReportPhone(e){return g(this,void 0,void 0,(function*(){if(!e)return;c.k.info("save report phone: ",e);let t=yield this.database.find(this.reportPhones);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportPhones,t)}))}saveReportEmail(e){return g(this,void 0,void 0,(function*(){if(!e)return;c.k.info("save report email: ",e);let t=yield this.database.find(this.reportEmails);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportEmails,t)}))}removeReportUser(e){return g(this,void 0,void 0,(function*(){c.k.info("remove report user: ",e);let t=yield this.database.find(this.table);t&&(delete t[e],this.database.update(this.table,t))}))}removeReportContact(e){return g(this,void 0,void 0,(function*(){c.k.info("remove report contact: ",e);let t=yield this.database.find(this.reportContacts);if(t){const o=t.indexOf(e);t.splice(o,1),this.database.update(this.reportContacts,t)}}))}removeReportPhone(e){return g(this,void 0,void 0,(function*(){c.k.info("remove report phone: ",e);let t=yield this.database.find(this.reportPhones);if(t){const o=t.indexOf(e);t.splice(o,1),this.database.update(this.reportPhones,t)}}))}removeReportEmail(e){return g(this,void 0,void 0,(function*(){c.k.info("remove report email: ",e);let t=yield this.database.find(this.reportEmails);if(t){const o=t.indexOf(e);t.splice(o,1),this.database.update(this.reportEmails,t)}}))}uploadReportImage(e){return g(this,void 0,void 0,(function*(){c.k.info("upload report image: ",e.files.path);let t=this.auth.getAuthProfile();const o=new u,i=Date.now();let n={appInfo:{appId:l.kJ,operStaff:l.eW,orgId:l.TY,sign:"",tenantId:(null==t?void 0:t.tenantId)||-2,timeStamp:i}};n.appInfo.sign=(0,l.gw)(i,l.eW,n.appInfo.tenantId);for(let e in n.appInfo)o.append(e,n.appInfo[e]);o.append("files",null,{filename:e.files.name,contentType:e.files.type});return yield this.request.api({url:"api/v2/client/uploadWsheetFile",method:"post",headers:o.getHeaders(),data:o})}))}submitReport(e){return g(this,void 0,void 0,(function*(){c.k.info("create worksheet",e);const t=yield this.request.api({url:"api/wsheet/client/createWorkSheet",method:"post",data:e});let o=e.wheetInfo.mobilePhone;const i=yield this.auth.getAuthProfile();return i&&(o=i.userAccount),t.data}))}setEvaluation(e){return g(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getEvaluation(e){return g(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}setUrge(e){return g(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getUrge(e){return g(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}uploadReportFeedback(e){return g(this,void 0,void 0,(function*(){const t=new u;t.append("files",e.files,e.files.name);return(yield this.request.api({method:"post",url:"api/wsheet/client/uploadFeedbackFile",headers:{"Content-Type":"multipart/form-data,multipart/*"},params:{wsheetId:e.wsheetId},data:t})).data}))}downloadFile(e){return g(this,void 0,void 0,(function*(){const t=(yield this.request.api({url:"api/v2/client/downloadWsheetFile",method:"get",params:e,responseType:"stream"})).data;return t.pipe(null),c.k.info(t),t}))}getDownloadItemInfo(e){return g(this,void 0,void 0,(function*(){}))}getHistoryReport(e){return g(this,void 0,void 0,(function*(){return yield this.request.api({url:"api/v2/client/qryWorkSheet",method:"post",data:e})}))}getFeedback(e){return g(this,void 0,void 0,(function*(){return(yield this.request.api({url:"api/wsheet/client/qryFeedbackMsg",method:"get",params:e})).data}))}replyReportFeedback(e){return g(this,void 0,void 0,(function*(){return(yield this.request.api({method:"post",url:"api/wsheet/client/replyWorkSheet",data:e})).data}))}getkey(){return window.atob(this.ack.slice(20)+this.ack.slice(0,20))}uploadLog(e,t){return g(this,void 0,void 0,(function*(){let o=c.k.getLogs();if(0!==o.length)try{let i=m()().format("YYYY-MM-DD-HH-mm-ss"),n=`web-${e}-${i}.log`,r=(0,f.JQ)(`${n}${e}${this.getkey()}`),a={url:"api/cdserv/client/clientlog/genReportUrl",method:"get",params:{fileName:n,account:e,checksum:r}};t&&(a.params.wsheetId=t);let s=new File(o,n),l=yield this.request.api(a);yield this.request.send({url:decodeURIComponent(l.data),method:"put",data:s,headers:{"Content-Type":"application/octet-stream"},maxContentLength:1/0}),c.k.cleanLogs()}catch(e){c.k.error(`日志上传失败:${e.message}`)}}))}};b=v([(0,a.Xn)(),y("design:paramtypes",["function"==typeof(i=void 0!==s.cf&&s.cf)?i:Object,"function"==typeof(n=void 0!==p.g&&p.g)?n:Object,"function"==typeof(r=void 0!==d.v&&d.v)?r:Object])],b)},12773:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>c});var i=o(89810),n=o(51882),r=o(11210);const a={key:0},s={key:1,class:"d-flex align-center"},l=["href"],d=(0,i.defineComponent)({__name:"formItemFile",props:{item:{default:()=>({}),type:Object,required:!0}},setup(e){const t=e,o=((0,n.Z)(),(0,r.Z)()),d=(0,i.computed)((()=>t.item));function c(e){return`${o.getAPIHost()}/api/v2/client/downloadWsheetFile?attachName=${encodeURIComponent(e.attachName)}&attachAddress=${encodeURIComponent(e.attachAddress)}`}return(e,t)=>{const o=(0,i.resolveComponent)("Link"),n=(0,i.resolveComponent)("el-icon"),r=(0,i.resolveComponent)("el-form-item");return(0,i.openBlock)(),(0,i.createBlock)(r,{label:"附件:"},{default:(0,i.withCtx)((()=>[(0,i.unref)(d).wsheetAttachList?((0,i.openBlock)(),(0,i.createElementBlock)("div",s,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(d).wsheetAttachList,((e,t)=>((0,i.openBlock)(),(0,i.createElementBlock)("div",{class:"pic",key:t},[(0,i.createVNode)(n,null,{default:(0,i.withCtx)((()=>[(0,i.createVNode)(o)])),_:1}),(0,i.createElementVNode)("a",{href:c(e),download:"file",target:"_blank"},(0,i.toDisplayString)(e.attachName),9,l)])))),128))])):((0,i.openBlock)(),(0,i.createElementBlock)("div",a,"无"))])),_:1})}}});const c=(0,o(57775).Z)(d,[["__scopeId","data-v-302710b0"]])},66464:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>C});var i=o(89810),n=o(52134),r=o(48402),a=o(88538);var s=o(11210),l=o(51882),d=o(86631),c=o(12773),u=o(88533),p=o(5341),f=function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))};const h={class:"reportDetail"},m={class:"detailContent"},v={key:1,class:"divide-height-10"},y={class:"d-flex align-center"},g={key:0,style:{display:"flex","align-items":"center","margin-left":"32px"}},b={class:"badge",style:{}},k={style:{color:"#3c3c3c","font-size":"12px"}},w=(0,i.defineComponent)({__name:"reportDetail",setup(e){const t=(0,p.mL)(),o=((0,d.Z)(),r.nC.get(a.cf),(0,l.Z)(),(0,s.Z)()),w=(0,i.inject)("detail"),C=(0,i.inject)("$filter"),N=((0,i.inject)("$message"),(0,i.inject)("$dialogHelper")),x=(0,i.computed)((()=>w.value?w.value.workSheetVO:null)),V=(0,i.computed)((()=>x.value&&x.value.wsheetSubtypeId?n.Mx[n.Y5[x.value.wsheetSubtypeId]]:"")),R=((0,i.ref)(0),(0,i.ref)(0),(0,i.ref)(["","非常不满意","不满意","一般","满意","非常满意"]),(0,i.ref)([]),(0,i.ref)(""));(0,i.ref)("");function E(){u.$x.emit("change-report-page",{to:"list"})}function I(){u.$x.emit("change-report-page",{to:"feedback",data:w.value,redirect:"detail"})}return(0,i.onMounted)((()=>f(this,void 0,void 0,(function*(){R.value=yield o.getAPIHost(),N.config({onBack:E})})))),(e,o)=>{const n=(0,i.resolveComponent)("el-form-item"),r=(0,i.resolveComponent)("el-divider"),a=(0,i.resolveComponent)("el-button"),s=(0,i.resolveComponent)("el-form");return(0,i.openBlock)(),(0,i.createElementBlock)("div",h,[(0,i.createElementVNode)("div",m,[(0,i.createVNode)(s,{"label-width":"90px","label-position":"left"},{default:(0,i.withCtx)((()=>[(0,i.createVNode)(n,{label:"状态:"},{default:(0,i.withCtx)((()=>[(0,i.createElementVNode)("span",{style:(0,i.normalizeStyle)({color:(0,i.unref)(C).formatStatus((0,i.unref)(x).status,"color")})},(0,i.toDisplayString)((0,i.unref)(C).formatStatus((0,i.unref)(x).status,"report")),5)])),_:1}),(0,i.unref)(x).wsheetObjName?((0,i.openBlock)(),(0,i.createBlock)(n,{key:0,label:"故障云电脑:"},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(x).wsheetObjName),1)])),_:1})):(0,i.createCommentVNode)("",!0),(0,i.createVNode)(n,{label:"故障类型:"},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(V)),1)])),_:1}),(0,i.createVNode)(n,{label:"故障描述:",class:"form-item-description"},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(x).wsheetDesc),1)])),_:1}),(0,i.createVNode)(c.default,{item:(0,i.unref)(w),class:"item-border-bottom-none"},null,8,["item"]),(0,i.unref)(t)?((0,i.openBlock)(),(0,i.createElementBlock)("div",v)):(0,i.createCommentVNode)("",!0),(0,i.createVNode)(n,{label:"联系人:"},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(x).contactName),1)])),_:1}),(0,i.createVNode)(n,{label:"联系电话:"},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(x).mobilePhone),1)])),_:1}),(0,i.createVNode)(n,{label:"邮箱:"},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(x).emails),1)])),_:1}),(0,i.createVNode)(n,{label:"创建时间:",class:"item-border-bottom-none"},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)((0,i.toDisplayString)((0,i.unref)(C).formatTime((0,i.unref)(x).createdTime)),1)])),_:1}),(0,i.createVNode)(r),(0,i.createVNode)(n,{label:"报障反馈:",class:"item-border-bottom-none"},{default:(0,i.withCtx)((()=>[(0,i.createElementVNode)("div",y,[(0,i.createVNode)(a,{type:"primary",onClick:I},{default:(0,i.withCtx)((()=>[(0,i.createTextVNode)("查看")])),_:1}),(0,i.unref)(x).newMsgNum>0?((0,i.openBlock)(),(0,i.createElementBlock)("div",g,[(0,i.createElementVNode)("div",b,(0,i.toDisplayString)((0,i.unref)(x).newMsgNum),1),(0,i.createElementVNode)("span",k,"您有"+(0,i.toDisplayString)((0,i.unref)(x).newMsgNum)+"新消息",1)])):(0,i.createCommentVNode)("",!0)])])),_:1})])),_:1})])])}}});const C=(0,o(57775).Z)(w,[["__scopeId","data-v-90e800ba"]])}}]);