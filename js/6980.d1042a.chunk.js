"use strict";(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[6980],{46980:(e,l,a)=>{a.r(l),a.d(l,{default:()=>C});var t=a(89810),n=a(55826),o=a(6298),i=a(48402),r=a(73827),c=a(86756),s=a(29997),u=function(e,l,a,t){return new(a||(a=Promise))((function(n,o){function i(e){try{c(t.next(e))}catch(e){o(e)}}function r(e){try{c(t.throw(e))}catch(e){o(e)}}function c(e){var l;e.done?n(e.value):(l=e.value,l instanceof a?l:new a((function(e){e(l)}))).then(i,r)}c((t=t.apply(e,l||[])).next())}))};const d={class:"validate"},m={class:"tips"},p={key:1,class:"validate-form"},f={key:0,class:"tips"},v={key:1,class:"tips"},k={class:"validate-form-item-prefix"},h={class:"validate-form-item-prefix"},g=(y=()=>(0,t.createElementVNode)("span",{class:"validate-form-item-prefix"},"验证码",-1),(0,t.pushScopeId)("data-v-3cd56376"),y=y(),(0,t.popScopeId)(),y);var y;const b={key:0},B={key:1},V=(0,t.defineComponent)({__name:"accountValidate",props:{afterValidate:{type:Function,default:()=>{}},params:{type:Object,default:()=>null}},emits:["enter","toOriginIndex"],setup(e,{emit:l}){const a=e,y=(0,t.inject)("$dialogHelper"),V=i.nC.get(o.g);var C=(0,t.ref)(null),N=(0,t.reactive)({sms:"",phone:"",email:""}),w=(0,t.ref)(!1),E=(0,t.ref)(!1),x=(0,t.ref)(""),S=null,_=(0,t.ref)(0),T=(0,t.ref)("");const I=(0,t.ref)();var P=(0,t.ref)(!1),z="";const A=(0,t.reactive)({phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1\d{10}$/,message:"手机号码格式不正确",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"邮箱地址格式不正确",trigger:"blur"}],sms:[{pattern:/^\d{1,}$/,message:"请输入数字",trigger:"blur"},{required:!0,message:"请输入验证码",trigger:"blur"},{validator:(e,l,a)=>{6!==l.toString().length?a(new Error("验证码长度不对")):a()},trigger:"blur"}]}),D=(0,t.computed)((()=>"email"===T.value)),M=(0,t.computed)((()=>!a.params));function F(){T.value="phone",null!==S&&clearTimeout(S),_.value=0,y.config({title:""+(M.value?"忘记密码-手机验证":"身份认证"),onBack:()=>q()})}function K(){T.value="email",null!==S&&clearTimeout(S),_.value=0,y.config({title:""+(M.value?"忘记密码-邮箱验证":"身份认证"),onBack:()=>q()})}function Z(){return u(this,void 0,void 0,(function*(){I.value&&(yield I.value.validate(((e,t)=>u(this,void 0,void 0,(function*(){if(e)try{if(E.value=!0,w.value)return void function(){u(this,void 0,void 0,(function*(){try{"phone"===T.value?yield V.changeMobilePhone({newPhoneNum:N.phone?Number(N.phone):void 0,validateCode:N.sms}):yield V.changeMail({newMailAddress:N.email?N.email:void 0,validateCode:N.sms}),_.value=0,r.z8.success(("phone"===T.value?"修改手机号":"邮箱换绑")+"成功！");const e=N.phone?Number(N.phone):void 0,a=N.email?N.email:void 0;setTimeout((()=>{l("enter"),l("toOriginIndex",e,a)}),1500)}catch(e){if("cancel"===e)return;switch(_.value=0,s.k.info("修改手机号/邮箱错误码：",e.code),e.code){case 51202:$("邮箱账号已存在！","该邮箱已被其他账户绑定，请使用其他邮箱。");break;case 51093:$("手机号码已存在！","该手机号码已被其他账户绑定！请更换其他手机号码。");break;default:"string"==typeof e.message&&r.z8.error(e.message)}}finally{null!==S&&clearTimeout(S)}}))}();const e={emailAddress:N.email||void 0,mobilePhone:"email"!==T.value&&N.phone?Number(N.phone):void 0,validateCode:N.sms},t=yield V.checkAndGetUserInfo(e);x.value=yield V.validateSMSCode(e),null!==S&&clearTimeout(S),_.value=0,a.params&&a.params.afterValidateBySelf?(z=T.value,T.value=a.params.updateType,y.config({title:"更换"+("phone"===T.value?"手机号":"邮箱"),onBack:!(!a.params||!a.params.back)&&(()=>l("enter",a.params.back))}),P.value=!1,N.sms="",N.phone="",N.email="",w.value=!0):a.afterValidate&&a.afterValidate(x.value,"email"===T.value?N.email:Number(N.phone),t)}catch(e){"string"==typeof e.message&&r.z8.error(e.message)}finally{E.value=!1}})))))}))}function $(e,l){c.T.confirm(e,l,{type:"warning",confirmButtonText:"确定",showCancelButton:!1})}function U(){return u(this,void 0,void 0,(function*(){if(N.phone||N.email){if(!(P.value||_.value>0||E.value))try{P.value=!0;const e={emailAddress:void 0,mobilePhone:void 0,sign:void 0};w.value&&C.value?("email"===z?e.emailAddress=C.value.email:e.mobilePhone=Number(C.value.mobilephone),e.sign=x.value,"phone"===T.value?e.newPhoneNum=N.phone:e.newMailAddress=N.email):"email"===T.value?e.emailAddress=N.email:e.mobilePhone=N.phone?Number(N.phone):void 0,yield V.sendSMSCode(e),r.z8.success("验证码已发送");const l=D.value||"email"===z?180:60;_.value=l,O()}catch(e){r.z8.error(e.message)}finally{P.value=!1}}else r.z8.error("请输入"+(D.value?"邮箱地址":"手机号码"))}))}function q(){T.value="",N.sms="",y.config({title:M.value?"忘记密码":"请选择认证方式",onBack:!(!a.params||!a.params.back)&&(()=>l("enter",a.params.back))})}function O(){_.value=_.value-1,null!==S&&clearTimeout(S),S=setTimeout((()=>{_.value>0&&O()}),1e3)}return(0,t.onMounted)((()=>u(this,void 0,void 0,(function*(){(0,t.nextTick)((()=>{y.config({title:M.value?"忘记密码":"请选择认证方式",width:432,onBack:!(!a.params||!a.params.back)&&(()=>l("enter"))})})),yield function(){return u(this,void 0,void 0,(function*(){var e=yield V.getAuthProfile();null!==e&&(M.value?(N.phone="",N.email=""):(N.phone=e.mobilephone,N.email=e.email),delete e.secretKey,delete e.password,C.value=e)}))}()})))),(l,a)=>{const o=(0,t.resolveComponent)("el-input"),i=(0,t.resolveComponent)("el-form-item"),r=(0,t.resolveComponent)("el-button"),c=(0,t.resolveComponent)("el-form");return(0,t.openBlock)(),(0,t.createElementBlock)("div",d,[0===(0,t.unref)(T).length?((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,{key:0},[(0,t.createElementVNode)("p",m,"请选择身份认证的方式"+(0,t.toDisplayString)((0,t.unref)(M)?"找回密码":""),1),(0,t.unref)(C)&&!(0,t.unref)(C).logined?((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,{key:0},[(0,t.createVNode)(n.Z,{icon:"mobile-phone",label:"使用手机短信验证","click-event":F}),(0,t.createVNode)(n.Z,{icon:"email",label:"使用邮箱验证","click-event":K})],64)):((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,{key:1},[!(0,t.unref)(C)||(0,t.unref)(C).mobilephone?((0,t.openBlock)(),(0,t.createBlock)(n.Z,{key:0,icon:"mobile-phone",label:"使用手机短信验证","click-event":F})):(0,t.createCommentVNode)("",!0),!(0,t.unref)(C)||(0,t.unref)(C).email?((0,t.openBlock)(),(0,t.createBlock)(n.Z,{key:1,icon:"email",label:"使用邮箱验证","click-event":K})):(0,t.createCommentVNode)("",!0)],64))],64)):((0,t.openBlock)(),(0,t.createElementBlock)("div",p,[(0,t.unref)(M)?(0,t.createCommentVNode)("",!0):((0,t.openBlock)(),(0,t.createElementBlock)(t.Fragment,{key:0},[(0,t.unref)(w)?(0,t.createCommentVNode)("",!0):((0,t.openBlock)(),(0,t.createElementBlock)("p",f,"在"+(0,t.toDisplayString)(e.params.preTitle)+"前，请先通过身份验证",1)),(0,t.unref)(w)?((0,t.openBlock)(),(0,t.createElementBlock)("p",v,"请验证您要绑定的"+(0,t.toDisplayString)("phone"===(0,t.unref)(T)?"手机号":"邮箱"),1)):(0,t.createCommentVNode)("",!0)],64)),(0,t.createVNode)(c,{onKeypress:(0,t.withKeys)((0,t.withModifiers)(Z,["prevent"]),["enter"]),model:(0,t.unref)(N),rules:A,ref_key:"ruleFormRef",ref:I,"label-width":"0"},{default:(0,t.withCtx)((()=>[(0,t.unref)(D)?((0,t.openBlock)(),(0,t.createBlock)(i,{key:0,class:"validate-form-item",prop:"email"},{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("span",k,(0,t.toDisplayString)((0,t.unref)(w)?"新":"")+"邮箱",1),(0,t.createVNode)(o,{ref:"email",placeholder:"请输入邮箱地址",type:"text",disabled:!(0,t.unref)(w)&&((0,t.unref)(C)&&!(0,t.unref)(M)||(0,t.unref)(E)),modelValue:(0,t.unref)(N).email,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,t.unref)(N).email=e)},null,8,["disabled","modelValue"])])),_:1})):((0,t.openBlock)(),(0,t.createBlock)(i,{key:1,class:"validate-form-item",prop:"phone"},{default:(0,t.withCtx)((()=>[(0,t.createElementVNode)("span",h,(0,t.toDisplayString)((0,t.unref)(w)?"新":"")+"手机号",1),(0,t.createVNode)(o,{ref:"phone",placeholder:"请输入手机号码",type:"text",maxlength:"11",disabled:!(0,t.unref)(w)&&((0,t.unref)(C)&&!(0,t.unref)(M)||(0,t.unref)(E)),modelValue:(0,t.unref)(N).phone,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,t.unref)(N).phone=e)},null,8,["disabled","modelValue"])])),_:1})),(0,t.createVNode)(i,{class:"validate-form-item validate-form-code",prop:"sms"},{default:(0,t.withCtx)((()=>[g,(0,t.createVNode)(o,{placeholder:"请输入验证码",maxlength:"6",onKeyup:(0,t.withKeys)(Z,["enter"]),disabled:(0,t.unref)(E),modelValue:(0,t.unref)(N).sms,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,t.unref)(N).sms=e)},null,8,["onKeyup","disabled","modelValue"]),(0,t.createVNode)(r,{onClick:U,loading:(0,t.unref)(P),disabled:!/^1\d{10}$/.test((0,t.unref)(N).phone)&&!(0,t.unref)(D)||(0,t.unref)(_)>0||(0,t.unref)(E),type:"text",class:"validate-form-code-sms"},{default:(0,t.withCtx)((()=>[(0,t.unref)(_)>0?((0,t.openBlock)(),(0,t.createElementBlock)("span",b,(0,t.toDisplayString)((0,t.unref)(_))+"秒后重试 ",1)):((0,t.openBlock)(),(0,t.createElementBlock)("span",B,"获取验证码"))])),_:1},8,["loading","disabled"])])),_:1}),(0,t.createVNode)(i,{class:"validate-form-item"},{default:(0,t.withCtx)((()=>[(0,t.createVNode)(r,{disabled:!(0,t.unref)(N).sms,loading:(0,t.unref)(E),type:"primary",class:"validate-form-item-submit",onClick:Z},{default:(0,t.withCtx)((()=>[(0,t.createTextVNode)((0,t.toDisplayString)((0,t.unref)(w)?"确认":"下一步"),1)])),_:1},8,["disabled","loading"])])),_:1})])),_:1},8,["onKeypress","model","rules"])]))])}}});const C=(0,a(57775).Z)(V,[["__scopeId","data-v-3cd56376"]])},55826:(e,l,a)=>{a.d(l,{Z:()=>c});var t=a(89810);const n={class:"dialog-item-main"},o={class:"item-content"},i={key:0,class:"iconfont icon-right"},r=(0,t.defineComponent)({__name:"dialogItem",props:{label:{type:String,default:""},disabled:{type:Boolean,default:!1},icon:{type:String,default:void 0},clickEvent:{type:Function,default:null},isLastItem:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:l}){const a=e,r=(0,t.computed)((()=>null!==a.clickEvent));function c(){!a.disabled&&a.clickEvent&&a.clickEvent()}return(l,a)=>((0,t.openBlock)(),(0,t.createElementBlock)("div",{class:(0,t.normalizeClass)(["dialog-item skin-dialog-item panel",{disabled:e.disabled,default:!(0,t.unref)(r),"last-item":e.isLastItem}]),onClick:c},[(0,t.createElementVNode)("div",n,[(0,t.createElementVNode)("label",null,[e.icon?((0,t.openBlock)(),(0,t.createElementBlock)("i",{key:0,class:(0,t.normalizeClass)(["iconfont",`icon-${e.icon}`])},null,2)):(0,t.createCommentVNode)("",!0),(0,t.createTextVNode)((0,t.toDisplayString)(e.label),1)]),(0,t.createElementVNode)("div",o,[(0,t.renderSlot)(l.$slots,"default")]),(0,t.unref)(r)?((0,t.openBlock)(),(0,t.createElementBlock)("i",i)):(0,t.createCommentVNode)("",!0)])],2))}});const c=(0,a(57775).Z)(r,[["__scopeId","data-v-adaf8724"]])}}]);