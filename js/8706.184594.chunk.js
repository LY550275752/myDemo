(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[8706],{25448:e=>{var t,n=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e={}){var n,r,i=void 0!==e?e:{};i.ready=new Promise((function(e,t){n=e,r=t})),i.locateFile=function(e){return"libopusEncoder.wasm"==e?"static/common/libopusEncoder.wasm":"libopusDecoder.wasm"==e?"../static/common/libopusDecoder.wasm":e};var o,s,a,c=Object.assign({},i),d="./this.program",u=!0,h=!1,l="";(u||h)&&(h?l=self.location.href:"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),t&&(l=t),l=0!==l.indexOf("blob:")?l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(a=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=(e,t,n)=>{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=()=>{200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var f,p,m=i.print||void 0,g=i.printErr||void 0;Object.assign(i,c),c=null,i.arguments&&i.arguments,i.thisProgram&&(d=i.thisProgram),i.quit&&i.quit,i.wasmBinary&&(f=i.wasmBinary),i.noExitRuntime,"object"!=typeof WebAssembly&&U("no native wasm support detected");var y,v,w,k,b=!1,E="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function _(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.buffer&&E)return E.decode(e.subarray(t,i));for(var o="";t<i;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var c=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var d=s-65536;o+=String.fromCharCode(55296|d>>10,56320|1023&d)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o}function S(e,t){return e?_(v,e,t):""}function D(e,t,n,r){if(!(r>0))return 0;for(var i=n,o=n+r-1,s=0;s<e.length;++s){var a=e.charCodeAt(s);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++s)),a<=127){if(n>=o)break;t[n++]=a}else if(a<=2047){if(n+1>=o)break;t[n++]=192|a>>6,t[n++]=128|63&a}else if(a<=65535){if(n+2>=o)break;t[n++]=224|a>>12,t[n++]=128|a>>6&63,t[n++]=128|63&a}else{if(n+3>=o)break;t[n++]=240|a>>18,t[n++]=128|a>>12&63,t[n++]=128|a>>6&63,t[n++]=128|63&a}}return t[n]=0,n-i}function C(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r<=127?t++:r<=2047?t+=2:r>=55296&&r<=57343?(t+=4,++n):t+=3}return t}function R(){var e=p.buffer;i.HEAP8=y=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=w=new Int32Array(e),i.HEAPU8=v=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=k=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}var M=[],P=[],T=[],A=0,x=null,F=null;function O(e){A++,i.monitorRunDependencies&&i.monitorRunDependencies(A)}function I(e){if(A--,i.monitorRunDependencies&&i.monitorRunDependencies(A),0==A&&(null!==x&&(clearInterval(x),x=null),F)){var t=F;F=null,t()}}function U(e){i.onAbort&&i.onAbort(e),g(e="Aborted("+e+")"),b=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}var B,N,j,L,z="data:application/octet-stream;base64,";function W(e){return e.startsWith(z)}function H(e){try{if(e==B&&f)return new Uint8Array(f);if(a)return a(e);throw"both async and sync fetching of the wasm failed"}catch(e){U(e)}}function G(e,t,n){return function(e){return f||!u&&!h||"function"!=typeof fetch?Promise.resolve().then((function(){return H(e)})):fetch(e,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()})).catch((function(){return H(e)}))}(e).then((function(e){return WebAssembly.instantiate(e,t)})).then((function(e){return e})).then(n,(function(e){g("failed to asynchronously prepare wasm: "+e),U(e)}))}function V(e){for(;e.length>0;)e.shift()(i)}function Q(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){k[this.ptr+4>>2]=e},this.get_type=function(){return k[this.ptr+4>>2]},this.set_destructor=function(e){k[this.ptr+8>>2]=e},this.get_destructor=function(){return k[this.ptr+8>>2]},this.set_refcount=function(e){w[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,y[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=y[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,y[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=y[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=w[this.ptr>>2];w[this.ptr>>2]=e+1},this.release_ref=function(){var e=w[this.ptr>>2];return w[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){k[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return k[this.ptr+16>>2]},this.get_exception_ptr=function(){if(pe(this.get_type()))return k[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function Y(e){var t=p.buffer;try{return p.grow(e-t.byteLength+65535>>>16),R(),1}catch(e){}}W(B="libopusEncoder.wasm")||(N=B,B=i.locateFile?i.locateFile(N,l):l+N);var J={};function q(){if(!q.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:d||"./this.program"};for(var t in J)void 0===J[t]?delete e[t]:e[t]=J[t];var n=[];for(var t in e)n.push(t+"="+e[t]);q.strings=n}return q.strings}var X={isAbs:e=>"/"===e.charAt(0),splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e},normalize:e=>{var t=X.isAbs(e),n="/"===e.substr(-1);return(e=X.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=X.splitPath(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},basename:e=>{if("/"===e)return"/";var t=(e=(e=X.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},join:function(){var e=Array.prototype.slice.call(arguments);return X.normalize(e.join("/"))},join2:(e,t)=>X.normalize(e+"/"+t)},$={resolve:function(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:re.cwd();if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");if(!r)return"";e=r+"/"+e,t=X.isAbs(r)}return(t?"/":"")+(e=X.normalizeArray(e.split("/").filter((e=>!!e)),!t).join("/"))||"."},relative:(e,t)=>{function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=$.resolve(e).substr(1),t=$.resolve(t).substr(1);for(var r=n(e.split("/")),i=n(t.split("/")),o=Math.min(r.length,i.length),s=o,a=0;a<o;a++)if(r[a]!==i[a]){s=a;break}var c=[];for(a=s;a<r.length;a++)c.push("..");return(c=c.concat(i.slice(s))).join("/")}};function K(e,t,n){var r=n>0?n:C(e)+1,i=new Array(r),o=D(e,i,0,i.length);return t&&(i.length=o),i}var Z={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){Z.ttys[e]={input:[],output:[],ops:t},re.registerDevice(e,Z.stream_ops)},stream_ops:{open:function(e){var t=Z.ttys[e.node.rdev];if(!t)throw new re.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.fsync(e.tty)},fsync:function(e){e.tty.ops.fsync(e.tty)},read:function(e,t,n,r,i){if(!e.tty||!e.tty.ops.get_char)throw new re.ErrnoError(60);for(var o=0,s=0;s<r;s++){var a;try{a=e.tty.ops.get_char(e.tty)}catch(e){throw new re.ErrnoError(29)}if(void 0===a&&0===o)throw new re.ErrnoError(6);if(null==a)break;o++,t[n+s]=a}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,n,r,i){if(!e.tty||!e.tty.ops.put_char)throw new re.ErrnoError(60);try{for(var o=0;o<r;o++)e.tty.ops.put_char(e.tty,t[n+o])}catch(e){throw new re.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=K(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(m(_(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync:function(e){e.output&&e.output.length>0&&(m(_(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(g(_(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},fsync:function(e){e.output&&e.output.length>0&&(g(_(e.output,0)),e.output=[])}}};function ee(e){U()}var te={ops_table:null,mount:function(e){return te.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(re.isBlkdev(n)||re.isFIFO(n))throw new re.ErrnoError(63);te.ops_table||(te.ops_table={dir:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,lookup:te.node_ops.lookup,mknod:te.node_ops.mknod,rename:te.node_ops.rename,unlink:te.node_ops.unlink,rmdir:te.node_ops.rmdir,readdir:te.node_ops.readdir,symlink:te.node_ops.symlink},stream:{llseek:te.stream_ops.llseek}},file:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:{llseek:te.stream_ops.llseek,read:te.stream_ops.read,write:te.stream_ops.write,allocate:te.stream_ops.allocate,mmap:te.stream_ops.mmap,msync:te.stream_ops.msync}},link:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr,readlink:te.node_ops.readlink},stream:{}},chrdev:{node:{getattr:te.node_ops.getattr,setattr:te.node_ops.setattr},stream:re.chrdev_stream_ops}});var i=re.createNode(e,t,n,r);return re.isDir(i.mode)?(i.node_ops=te.ops_table.dir.node,i.stream_ops=te.ops_table.dir.stream,i.contents={}):re.isFile(i.mode)?(i.node_ops=te.ops_table.file.node,i.stream_ops=te.ops_table.file.stream,i.usedBytes=0,i.contents=null):re.isLink(i.mode)?(i.node_ops=te.ops_table.link.node,i.stream_ops=te.ops_table.link.stream):re.isChrdev(i.mode)&&(i.node_ops=te.ops_table.chrdev.node,i.stream_ops=te.ops_table.chrdev.stream),i.timestamp=Date.now(),e&&(e.contents[t]=i,e.timestamp=i.timestamp),i},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var n=e.contents?e.contents.length:0;if(!(n>=t)){t=Math.max(t,n*(n<1048576?2:1.125)>>>0),0!=n&&(t=Math.max(t,256));var r=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(r.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var n=e.contents;e.contents=new Uint8Array(t),n&&e.contents.set(n.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=re.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,re.isDir(e.mode)?t.size=4096:re.isFile(e.mode)?t.size=e.usedBytes:re.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&te.resizeFileStorage(e,t.size)},lookup:function(e,t){throw re.genericErrors[44]},mknod:function(e,t,n,r){return te.createNode(e,t,n,r)},rename:function(e,t,n){if(re.isDir(e.mode)){var r;try{r=re.lookupNode(t,n)}catch(e){}if(r)for(var i in r.contents)throw new re.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=n,t.contents[n]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var n=re.lookupNode(e,t);for(var r in n.contents)throw new re.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var n in e.contents)e.contents.hasOwnProperty(n)&&t.push(n);return t},symlink:function(e,t,n){var r=te.createNode(e,t,41471,0);return r.link=n,r},readlink:function(e){if(!re.isLink(e.mode))throw new re.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,n,r,i){var o=e.node.contents;if(i>=e.node.usedBytes)return 0;var s=Math.min(e.node.usedBytes-i,r);if(s>8&&o.subarray)t.set(o.subarray(i,i+s),n);else for(var a=0;a<s;a++)t[n+a]=o[i+a];return s},write:function(e,t,n,r,i,o){if(t.buffer===y.buffer&&(o=!1),!r)return 0;var s=e.node;if(s.timestamp=Date.now(),t.subarray&&(!s.contents||s.contents.subarray)){if(o)return s.contents=t.subarray(n,n+r),s.usedBytes=r,r;if(0===s.usedBytes&&0===i)return s.contents=t.slice(n,n+r),s.usedBytes=r,r;if(i+r<=s.usedBytes)return s.contents.set(t.subarray(n,n+r),i),r}if(te.expandFileStorage(s,i+r),s.contents.subarray&&t.subarray)s.contents.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)s.contents[i+a]=t[n+a];return s.usedBytes=Math.max(s.usedBytes,i+r),r},llseek:function(e,t,n){var r=t;if(1===n?r+=e.position:2===n&&re.isFile(e.node.mode)&&(r+=e.node.usedBytes),r<0)throw new re.ErrnoError(28);return r},allocate:function(e,t,n){te.expandFileStorage(e.node,t+n),e.node.usedBytes=Math.max(e.node.usedBytes,t+n)},mmap:function(e,t,n,r,i){if(!re.isFile(e.node.mode))throw new re.ErrnoError(43);var o,s,a=e.node.contents;if(2&i||a.buffer!==y.buffer){if((n>0||n+t<a.length)&&(a=a.subarray?a.subarray(n,n+t):Array.prototype.slice.call(a,n,n+t)),s=!0,!(o=ee()))throw new re.ErrnoError(48);y.set(a,o)}else s=!1,o=a.byteOffset;return{ptr:o,allocated:s}},msync:function(e,t,n,r,i){return te.stream_ops.write(e,t,0,r,n,!1),0}}};function ne(e,t,n,r){var i=r?"":"al "+e;s(e,(n=>{var r;r='Loading data file "'+e+'" failed (no arrayBuffer).',n||U(r),t(new Uint8Array(n)),i&&I()}),(t=>{if(!n)throw'Loading data file "'+e+'" failed.';n()})),i&&O()}var re={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(e,t={})=>{if(!(e=$.resolve(e)))return{path:"",node:null};if((t=Object.assign({follow_mount:!0,recurse_count:0},t)).recurse_count>8)throw new re.ErrnoError(32);for(var n=e.split("/").filter((e=>!!e)),r=re.root,i="/",o=0;o<n.length;o++){var s=o===n.length-1;if(s&&t.parent)break;if(r=re.lookupNode(r,n[o]),i=X.join2(i,n[o]),re.isMountpoint(r)&&(!s||s&&t.follow_mount)&&(r=r.mounted.root),!s||t.follow)for(var a=0;re.isLink(r.mode);){var c=re.readlink(i);if(i=$.resolve(X.dirname(i),c),r=re.lookupPath(i,{recurse_count:t.recurse_count+1}).node,a++>40)throw new re.ErrnoError(32)}}return{path:i,node:r}},getPath:e=>{for(var t;;){if(re.isRoot(e)){var n=e.mount.mountpoint;return t?"/"!==n[n.length-1]?n+"/"+t:n+t:n}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:(e,t)=>{for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%re.nameTable.length},hashAddNode:e=>{var t=re.hashName(e.parent.id,e.name);e.name_next=re.nameTable[t],re.nameTable[t]=e},hashRemoveNode:e=>{var t=re.hashName(e.parent.id,e.name);if(re.nameTable[t]===e)re.nameTable[t]=e.name_next;else for(var n=re.nameTable[t];n;){if(n.name_next===e){n.name_next=e.name_next;break}n=n.name_next}},lookupNode:(e,t)=>{var n=re.mayLookup(e);if(n)throw new re.ErrnoError(n,e);for(var r=re.hashName(e.id,t),i=re.nameTable[r];i;i=i.name_next){var o=i.name;if(i.parent.id===e.id&&o===t)return i}return re.lookup(e,t)},createNode:(e,t,n,r)=>{var i=new re.FSNode(e,t,n,r);return re.hashAddNode(i),i},destroyNode:e=>{re.hashRemoveNode(e)},isRoot:e=>e===e.parent,isMountpoint:e=>!!e.mounted,isFile:e=>32768==(61440&e),isDir:e=>16384==(61440&e),isLink:e=>40960==(61440&e),isChrdev:e=>8192==(61440&e),isBlkdev:e=>24576==(61440&e),isFIFO:e=>4096==(61440&e),isSocket:e=>49152==(49152&e),flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:e=>{var t=re.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:e=>{var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:(e,t)=>re.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2,mayLookup:e=>{var t=re.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:(e,t)=>{try{return re.lookupNode(e,t),20}catch(e){}return re.nodePermissions(e,"wx")},mayDelete:(e,t,n)=>{var r;try{r=re.lookupNode(e,t)}catch(e){return e.errno}var i=re.nodePermissions(e,"wx");if(i)return i;if(n){if(!re.isDir(r.mode))return 54;if(re.isRoot(r)||re.getPath(r)===re.cwd())return 10}else if(re.isDir(r.mode))return 31;return 0},mayOpen:(e,t)=>e?re.isLink(e.mode)?32:re.isDir(e.mode)&&("r"!==re.flagsToPermissionString(t)||512&t)?31:re.nodePermissions(e,re.flagsToPermissionString(t)):44,MAX_OPEN_FDS:4096,nextfd:(e=0,t=re.MAX_OPEN_FDS)=>{for(var n=e;n<=t;n++)if(!re.streams[n])return n;throw new re.ErrnoError(33)},getStream:e=>re.streams[e],createStream:(e,t,n)=>{re.FSStream||(re.FSStream=function(){this.shared={}},re.FSStream.prototype={},Object.defineProperties(re.FSStream.prototype,{object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}},flags:{get:function(){return this.shared.flags},set:function(e){this.shared.flags=e}},position:{get:function(){return this.shared.position},set:function(e){this.shared.position=e}}})),e=Object.assign(new re.FSStream,e);var r=re.nextfd(t,n);return e.fd=r,re.streams[r]=e,e},closeStream:e=>{re.streams[e]=null},chrdev_stream_ops:{open:e=>{var t=re.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:()=>{throw new re.ErrnoError(70)}},major:e=>e>>8,minor:e=>255&e,makedev:(e,t)=>e<<8|t,registerDevice:(e,t)=>{re.devices[e]={stream_ops:t}},getDevice:e=>re.devices[e],getMounts:e=>{for(var t=[],n=[e];n.length;){var r=n.pop();t.push(r),n.push.apply(n,r.mounts)}return t},syncfs:(e,t)=>{"function"==typeof e&&(t=e,e=!1),re.syncFSRequests++,re.syncFSRequests>1&&g("warning: "+re.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var n=re.getMounts(re.root.mount),r=0;function i(e){return re.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,i(e));++r>=n.length&&i(null)}n.forEach((t=>{if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:(e,t,n)=>{var r,i="/"===n,o=!n;if(i&&re.root)throw new re.ErrnoError(10);if(!i&&!o){var s=re.lookupPath(n,{follow_mount:!1});if(n=s.path,r=s.node,re.isMountpoint(r))throw new re.ErrnoError(10);if(!re.isDir(r.mode))throw new re.ErrnoError(54)}var a={type:e,opts:t,mountpoint:n,mounts:[]},c=e.mount(a);return c.mount=a,a.root=c,i?re.root=c:r&&(r.mounted=a,r.mount&&r.mount.mounts.push(a)),c},unmount:e=>{var t=re.lookupPath(e,{follow_mount:!1});if(!re.isMountpoint(t.node))throw new re.ErrnoError(28);var n=t.node,r=n.mounted,i=re.getMounts(r);Object.keys(re.nameTable).forEach((e=>{for(var t=re.nameTable[e];t;){var n=t.name_next;i.includes(t.mount)&&re.destroyNode(t),t=n}})),n.mounted=null;var o=n.mount.mounts.indexOf(r);n.mount.mounts.splice(o,1)},lookup:(e,t)=>e.node_ops.lookup(e,t),mknod:(e,t,n)=>{var r=re.lookupPath(e,{parent:!0}).node,i=X.basename(e);if(!i||"."===i||".."===i)throw new re.ErrnoError(28);var o=re.mayCreate(r,i);if(o)throw new re.ErrnoError(o);if(!r.node_ops.mknod)throw new re.ErrnoError(63);return r.node_ops.mknod(r,i,t,n)},create:(e,t)=>(t=void 0!==t?t:438,t&=4095,t|=32768,re.mknod(e,t,0)),mkdir:(e,t)=>(t=void 0!==t?t:511,t&=1023,t|=16384,re.mknod(e,t,0)),mkdirTree:(e,t)=>{for(var n=e.split("/"),r="",i=0;i<n.length;++i)if(n[i]){r+="/"+n[i];try{re.mkdir(r,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:(e,t,n)=>(void 0===n&&(n=t,t=438),t|=8192,re.mknod(e,t,n)),symlink:(e,t)=>{if(!$.resolve(e))throw new re.ErrnoError(44);var n=re.lookupPath(t,{parent:!0}).node;if(!n)throw new re.ErrnoError(44);var r=X.basename(t),i=re.mayCreate(n,r);if(i)throw new re.ErrnoError(i);if(!n.node_ops.symlink)throw new re.ErrnoError(63);return n.node_ops.symlink(n,r,e)},rename:(e,t)=>{var n,r,i=X.dirname(e),o=X.dirname(t),s=X.basename(e),a=X.basename(t);if(n=re.lookupPath(e,{parent:!0}).node,r=re.lookupPath(t,{parent:!0}).node,!n||!r)throw new re.ErrnoError(44);if(n.mount!==r.mount)throw new re.ErrnoError(75);var c,d=re.lookupNode(n,s),u=$.relative(e,o);if("."!==u.charAt(0))throw new re.ErrnoError(28);if("."!==(u=$.relative(t,i)).charAt(0))throw new re.ErrnoError(55);try{c=re.lookupNode(r,a)}catch(e){}if(d!==c){var h=re.isDir(d.mode),l=re.mayDelete(n,s,h);if(l)throw new re.ErrnoError(l);if(l=c?re.mayDelete(r,a,h):re.mayCreate(r,a))throw new re.ErrnoError(l);if(!n.node_ops.rename)throw new re.ErrnoError(63);if(re.isMountpoint(d)||c&&re.isMountpoint(c))throw new re.ErrnoError(10);if(r!==n&&(l=re.nodePermissions(n,"w")))throw new re.ErrnoError(l);re.hashRemoveNode(d);try{n.node_ops.rename(d,r,a)}catch(e){throw e}finally{re.hashAddNode(d)}}},rmdir:e=>{var t=re.lookupPath(e,{parent:!0}).node,n=X.basename(e),r=re.lookupNode(t,n),i=re.mayDelete(t,n,!0);if(i)throw new re.ErrnoError(i);if(!t.node_ops.rmdir)throw new re.ErrnoError(63);if(re.isMountpoint(r))throw new re.ErrnoError(10);t.node_ops.rmdir(t,n),re.destroyNode(r)},readdir:e=>{var t=re.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new re.ErrnoError(54);return t.node_ops.readdir(t)},unlink:e=>{var t=re.lookupPath(e,{parent:!0}).node;if(!t)throw new re.ErrnoError(44);var n=X.basename(e),r=re.lookupNode(t,n),i=re.mayDelete(t,n,!1);if(i)throw new re.ErrnoError(i);if(!t.node_ops.unlink)throw new re.ErrnoError(63);if(re.isMountpoint(r))throw new re.ErrnoError(10);t.node_ops.unlink(t,n),re.destroyNode(r)},readlink:e=>{var t=re.lookupPath(e).node;if(!t)throw new re.ErrnoError(44);if(!t.node_ops.readlink)throw new re.ErrnoError(28);return $.resolve(re.getPath(t.parent),t.node_ops.readlink(t))},stat:(e,t)=>{var n=re.lookupPath(e,{follow:!t}).node;if(!n)throw new re.ErrnoError(44);if(!n.node_ops.getattr)throw new re.ErrnoError(63);return n.node_ops.getattr(n)},lstat:e=>re.stat(e,!0),chmod:(e,t,n)=>{var r;if(!(r="string"==typeof e?re.lookupPath(e,{follow:!n}).node:e).node_ops.setattr)throw new re.ErrnoError(63);r.node_ops.setattr(r,{mode:4095&t|-4096&r.mode,timestamp:Date.now()})},lchmod:(e,t)=>{re.chmod(e,t,!0)},fchmod:(e,t)=>{var n=re.getStream(e);if(!n)throw new re.ErrnoError(8);re.chmod(n.node,t)},chown:(e,t,n,r)=>{var i;if(!(i="string"==typeof e?re.lookupPath(e,{follow:!r}).node:e).node_ops.setattr)throw new re.ErrnoError(63);i.node_ops.setattr(i,{timestamp:Date.now()})},lchown:(e,t,n)=>{re.chown(e,t,n,!0)},fchown:(e,t,n)=>{var r=re.getStream(e);if(!r)throw new re.ErrnoError(8);re.chown(r.node,t,n)},truncate:(e,t)=>{if(t<0)throw new re.ErrnoError(28);var n;if(!(n="string"==typeof e?re.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new re.ErrnoError(63);if(re.isDir(n.mode))throw new re.ErrnoError(31);if(!re.isFile(n.mode))throw new re.ErrnoError(28);var r=re.nodePermissions(n,"w");if(r)throw new re.ErrnoError(r);n.node_ops.setattr(n,{size:t,timestamp:Date.now()})},ftruncate:(e,t)=>{var n=re.getStream(e);if(!n)throw new re.ErrnoError(8);if(0==(2097155&n.flags))throw new re.ErrnoError(28);re.truncate(n.node,t)},utime:(e,t,n)=>{var r=re.lookupPath(e,{follow:!0}).node;r.node_ops.setattr(r,{timestamp:Math.max(t,n)})},open:(e,t,n)=>{if(""===e)throw new re.ErrnoError(44);var r;if(n=void 0===n?438:n,n=64&(t="string"==typeof t?re.modeStringToFlags(t):t)?4095&n|32768:0,"object"==typeof e)r=e;else{e=X.normalize(e);try{r=re.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var o=!1;if(64&t)if(r){if(128&t)throw new re.ErrnoError(20)}else r=re.mknod(e,n,0),o=!0;if(!r)throw new re.ErrnoError(44);if(re.isChrdev(r.mode)&&(t&=-513),65536&t&&!re.isDir(r.mode))throw new re.ErrnoError(54);if(!o){var s=re.mayOpen(r,t);if(s)throw new re.ErrnoError(s)}512&t&&!o&&re.truncate(r,0),t&=-131713;var a=re.createStream({node:r,path:re.getPath(r),flags:t,seekable:!0,position:0,stream_ops:r.stream_ops,ungotten:[],error:!1});return a.stream_ops.open&&a.stream_ops.open(a),!i.logReadFiles||1&t||(re.readFiles||(re.readFiles={}),e in re.readFiles||(re.readFiles[e]=1)),a},close:e=>{if(re.isClosed(e))throw new re.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{re.closeStream(e.fd)}e.fd=null},isClosed:e=>null===e.fd,llseek:(e,t,n)=>{if(re.isClosed(e))throw new re.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new re.ErrnoError(70);if(0!=n&&1!=n&&2!=n)throw new re.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,n),e.ungotten=[],e.position},read:(e,t,n,r,i)=>{if(r<0||i<0)throw new re.ErrnoError(28);if(re.isClosed(e))throw new re.ErrnoError(8);if(1==(2097155&e.flags))throw new re.ErrnoError(8);if(re.isDir(e.node.mode))throw new re.ErrnoError(31);if(!e.stream_ops.read)throw new re.ErrnoError(28);var o=void 0!==i;if(o){if(!e.seekable)throw new re.ErrnoError(70)}else i=e.position;var s=e.stream_ops.read(e,t,n,r,i);return o||(e.position+=s),s},write:(e,t,n,r,i,o)=>{if(r<0||i<0)throw new re.ErrnoError(28);if(re.isClosed(e))throw new re.ErrnoError(8);if(0==(2097155&e.flags))throw new re.ErrnoError(8);if(re.isDir(e.node.mode))throw new re.ErrnoError(31);if(!e.stream_ops.write)throw new re.ErrnoError(28);e.seekable&&1024&e.flags&&re.llseek(e,0,2);var s=void 0!==i;if(s){if(!e.seekable)throw new re.ErrnoError(70)}else i=e.position;var a=e.stream_ops.write(e,t,n,r,i,o);return s||(e.position+=a),a},allocate:(e,t,n)=>{if(re.isClosed(e))throw new re.ErrnoError(8);if(t<0||n<=0)throw new re.ErrnoError(28);if(0==(2097155&e.flags))throw new re.ErrnoError(8);if(!re.isFile(e.node.mode)&&!re.isDir(e.node.mode))throw new re.ErrnoError(43);if(!e.stream_ops.allocate)throw new re.ErrnoError(138);e.stream_ops.allocate(e,t,n)},mmap:(e,t,n,r,i)=>{if(0!=(2&r)&&0==(2&i)&&2!=(2097155&e.flags))throw new re.ErrnoError(2);if(1==(2097155&e.flags))throw new re.ErrnoError(2);if(!e.stream_ops.mmap)throw new re.ErrnoError(43);return e.stream_ops.mmap(e,t,n,r,i)},msync:(e,t,n,r,i)=>e.stream_ops.msync?e.stream_ops.msync(e,t,n,r,i):0,munmap:e=>0,ioctl:(e,t,n)=>{if(!e.stream_ops.ioctl)throw new re.ErrnoError(59);return e.stream_ops.ioctl(e,t,n)},readFile:(e,t={})=>{if(t.flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var n,r=re.open(e,t.flags),i=re.stat(e).size,o=new Uint8Array(i);return re.read(r,o,0,i,0),"utf8"===t.encoding?n=_(o,0):"binary"===t.encoding&&(n=o),re.close(r),n},writeFile:(e,t,n={})=>{n.flags=n.flags||577;var r=re.open(e,n.flags,n.mode);if("string"==typeof t){var i=new Uint8Array(C(t)+1),o=D(t,i,0,i.length);re.write(r,i,0,o,void 0,n.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");re.write(r,t,0,t.byteLength,void 0,n.canOwn)}re.close(r)},cwd:()=>re.currentPath,chdir:e=>{var t=re.lookupPath(e,{follow:!0});if(null===t.node)throw new re.ErrnoError(44);if(!re.isDir(t.node.mode))throw new re.ErrnoError(54);var n=re.nodePermissions(t.node,"x");if(n)throw new re.ErrnoError(n);re.currentPath=t.path},createDefaultDirectories:()=>{re.mkdir("/tmp"),re.mkdir("/home"),re.mkdir("/home/web_user")},createDefaultDevices:()=>{re.mkdir("/dev"),re.registerDevice(re.makedev(1,3),{read:()=>0,write:(e,t,n,r,i)=>r}),re.mkdev("/dev/null",re.makedev(1,3)),Z.register(re.makedev(5,0),Z.default_tty_ops),Z.register(re.makedev(6,0),Z.default_tty1_ops),re.mkdev("/dev/tty",re.makedev(5,0)),re.mkdev("/dev/tty1",re.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return()=>(crypto.getRandomValues(e),e[0])}return()=>U("randomDevice")}();re.createDevice("/dev","random",e),re.createDevice("/dev","urandom",e),re.mkdir("/dev/shm"),re.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{re.mkdir("/proc");var e=re.mkdir("/proc/self");re.mkdir("/proc/self/fd"),re.mount({mount:()=>{var t=re.createNode(e,"fd",16895,73);return t.node_ops={lookup:(e,t)=>{var n=+t,r=re.getStream(n);if(!r)throw new re.ErrnoError(8);var i={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>r.path}};return i.parent=i,i}},t}},{},"/proc/self/fd")},createStandardStreams:()=>{i.stdin?re.createDevice("/dev","stdin",i.stdin):re.symlink("/dev/tty","/dev/stdin"),i.stdout?re.createDevice("/dev","stdout",null,i.stdout):re.symlink("/dev/tty","/dev/stdout"),i.stderr?re.createDevice("/dev","stderr",null,i.stderr):re.symlink("/dev/tty1","/dev/stderr"),re.open("/dev/stdin",0),re.open("/dev/stdout",1),re.open("/dev/stderr",1)},ensureErrnoError:()=>{re.ErrnoError||(re.ErrnoError=function(e,t){this.name="ErrnoError",this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},re.ErrnoError.prototype=new Error,re.ErrnoError.prototype.constructor=re.ErrnoError,[44].forEach((e=>{re.genericErrors[e]=new re.ErrnoError(e),re.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:()=>{re.ensureErrnoError(),re.nameTable=new Array(4096),re.mount(te,{},"/"),re.createDefaultDirectories(),re.createDefaultDevices(),re.createSpecialDirectories(),re.filesystems={MEMFS:te}},init:(e,t,n)=>{re.init.initialized=!0,re.ensureErrnoError(),i.stdin=e||i.stdin,i.stdout=t||i.stdout,i.stderr=n||i.stderr,re.createStandardStreams()},quit:()=>{re.init.initialized=!1;for(var e=0;e<re.streams.length;e++){var t=re.streams[e];t&&re.close(t)}},getMode:(e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n},findObject:(e,t)=>{var n=re.analyzePath(e,t);return n.exists?n.object:null},analyzePath:(e,t)=>{try{e=(r=re.lookupPath(e,{follow:!t})).path}catch(e){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var r=re.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=r.path,n.parentObject=r.node,n.name=X.basename(e),r=re.lookupPath(e,{follow:!t}),n.exists=!0,n.path=r.path,n.object=r.node,n.name=r.node.name,n.isRoot="/"===r.path}catch(e){n.error=e.errno}return n},createPath:(e,t,n,r)=>{e="string"==typeof e?e:re.getPath(e);for(var i=t.split("/").reverse();i.length;){var o=i.pop();if(o){var s=X.join2(e,o);try{re.mkdir(s)}catch(e){}e=s}}return s},createFile:(e,t,n,r,i)=>{var o=X.join2("string"==typeof e?e:re.getPath(e),t),s=re.getMode(r,i);return re.create(o,s)},createDataFile:(e,t,n,r,i,o)=>{var s=t;e&&(e="string"==typeof e?e:re.getPath(e),s=t?X.join2(e,t):e);var a=re.getMode(r,i),c=re.create(s,a);if(n){if("string"==typeof n){for(var d=new Array(n.length),u=0,h=n.length;u<h;++u)d[u]=n.charCodeAt(u);n=d}re.chmod(c,146|a);var l=re.open(c,577);re.write(l,n,0,n.length,0,o),re.close(l),re.chmod(c,a)}return c},createDevice:(e,t,n,r)=>{var i=X.join2("string"==typeof e?e:re.getPath(e),t),o=re.getMode(!!n,!!r);re.createDevice.major||(re.createDevice.major=64);var s=re.makedev(re.createDevice.major++,0);return re.registerDevice(s,{open:e=>{e.seekable=!1},close:e=>{r&&r.buffer&&r.buffer.length&&r(10)},read:(e,t,r,i,o)=>{for(var s=0,a=0;a<i;a++){var c;try{c=n()}catch(e){throw new re.ErrnoError(29)}if(void 0===c&&0===s)throw new re.ErrnoError(6);if(null==c)break;s++,t[r+a]=c}return s&&(e.node.timestamp=Date.now()),s},write:(e,t,n,i,o)=>{for(var s=0;s<i;s++)try{r(t[n+s])}catch(e){throw new re.ErrnoError(29)}return i&&(e.node.timestamp=Date.now()),s}}),re.mkdev(i,o,s)},forceLoadFile:e=>{if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!o)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=K(o(e.url),!0),e.usedBytes=e.contents.length}catch(e){throw new re.ErrnoError(29)}},createLazyFile:(e,t,n,r,i)=>{function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,n=e/this.chunkSize|0;return this.getter(n)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",n,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+n+". Status: "+e.status);var t,r=Number(e.getResponseHeader("Content-length")),i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,s=1048576;i||(s=r);var a=this;a.setDataGetter((e=>{var t=e*s,i=(e+1)*s-1;if(i=Math.min(i,r-1),void 0===a.chunks[e]&&(a.chunks[e]=((e,t)=>{if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>r-1)throw new Error("only "+r+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",n,!1),r!==s&&i.setRequestHeader("Range","bytes="+e+"-"+t),i.responseType="arraybuffer",i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+n+". Status: "+i.status);return void 0!==i.response?new Uint8Array(i.response||[]):K(i.responseText||"",!0)})(t,i)),void 0===a.chunks[e])throw new Error("doXHR failed!");return a.chunks[e]})),!o&&r||(s=r=1,r=this.getter(0).length,s=r,m("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=r,this._chunkSize=s,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var s=new o;Object.defineProperties(s,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var a={isDevice:!1,contents:s}}else a={isDevice:!1,url:n};var c=re.createFile(e,t,a,r,i);a.contents?c.contents=a.contents:a.url&&(c.contents=null,c.url=a.url),Object.defineProperties(c,{usedBytes:{get:function(){return this.contents.length}}});var d={};function u(e,t,n,r,i){var o=e.node.contents;if(i>=o.length)return 0;var s=Math.min(o.length-i,r);if(o.slice)for(var a=0;a<s;a++)t[n+a]=o[i+a];else for(a=0;a<s;a++)t[n+a]=o.get(i+a);return s}return Object.keys(c.stream_ops).forEach((e=>{var t=c.stream_ops[e];d[e]=function(){return re.forceLoadFile(c),t.apply(null,arguments)}})),d.read=(e,t,n,r,i)=>(re.forceLoadFile(c),u(e,t,n,r,i)),d.mmap=(e,t,n,r,i)=>{re.forceLoadFile(c);var o=ee();if(!o)throw new re.ErrnoError(48);return u(e,y,o,t,n),{ptr:o,allocated:!0}},c.stream_ops=d,c},createPreloadedFile:(e,t,n,r,i,o,s,a,c,d)=>{var u=t?$.resolve(X.join2(e,t)):e;function h(n){function h(n){d&&d(),a||re.createDataFile(e,t,n,r,i,c),o&&o(),I()}Browser.handledByPreloadPlugin(n,u,h,(()=>{s&&s(),I()}))||h(n)}O(),"string"==typeof n?ne(n,(e=>h(e)),s):h(n)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(e,t=(()=>{}),n=(()=>{}))=>{var r=re.indexedDB();try{var i=r.open(re.DB_NAME(),re.DB_VERSION)}catch(e){return n(e)}i.onupgradeneeded=()=>{m("creating db"),i.result.createObjectStore(re.DB_STORE_NAME)},i.onsuccess=()=>{var r=i.result.transaction([re.DB_STORE_NAME],"readwrite"),o=r.objectStore(re.DB_STORE_NAME),s=0,a=0,c=e.length;function d(){0==a?t():n()}e.forEach((e=>{var t=o.put(re.analyzePath(e).object.contents,e);t.onsuccess=()=>{++s+a==c&&d()},t.onerror=()=>{a++,s+a==c&&d()}})),r.onerror=n},i.onerror=n},loadFilesFromDB:(e,t=(()=>{}),n=(()=>{}))=>{var r=re.indexedDB();try{var i=r.open(re.DB_NAME(),re.DB_VERSION)}catch(e){return n(e)}i.onupgradeneeded=n,i.onsuccess=()=>{var r=i.result;try{var o=r.transaction([re.DB_STORE_NAME],"readonly")}catch(e){return void n(e)}var s=o.objectStore(re.DB_STORE_NAME),a=0,c=0,d=e.length;function u(){0==c?t():n()}e.forEach((e=>{var t=s.get(e);t.onsuccess=()=>{re.analyzePath(e).exists&&re.unlink(e),re.createDataFile(X.dirname(e),X.basename(e),t.result,!0,!0,!0),++a+c==d&&u()},t.onerror=()=>{c++,a+c==d&&u()}})),o.onerror=n},i.onerror=n}},ie={DEFAULT_POLLMASK:5,calculateAt:function(e,t,n){if(X.isAbs(t))return t;var r;if(r=-100===e?re.cwd():ie.getStreamFromFD(e).path,0==t.length){if(!n)throw new re.ErrnoError(44);return r}return X.join2(r,t)},doStat:function(e,t,n){try{var r=e(t)}catch(e){if(e&&e.node&&X.normalize(t)!==X.normalize(re.getPath(e.node)))return-54;throw e}w[n>>2]=r.dev,w[n+8>>2]=r.ino,w[n+12>>2]=r.mode,k[n+16>>2]=r.nlink,w[n+20>>2]=r.uid,w[n+24>>2]=r.gid,w[n+28>>2]=r.rdev,L=[r.size>>>0,(j=r.size,+Math.abs(j)>=1?j>0?(0|Math.min(+Math.floor(j/4294967296),4294967295))>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],w[n+40>>2]=L[0],w[n+44>>2]=L[1],w[n+48>>2]=4096,w[n+52>>2]=r.blocks;var i=r.atime.getTime(),o=r.mtime.getTime(),s=r.ctime.getTime();return L=[Math.floor(i/1e3)>>>0,(j=Math.floor(i/1e3),+Math.abs(j)>=1?j>0?(0|Math.min(+Math.floor(j/4294967296),4294967295))>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],w[n+56>>2]=L[0],w[n+60>>2]=L[1],k[n+64>>2]=i%1e3*1e3,L=[Math.floor(o/1e3)>>>0,(j=Math.floor(o/1e3),+Math.abs(j)>=1?j>0?(0|Math.min(+Math.floor(j/4294967296),4294967295))>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],w[n+72>>2]=L[0],w[n+76>>2]=L[1],k[n+80>>2]=o%1e3*1e3,L=[Math.floor(s/1e3)>>>0,(j=Math.floor(s/1e3),+Math.abs(j)>=1?j>0?(0|Math.min(+Math.floor(j/4294967296),4294967295))>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],w[n+88>>2]=L[0],w[n+92>>2]=L[1],k[n+96>>2]=s%1e3*1e3,L=[r.ino>>>0,(j=r.ino,+Math.abs(j)>=1?j>0?(0|Math.min(+Math.floor(j/4294967296),4294967295))>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],w[n+104>>2]=L[0],w[n+108>>2]=L[1],0},doMsync:function(e,t,n,r,i){if(!re.isFile(t.node.mode))throw new re.ErrnoError(43);if(2&r)return 0;var o=v.slice(e,e+n);re.msync(t,o,i,n,r)},varargs:void 0,get:function(){return ie.varargs+=4,w[ie.varargs-4>>2]},getStr:function(e){return S(e)},getStreamFromFD:function(e){var t=re.getStream(e);if(!t)throw new re.ErrnoError(8);return t}};function oe(e){return e%4==0&&(e%100!=0||e%400==0)}var se=[31,29,31,30,31,30,31,31,30,31,30,31],ae=[31,28,31,30,31,30,31,31,30,31,30,31];function ce(e,t,n,r){var i=w[r+40>>2],o={tm_sec:w[r>>2],tm_min:w[r+4>>2],tm_hour:w[r+8>>2],tm_mday:w[r+12>>2],tm_mon:w[r+16>>2],tm_year:w[r+20>>2],tm_wday:w[r+24>>2],tm_yday:w[r+28>>2],tm_isdst:w[r+32>>2],tm_gmtoff:w[r+36>>2],tm_zone:i?S(i):""},s=S(n),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var c in a)s=s.replace(new RegExp(c,"g"),a[c]);var d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=["January","February","March","April","May","June","July","August","September","October","November","December"];function h(e,t,n){for(var r="number"==typeof e?e.toString():e||"";r.length<t;)r=n[0]+r;return r}function l(e,t){return h(e,t,"0")}function f(e,t){function n(e){return e<0?-1:e>0?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function p(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function m(e){var t=function(e,t){for(var n=new Date(e.getTime());t>0;){var r=oe(n.getFullYear()),i=n.getMonth(),o=(r?se:ae)[i];if(!(t>o-n.getDate()))return n.setDate(n.getDate()+t),n;t-=o-n.getDate()+1,n.setDate(1),i<11?n.setMonth(i+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),i=p(n),o=p(r);return f(i,t)<=0?f(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return d[e.tm_wday].substring(0,3)},"%A":function(e){return d[e.tm_wday]},"%b":function(e){return u[e.tm_mon].substring(0,3)},"%B":function(e){return u[e.tm_mon]},"%C":function(e){return l((e.tm_year+1900)/100|0,2)},"%d":function(e){return l(e.tm_mday,2)},"%e":function(e){return h(e.tm_mday,2," ")},"%g":function(e){return m(e).toString().substring(2)},"%G":function(e){return m(e)},"%H":function(e){return l(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),l(t,2)},"%j":function(e){return l(e.tm_mday+function(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}(oe(e.tm_year+1900)?se:ae,e.tm_mon-1),3)},"%m":function(e){return l(e.tm_mon+1,2)},"%M":function(e){return l(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return l(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return l(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var n=(e.tm_wday+371-e.tm_yday)%7;4==n||3==n&&oe(e.tm_year)||(t=1)}}else{t=52;var r=(e.tm_wday+7-e.tm_yday-1)%7;(4==r||5==r&&oe(e.tm_year%400-1))&&t++}return l(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return l(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var c in s=s.replace(/%%/g,"\0\0"),g)s.includes(c)&&(s=s.replace(new RegExp(c,"g"),g[c](o)));var v,k,b=K(s=s.replace(/\0\0/g,"%"),!1);return b.length>t?0:(v=b,k=e,y.set(v,k),b.length-1)}var de=function(e,t,n,r){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=re.nextInode++,this.name=t,this.mode=n,this.node_ops={},this.stream_ops={},this.rdev=r},ue=365,he=146;Object.defineProperties(de.prototype,{read:{get:function(){return(this.mode&ue)===ue},set:function(e){e?this.mode|=ue:this.mode&=-366}},write:{get:function(){return(this.mode&he)===he},set:function(e){e?this.mode|=he:this.mode&=-147}},isFolder:{get:function(){return re.isDir(this.mode)}},isDevice:{get:function(){return re.isChrdev(this.mode)}}}),re.FSNode=de,re.staticInit();var le,fe={c:function(e,t,n){throw new Q(e).init(t,n),e},a:function(){U("")},k:function(e,t,n){v.copyWithin(e,t,t+n)},i:function(e){var t,n,r=v.length,i=2147483648;if((e>>>=0)>i)return!1;for(var o=1;o<=4;o*=2){var s=r*(1+.2/o);if(s=Math.min(s,e+100663296),Y(Math.min(i,(t=Math.max(e,s))+((n=65536)-t%n)%n)))return!0}return!1},e:function(e,t){var n=0;return q().forEach((function(r,i){var o=t+n;k[e+4*i>>2]=o,function(e,t,n){for(var r=0;r<e.length;++r)y[t++>>0]=e.charCodeAt(r);n||(y[t>>0]=0)}(r,o),n+=r.length+1})),0},f:function(e,t){var n=q();k[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),k[t>>2]=r,0},g:function(e){try{var t=ie.getStreamFromFD(e);return re.close(t),0}catch(e){if(void 0===re||"ErrnoError"!==e.name)throw e;return e.errno}},h:function(e,t,n,r){try{var i=function(e,t,n,r){for(var i=0,o=0;o<n;o++){var s=k[t>>2],a=k[t+4>>2];t+=8;var c=re.read(e,y,s,a,r);if(c<0)return-1;if(i+=c,c<a)break;void 0!==r&&(r+=c)}return i}(ie.getStreamFromFD(e),t,n);return k[r>>2]=i,0}catch(e){if(void 0===re||"ErrnoError"!==e.name)throw e;return e.errno}},j:function(e,t,n,r,i){try{var o=(c=n)+2097152>>>0<4194305-!!(a=t)?(a>>>0)+4294967296*c:NaN;if(isNaN(o))return 61;var s=ie.getStreamFromFD(e);return re.llseek(s,o,r),L=[s.position>>>0,(j=s.position,+Math.abs(j)>=1?j>0?(0|Math.min(+Math.floor(j/4294967296),4294967295))>>>0:~~+Math.ceil((j-+(~~j>>>0))/4294967296)>>>0:0)],w[i>>2]=L[0],w[i+4>>2]=L[1],s.getdents&&0===o&&0===r&&(s.getdents=null),0}catch(e){if(void 0===re||"ErrnoError"!==e.name)throw e;return e.errno}var a,c},b:function(e,t,n,r){try{var i=function(e,t,n,r){for(var i=0,o=0;o<n;o++){var s=k[t>>2],a=k[t+4>>2];t+=8;var c=re.write(e,y,s,a,r);if(c<0)return-1;i+=c,void 0!==r&&(r+=c)}return i}(ie.getStreamFromFD(e),t,n);return k[r>>2]=i,0}catch(e){if(void 0===re||"ErrnoError"!==e.name)throw e;return e.errno}},d:function(e,t,n,r,i){return ce(e,t,n,r)}},pe=(function(){var e,t,n,o,s={a:fe};function a(e,t){var n,r=e.exports;return i.asm=r,p=i.asm.l,R(),i.asm.z,n=i.asm.m,P.unshift(n),I(),r}if(O(),i.instantiateWasm)try{return i.instantiateWasm(s,a)}catch(e){g("Module.instantiateWasm callback failed with error: "+e),r(e)}(e=f,t=B,n=s,o=function(e){a(e.instance)},e||"function"!=typeof WebAssembly.instantiateStreaming||W(t)||"function"!=typeof fetch?G(t,n,o):fetch(t,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,n).then(o,(function(e){return g("wasm streaming compile failed: "+e),g("falling back to ArrayBuffer instantiation"),G(t,n,o)}))}))).catch(r)}(),i._Encoder_new=function(){return(i._Encoder_new=i.asm.n).apply(null,arguments)},i._Encoder_delete=function(){return(i._Encoder_delete=i.asm.o).apply(null,arguments)},i._Encoder_input=function(){return(i._Encoder_input=i.asm.p).apply(null,arguments)},i._Encoder_output=function(){return(i._Encoder_output=i.asm.q).apply(null,arguments)},i._String_size=function(){return(i._String_size=i.asm.r).apply(null,arguments)},i._String_new=function(){return(i._String_new=i.asm.s).apply(null,arguments)},i._String_data=function(){return(i._String_data=i.asm.t).apply(null,arguments)},i._String_delete=function(){return(i._String_delete=i.asm.u).apply(null,arguments)},i._Int16Array_size=function(){return(i._Int16Array_size=i.asm.v).apply(null,arguments)},i._Int16Array_new=function(){return(i._Int16Array_new=i.asm.w).apply(null,arguments)},i._Int16Array_data=function(){return(i._Int16Array_data=i.asm.x).apply(null,arguments)},i._Int16Array_delete=function(){return(i._Int16Array_delete=i.asm.y).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.A).apply(null,arguments)},i._free=function(){return(i._free=i.asm.B).apply(null,arguments)},function(){return(pe=i.asm.C).apply(null,arguments)});function me(){function e(){le||(le=!0,i.calledRun=!0,b||(i.noFSInit||re.init.initialized||re.init(),re.ignorePermissions=!1,Z.init(),V(P),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),T.unshift(e);var e;V(T)}()))}A>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),M.unshift(e);var e;V(M)}(),A>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),e()}),1)):e()))}if(F=function e(){le||me(),le||(F=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return me(),e.ready});e.exports=n},44876:(e,t,n)=>{"use strict";n.d(t,{yG:()=>w});var r,i,o,s=n(48402),a=n(88538),c=n(52134),d=n(59927),u=n(19816),h=n(77140),l=n(6298),f=n(54478),p=n(47690),m=n.n(p),g=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let w=class{constructor(e,t,n){this.request=e,this.auth=t,this.database=n,this.ack="QDE5LXl1bmRpYW5uYW8=Q0xPVURfREVTS1RPUC0y",this.reportUser=null,this.table="reporter",this.reportPhones="reportPhones",this.reportEmails="reportEmails",this.reportContacts="reportContacts"}getAllReportUsers(){return v(this,void 0,void 0,(function*(){return yield this.database.find(this.table)}))}getAllReportPhones(){return v(this,void 0,void 0,(function*(){return yield this.database.find(this.reportPhones)}))}getAllReportEmails(){return v(this,void 0,void 0,(function*(){return yield this.database.find(this.reportEmails)}))}getAllReportContacts(){return v(this,void 0,void 0,(function*(){return yield this.database.find(this.reportContacts)}))}saveReportUser(e){return v(this,void 0,void 0,(function*(){if(!e||!e.username)return;u.k.info("save report user: ",e.username);const t=yield this.database.find(this.table);let n={[e.username]:e};t&&(n=Object.assign(t,n)),this.database.update(this.table,n)}))}saveReportContact(e){return v(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report contact: ",e);let t=yield this.database.find(this.reportContacts);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportContacts,t)}))}saveReportPhone(e){return v(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report phone: ",e);let t=yield this.database.find(this.reportPhones);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportPhones,t)}))}saveReportEmail(e){return v(this,void 0,void 0,(function*(){if(!e)return;u.k.info("save report email: ",e);let t=yield this.database.find(this.reportEmails);t?t.includes(e)||t.push(e):t=[e],this.database.update(this.reportEmails,t)}))}removeReportUser(e){return v(this,void 0,void 0,(function*(){u.k.info("remove report user: ",e);let t=yield this.database.find(this.table);t&&(delete t[e],this.database.update(this.table,t))}))}removeReportContact(e){return v(this,void 0,void 0,(function*(){u.k.info("remove report contact: ",e);let t=yield this.database.find(this.reportContacts);if(t){const n=t.indexOf(e);t.splice(n,1),this.database.update(this.reportContacts,t)}}))}removeReportPhone(e){return v(this,void 0,void 0,(function*(){u.k.info("remove report phone: ",e);let t=yield this.database.find(this.reportPhones);if(t){const n=t.indexOf(e);t.splice(n,1),this.database.update(this.reportPhones,t)}}))}removeReportEmail(e){return v(this,void 0,void 0,(function*(){u.k.info("remove report email: ",e);let t=yield this.database.find(this.reportEmails);if(t){const n=t.indexOf(e);t.splice(n,1),this.database.update(this.reportEmails,t)}}))}uploadReportImage(e){return v(this,void 0,void 0,(function*(){u.k.info("upload report image: ",e.files.path);let t=this.auth.getAuthProfile();const n=new h,r=Date.now();let i={appInfo:{appId:c.kJ,operStaff:c.eW,orgId:c.TY,sign:"",tenantId:(null==t?void 0:t.tenantId)||-2,timeStamp:r}};i.appInfo.sign=(0,c.gw)(r,c.eW,i.appInfo.tenantId);for(let e in i.appInfo)n.append(e,i.appInfo[e]);n.append("files",null,{filename:e.files.name,contentType:e.files.type});return yield this.request.api({url:"api/v2/client/uploadWsheetFile",method:"post",headers:n.getHeaders(),data:n})}))}submitReport(e){return v(this,void 0,void 0,(function*(){u.k.info("create worksheet",e);const t=yield this.request.api({url:"api/wsheet/client/createWorkSheet",method:"post",data:e});let n=e.wheetInfo.mobilePhone;const r=yield this.auth.getAuthProfile();return r&&(n=r.userAccount),t.data}))}setEvaluation(e){return v(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getEvaluation(e){return v(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}setUrge(e){return v(this,void 0,void 0,(function*(){const e=yield this.auth.getAuthProfile();if(e){e.userAccount}}))}getUrge(e){return v(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}uploadReportFeedback(e){return v(this,void 0,void 0,(function*(){const t=new h;t.append("files",e.files,e.files.name);return(yield this.request.api({method:"post",url:"api/wsheet/client/uploadFeedbackFile",headers:{"Content-Type":"multipart/form-data,multipart/*"},params:{wsheetId:e.wsheetId},data:t})).data}))}downloadFile(e){return v(this,void 0,void 0,(function*(){const t=(yield this.request.api({url:"api/v2/client/downloadWsheetFile",method:"get",params:e,responseType:"stream"})).data;return t.pipe(null),u.k.info(t),t}))}getDownloadItemInfo(e){return v(this,void 0,void 0,(function*(){}))}getHistoryReport(e){return v(this,void 0,void 0,(function*(){return yield this.request.api({url:"api/v2/client/qryWorkSheet",method:"post",data:e})}))}getFeedback(e){return v(this,void 0,void 0,(function*(){return(yield this.request.api({url:"api/wsheet/client/qryFeedbackMsg",method:"get",params:e})).data}))}replyReportFeedback(e){return v(this,void 0,void 0,(function*(){return(yield this.request.api({method:"post",url:"api/wsheet/client/replyWorkSheet",data:e})).data}))}getkey(){return window.atob(this.ack.slice(20)+this.ack.slice(0,20))}uploadLog(e,t){return v(this,void 0,void 0,(function*(){let n=u.k.getLogs();if(0!==n.length)try{let r=m()().format("YYYY-MM-DD-HH-mm-ss"),i=`web-${e}-${r}.log`,o=(0,f.JQ)(`${i}${e}${this.getkey()}`),s={url:"api/cdserv/client/clientlog/genReportUrl",method:"get",params:{fileName:i,account:e,checksum:o}};t&&(s.params.wsheetId=t);let a=new File(n,i),c=yield this.request.api(s);yield this.request.send({url:decodeURIComponent(c.data),method:"put",data:a,headers:{"Content-Type":"application/octet-stream"},maxContentLength:1/0}),u.k.cleanLogs()}catch(e){u.k.error(`日志上传失败:${e.message}`)}}))}};w=g([(0,s.Xn)(),y("design:paramtypes",["function"==typeof(r=void 0!==a.cf&&a.cf)?r:Object,"function"==typeof(i=void 0!==l.g&&l.g)?i:Object,"function"==typeof(o=void 0!==d.v&&d.v)?o:Object])],w)},96839:(e,t,n)=>{"use strict";var r,i,o,s,a,c,d,u,h,l;n.d(t,{LQ:()=>h,V3:()=>s,V6:()=>a,Wm:()=>r,c_:()=>u,jN:()=>d,l6:()=>c,l9:()=>l,mV:()=>i,w4:()=>o}),function(e){e[e.default=0]="default",e[e.clear=1]="clear",e[e.smooth=2]="smooth",e[e.custom=3]="custom"}(r||(r={})),function(e){e[e.gray=1]="gray",e[e["16-bit"]=2]="16-bit",e[e["24-bit"]=3]="24-bit",e[e["32-bit"]=4]="32-bit"}(i||(i={})),function(e){e[e.general=1]="general",e[e.good=2]="good",e[e.excellent=3]="excellent"}(o||(o={})),function(e){e[e.picUpperFrameRatio=15]="picUpperFrameRatio",e[e.videoFrameRatio=25]="videoFrameRatio",e[e.videoFrameRatioGPU=50]="videoFrameRatioGPU",e[e.videoQuality=3]="videoQuality",e[e.videoQualityGPU=3]="videoQualityGPU",e[e.picQuality=4]="picQuality",e[e.subjpegQuality=90]="subjpegQuality"}(s||(s={})),function(e){e[e.picUpperFrameRatio=15]="picUpperFrameRatio",e[e.videoFrameRatio=25]="videoFrameRatio",e[e.videoFrameRatioGPU=30]="videoFrameRatioGPU",e[e.videoQuality=3]="videoQuality",e[e.videoQualityGPU=3]="videoQualityGPU",e[e.picQuality=4]="picQuality",e[e.subjpegQuality=100]="subjpegQuality"}(a||(a={})),function(e){e[e.picUpperFrameRatio=20]="picUpperFrameRatio",e[e.videoFrameRatio=30]="videoFrameRatio",e[e.videoFrameRatioGPU=50]="videoFrameRatioGPU",e[e.videoQuality=2]="videoQuality",e[e.videoQualityGPU=1]="videoQualityGPU",e[e.picQuality=4]="picQuality",e[e.subjpegQuality=80]="subjpegQuality"}(c||(c={})),function(e){e[e.picUpperFrameRatio=15]="picUpperFrameRatio",e[e.videoFrameRatio=25]="videoFrameRatio",e[e.videoFrameRatioGPU=50]="videoFrameRatioGPU",e[e.videoQuality=3]="videoQuality",e[e.videoQualityGPU=3]="videoQualityGPU",e[e.picQuality=4]="picQuality",e[e.subjpegQuality=90]="subjpegQuality"}(d||(d={})),function(e){e[e.flowChartConfig=1]="flowChartConfig",e[e.videoFrameRatio=30]="videoFrameRatio",e[e.videoQuality=1]="videoQuality"}(u||(u={})),function(e){e[e.flowChartConfig=1]="flowChartConfig",e[e.videoFrameRatio=30]="videoFrameRatio",e[e.videoQuality=2]="videoQuality"}(h||(h={})),function(e){e[e.flowChartConfig=1]="flowChartConfig",e[e.videoFrameRatio=30]="videoFrameRatio",e[e.videoQuality=3]="videoQuality"}(l||(l={}))},11299:(e,t,n)=>{"use strict";n.d(t,{I:()=>m});var r=n(14334),i=n(48402),o=n(6298),s=n(55304),a=n(6522),c=n(19816),d=n(74178),u=n(20490),h=n(17999),l=n(63102),f=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},p=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let m=class extends u.h{constructor(){super(...arguments),this.clink=i.nC.get(r.WY),this.desktop=i.nC.get(s.hD),this.env=i.nC.get(a.Xb),this.auth=i.nC.get(o.g),this.useRoute=(0,h.yj)(),this.eventDispatcher=new d.pB}init(){this.registerListeners()}connecting(){}connected(){}exit(){this.eventDispatcher.dispose()}registerListeners(){this.clink.onClipboardUpdate.on((e=>{if(c.k.info("onClipboardUpdate",e.type),1===e.type)navigator.clipboard.writeText(e.data);else{let t=new Blob([e.data],{type:"image/png"}),n=[new ClipboardItem({"image/png":t})];navigator.clipboard.write(n).then((function(){}),(function(){}))}}))}sendClipboardData(){navigator.clipboard&&navigator.clipboard.read?navigator.clipboard.read().then((e=>{let t=0,n="",i=null;for(let o=0;o<e.length;o++){if(e[o].types.includes("text/plain")){t=r.Y6.TEXT,n="text/plain",i=e[o];break}if(e[o].types.includes("image/png")){t=r.Y6.IMAGE,n="image/png",i=e[o];break}}i&&i.getType(n).then((e=>{e&&e.arrayBuffer().then((e=>{this.clink.clipboard({type:t,data:e})}))})).catch((e=>{c.k.error(`clipboardItem getType failed: ${e.message}`)}))})).catch((e=>{c.k.error(`clipboard read failed: ${e.message}`)})):c.k.error("navigator clipboard not supported")}sendClipboard(){return p(this,void 0,void 0,(function*(){try{let e=yield(0,l.Hh)("clipboard-read");if(!e)return void c.k.error("permissions clipboard not supported!");"granted"!=e.state&&"prompt"!=e.state||this.sendClipboardData()}catch(e){c.k.error(`permissions clipboard-read failed: ${e.message}`)}}))}};m=f([(0,i.b2)()],m)},10483:(e,t,n)=>{"use strict";n.d(t,{C:()=>_});var r=n(14334),i=n(48402),o=n(6298),s=n(55304),a=n(6522),c=n(19816),d=n(74178),u=n(20490),h=n(17999),l=n(99465);var f=n(29997),p=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class{constructor(){this.MAX_WIDTH=1920,this.MAX_HEIGHT=1080,this.realResolutionEnable=!0}enableUnlimitedResolution(){return!0}getMaxResolution(e){let{width:t,height:n}=e;if(f.k.info("[getMaxResolution]enableUnlimitedResolution:",this.enableUnlimitedResolution()),this.enableUnlimitedResolution()||(t>this.MAX_WIDTH||n>this.MAX_HEIGHT)&&(t=this.MAX_WIDTH,n=this.MAX_HEIGHT),window.innerHeight>window.innerWidth){let e=t;t=n,n=e}return{width:t,height:n}}getMaxResolutionByString(e){let t={width:this.MAX_WIDTH,height:this.MAX_HEIGHT};if(e&&/^\d+x\d+$/i.test(e)){let n=e.split(/x/i);t.width=Number(n[0]),t.height=Number(n[1])}return this.getMaxResolution(t)}limitResolution(e){let{resolution:t,upperResolution:n}=e;if(n&&"string"!=typeof n||(n=this.getMaxResolutionByString(n)),f.k.info("[limitResolution] max resolution: ",n),t.width>n.width||t.height>n.height){let e=Number((t.width/t.height).toFixed(4));t.width=n.width,t.height=Math.floor(t.width/e)}return t}limitScale(e){let{resolution:t,upperResolution:n,scale:r}=e;return n&&"string"!=typeof n||(n=this.getMaxResolutionByString(n)),(t.width>n.width||t.height>n.height)&&(r=1),r}};g=p([(0,i.Xn)(),m("design:paramtypes",[])],g);var y=n(97114),v=n(5341),w=n(88533),k=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},E=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let _=class extends u.h{constructor(){super(...arguments),this.clink=i.nC.get(r.WY),this.desktop=i.nC.get(s.hD),this.display=i.nC.get(g),this.env=i.nC.get(a.Xb),this.auth=i.nC.get(o.g),this.useRoute=(0,h.yj)(),this.eventDispatcher=new d.pB,this.realResolutionEnable=this.display.realResolutionEnable,this.isGPU=this.desktop.connection.desktop.isGPU,this.upperResolution=this.desktop.connection.desktop.upperResolution,this.enableScale=1,this.lastFrame=null,this.fps={frame:0,lastTime:Date.now(),lastFameTime:Date.now(),timer:null,result:0},this.isBodyTransform=v.tq&&"1"===localStorage.getItem("isTransform"),this.isWeixinFullScreen=Boolean(!this.isBodyTransform&&v.tq&&v.mJ&&document.fullscreenElement),this._onUpdateDisplaySize=d.ju.createEmitter(),this.onUpdateDisplaySize=d.ju.createEmitterListener(this._onUpdateDisplaySize)}init(){this.registerListeners()}connecting(){}connected(){this.resizeWindow(),this.clink.onClinkStateChange.on((e=>{e.state===r.j4.CONNECTED&&this.resizeWindow()}))}exit(){this.eventDispatcher.dispose()}registerListeners(){this.eventDispatcher.on(window,"resize",(()=>{this.resizeHandler()})),this.clink.onImageUpdate.on((e=>{0===e.display_id&&this.convertFps()}))}resizeHandler(){this.isWeixinFullScreen!==Boolean(!this.isBodyTransform&&v.tq&&v.mJ&&document.fullscreenElement)&&(this.isWeixinFullScreen=!this.isWeixinFullScreen,w.$x.emit(w.eM.FULL_SCREEN_CHANGE_WEIXIN,this.isWeixinFullScreen)),this.resizeWindow()}updateTransform(e){this.isBodyTransform=e,this.resizeWindow()}resizeWindow(){return E(this,void 0,void 0,(function*(){if(!this.desktop.connection)return;let e=yield this.countDisplaySize();c.k.info("[module][display] displaySize ",e);let{realWidth:t,realHeight:n,scale:r}=e;this.clink.resize({width:t,height:n,x:0,y:0}),this.clink.sendScaleChangeToVdagent({desktop_id:0,display_id:0,scale:r||100}),this._onUpdateDisplaySize.fire(e)}))}limitResolution(e,t){return E(this,void 0,void 0,(function*(){return c.k.info("[screen] get max resolution: ",this.upperResolution),this.display.limitResolution({resolution:{width:e,height:t},upperResolution:this.upperResolution})}))}countDisplaySize(){return E(this,void 0,void 0,(function*(){let{scaleFactor:e,coordScaleFactor:t}=yield this.getFactor(),n=(0,y.k)(window.innerWidth),r=(0,y.k)(window.innerHeight);!this.isBodyTransform&&this.isWeixinFullScreen&&(r-=28);let i=n,o=r,s=100*e;this.realResolutionEnable&&(i=Math.floor(e*n),o=Math.floor(e*r)),c.k.info(`[Screen] before limit resolution: ${i} x ${o}, scale is ${s}`);let a=yield this.limitResolution(i,o);if(i=(0,y.k)(a.width),o=(0,y.k)(a.height),v.tq&&v.fr&&(n*=window.devicePixelRatio,r*=window.devicePixelRatio),this.isBodyTransform){let e=n,t=i;n=r,r=e,i=o,o=t}return{styleWidth:n,styleHeight:r,realWidth:i,realHeight:o,scale:s,scaleFactor:e,coordScaleFactor:t}}))}getFactor(){return E(this,void 0,void 0,(function*(){let e=1,t=1;if(this.realResolutionEnable){let n=0,r=0,i=yield this.display.getMaxResolutionByString(this.upperResolution);e=window.devicePixelRatio,0===n&&(n=window.innerWidth*e,r=window.innerHeight*e),(parseInt(String(n))>i.width||parseInt(String(r))>i.height||0===this.enableScale)&&(t=window.devicePixelRatio,e=1)}return{scaleFactor:e,coordScaleFactor:t}}))}setLastFrame(e){this.lastFrame=e}adjustCursorCoordinate(e,t){let n=e,r=t;if(this.isBodyTransform){let e=n;n=r,r=window.innerWidth-e}else this.isWeixinFullScreen&&(r-=(window.innerHeight-r)/window.innerHeight*28);if(this.lastFrame){let{width:e,height:t}=this.lastFrame,i=this.isBodyTransform?window.innerHeight:window.innerWidth,o=this.isBodyTransform?window.innerWidth:window.innerHeight;e!==i&&(n=Math.floor(n*(e/i))),t!==o&&(r=Math.floor(r*(t/o)))}return n=Math.floor(n),r=Math.floor(r),[n,r]}convertFps(){this.fps.timer&&clearTimeout(this.fps.timer);let e=Date.now();this.fps.lastFameTime=e,this.fps.frame++,e>1e3+this.fps.lastTime&&(this.fps.result=Math.round(1e3*this.fps.frame/(e-this.fps.lastTime)),this.fps.frame=0,this.fps.lastTime=e),this.fps.timer=setTimeout((()=>{this.fps.result=0}),1e3)}resetWindowByTransform(e){this._onUpdateDisplaySize.fire(e)}};k([(0,l.Ds)(500),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],_.prototype,"resizeHandler",null),_=k([(0,i.b2)()],_)},76946:(e,t,n)=>{"use strict";n.d(t,{Q:()=>v});var r,i=n(14334),o=n(48402),s=n(6298),a=n(55304),c=n(6522),d=n(19816),u=n(74178),h=n(20490),l=n(17999),f=n(20234),p=n(97471),m=n(32357),g=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let v=class extends h.h{constructor(e){super(),this.inputs=e,this.clink=o.nC.get(i.WY),this.desktop=o.nC.get(a.hD),this.env=o.nC.get(c.Xb),this.auth=o.nC.get(s.g),this.useRoute=(0,l.yj)(),this.eventDispatcher=new u.pB,this.dragState=f.FP.INIT,this.dragging=!1,this.lastMouseDownEvent=null,this._onFileDraging=u.ju.createEmitter(),this.onFileDraging=u.ju.createEmitterListener(this._onFileDraging)}init(){this.registerListeners()}connecting(){}connected(){}exit(){this.eventDispatcher.dispose()}isMouseExceed(e,t){return e<0||e>window.innerWidth||t<0||t>window.innerHeight}setDragging(e){this.dragging=!1,this._onFileDraging.fire(e)}registerListeners(){this.clink.onVMDragState.on((e=>{d.k.info("onVMDragState",e.type),this.dragState=e.type,this.dragState!==f.FP.DRAGING&&this.setDragging(!1)})),this.clink.onFileTaskState.on((e=>{1!==e.errorFlag&&100!==e.percent&&m.A.open("fileTransfer",{options:{task:e}})})),this.eventDispatcher.on(document,"mousedown",(e=>{this.lastMouseDownEvent=e})),this.eventDispatcher.on(document,"mousemove",(e=>{let t=e;1===t.buttons&&1===this.dragState&&this.setDragging(this.isMouseExceed(t.clientX,t.clientY))})),this.eventDispatcher.on(document,"mouseup",(e=>{let t=e;this.setDragging(!1),this.isMouseExceed(t.clientX,t.clientY)&&this.dragend(e)}))}dragend(e){1===this.dragState&&this.clink.dragEnd(1),this.lastMouseDownEvent&&(this.inputs.sendMouseEvent(this.lastMouseDownEvent,i.PO.MOVE),1===this.dragState&&"windows"!==this.desktop.connection.desktop.osType.toLocaleLowerCase()||this.inputs.sendMouseEvent(this.lastMouseDownEvent,i.PO.UP),1===this.dragState&&"linux"===this.desktop.connection.desktop.osType.toLocaleLowerCase()&&setTimeout((()=>{this.inputs.sendMouseEvent(this.lastMouseDownEvent,i.PO.UP)}),1e3)),this.dragState=2,this.setDragging(!1)}};v=g([(0,o.b2)(),y("design:paramtypes",["function"==typeof(r=void 0!==p.g&&p.g)?r:Object])],v)},28706:(e,t,n)=>{"use strict";n.d(t,{N:()=>se});var r=n(14334),i=n(48402),o=n(86756),s=n(6298),a=n(55304),c=n(6522),d=n(44876),u=n(19816),h=n(88533),l=n(20490),f=n(74178),p=n(61273),m=(n(94684),n(96839)),g=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},y=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let v=class extends l.h{constructor(){super(...arguments),this.clink=i.nC.get(r.WY),this.desktop=i.nC.get(a.hD),this.env=i.nC.get(c.Xb),this.auth=i.nC.get(s.g),this.report=i.nC.get(d.yG),this.eventDispatcher=new f.pB,this.reconnectStartTime=0,this.reconnectTimes=0,this.reconnectTimeout=null}init(){this.reconnectStartTime=0,this.reconnectTimeout&&window.clearTimeout(this.reconnectTimeout)}isPhone(){return this.env.getSystemModel()===c.D0.PHONE}connecting(){this.handleSystemStateChange(),this.handleAgentStateChange(),this.handleAgentData(),this.handleRemoteStateChange(),this.handleMessageUpdate()}connected(){this.handleClinkStateChange(),this.handleAppState(),this.registerListeners(),this.handleGPUDisplayStrategy()}exit(){this.eventDispatcher.dispose()}registerListeners(){h.$x.on(h.eM.LOCK_SCREEN,(e=>this.handleLock(e)))}handleLock(e){e?this.clink.setAppState(r.aB.BACK):this.clink.setAppState(r.aB.FRONT)}handleAppState(){let e=()=>{"visible"===document.visibilityState?this.clink.setAppState(r.aB.FRONT):this.clink.setAppState(r.aB.BACK)};this.eventDispatcher.on(document,"visibilitychange",e),e()}handleClinkStateChange(){return y(this,void 0,void 0,(function*(){this.clink.onClinkStateChange.on((e=>y(this,void 0,void 0,(function*(){switch(e.state){case r.j4.CONNECTED:this.reconnectStartTime=0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.reconnectTimes=0;break;case r.j4.CONNECTFAILED:u.k.info("连接失败"),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null);let e=2e3;this.desktop.connectionInfo&&this.desktop.connectionInfo.reconnectTimeInterval&&(e=1e3*this.desktop.connectionInfo.reconnectTimeInterval),this.reconnectTimeout=setTimeout((()=>{this.reconnect()}),e)}}))))}))}reconnect(){return y(this,void 0,void 0,(function*(){if(u.k.info(`systemState: ${this.clink.systemState}, remoteState: ${this.clink.remoteState}`),this.clink.systemState===r.lB.OFFLINE||this.clink.remoteState===r.mQ.SHUTDOWN||!this.desktop.activeConnection)return;u.k.info("发起重连"),0===this.reconnectStartTime&&(this.reconnectStartTime=Date.now());let e=18e4;if("number"==typeof this.desktop.connectionInfo.reconnectTimeLimited&&(e=1e3*this.desktop.connectionInfo.reconnectTimeLimited),Date.now()-this.reconnectStartTime<e){if(this.desktop.connection.desktop.isPool){if(this.desktop.connection.desktop.desktopId!==(yield this.desktop.connectDesktop(this.desktop.connection.id)).desktop.desktopId)return void o.T.alert("当前云电脑连接已断开，已为您退出云电脑，如需重新连接云电脑请在桌面列表点击“进入”","云电脑连接已断开",{type:"warning",dangerouslyUseHTMLString:!0,closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1}).then((()=>{this.exitDesktop()}))}return this.clink.stop(),void(this.desktop.connection&&this.desktop.connection.clinkConfig&&this.clink.run(this.desktop.connection.clinkConfig))}this.isPhone()?p.V.alert({title:"提示",message:"云手机的连接断开，请检查本地网络是否正常或重新连接云手机。"}).then((()=>{this.exitDesktop()})):o.T.alert("<strong>云电脑的连接断开</strong><br>请检查本地网络是否正常或重新连接云电脑。","提示",{type:"warning",dangerouslyUseHTMLString:!0,closeOnClickModal:!1,closeOnPressEscape:!1,showCancelButton:!1,showClose:!1,confirmButtonText:"退出"}).then((()=>{this.exitDesktop()})),h.$x.emit("hide-reconnect-dialog")}))}handleSystemStateChange(){this.clink.onSystemStateChange.on((e=>{switch(u.k.info("system state:",e.state),e.state){case r.lB.OFFLINE:u.k.info("用户被踢下线"),this.isPhone()?p.V.alert({title:"提示",message:"该云手机在其他地方登录，您已被强制下线"}).then((()=>{this.exitDesktop()})):o.T.alert("该云电脑在其他地方登录，您已被强制下线","提示",{confirmButtonText:"确定",closeOnClickModal:!1,closeOnPressEscape:!1,showCancelButton:!1,type:"warning",dangerouslyUseHTMLString:!0,customClass:"ct-message-dialog",callback:()=>y(this,void 0,void 0,(function*(){this.exitDesktop()}))});case r.lB.WS_FAILED:}}))}handleAgentData(){this.clink.onAgentData.on((e=>y(this,void 0,void 0,(function*(){if(e.type===r.je.REQUEST_CLIENT_VERSION)this.sendClientVersionToVdagent()}))))}handleAgentStateChange(){this.clink.onAgentStateChange.on((e=>{if(u.k.info("agent connect state: ",e),e.state!==r.CV.CONNECTED)return;let t=this.auth.getAuthProfile();t&&(this.sendClientVersionToVdagent(),this.clink.sendClientInfoToVdagent({account:t.userAccount,host:this.env.getFileHost(),desktop_id:this.desktop.connection.desktop.desktopId,user_id:String(t.userId),markData:this.desktop.connectionInfo.markData}),this.clink.sendAgentMessage(r.je.CLIPBOARD,{status:"1"===this.desktop.connectionInfo.clipBoardOut?1:0}))}))}sendClientVersionToVdagent(){return y(this,void 0,void 0,(function*(){let e=this.desktop.connection;if(!e.clinkConfig||!e.connectionInfo)return;let t={ctyunClientType:"10010",ctgappmodel:this.env.getAppModel(),appid:"8237721452"},n=this.auth.getAuthProfile();n&&n.oauthToken&&(t.ctyunAccessToken=n.oauthToken),this.clink.sendClientVersionToVdagent({version:this.env.getAppVersionCode(),deviceType:this.env.getDeviceType(),deviceCode:this.env.getDeviceCode(),configs:t})}))}handleRemoteStateChange(){return y(this,void 0,void 0,(function*(){this.clink.onRemoteStateChange.on((e=>y(this,void 0,void 0,(function*(){e.state===r.mQ.SHUTDOWN&&(u.k.info("agent检测到桌面关机"),this.isPhone()?p.V.alert({title:"提示",message:"云手机正在进行关机或者重启，如果有疑问请联系管理员。"}).then((()=>{const e=this.desktop.connection.desktop.objId;this.exitDesktop(e)})):o.T.alert("云电脑正在进行关机或者重启，如果有疑问请联系管理员。","提示",{confirmButtonText:"确定",showClose:!1,callback:()=>{this.exitDesktop()}}))}))))}))}handleMessageUpdate(){this.clink.onMessageUpdate.on((e=>{if(u.k.info("onMessageUpdate",e),"message_center"===e.type)return;let t=e.body;if("signal"!==t.type)switch(t.actionType){case r.C9.LOCK_DESKTOP:this.confirmExit("提示","抱歉，您的云电脑已被锁定");break;case r.C9.GPU_HIGH_TEMP_RESTART:u.k.info("GPU显卡温度过高请重启"),o.T.confirm("您使用的显卡温度过高，请保存您的个人资料并重启","异常提醒",{cancelButtonText:"稍后重启",confirmButtonText:"立即重启",type:"warning"}).then((()=>y(this,void 0,void 0,(function*(){u.k.info("GPU显卡温度过高请重启 - 用户点击立即重启"),yield this.desktop.reboot(this.desktop.connection.desktop.desktopId,!0)})))).catch((()=>{u.k.info("GPU显卡温度过高请重启 - 用户点击稍后重启")}));break;case r.C9.UNASSIGN_TRY_DESKTOP:case r.C9.UNASSIGN_POOL_DESKTOP:this.confirmExit(t.title||"云电脑系统正进行关机或重启操作",t.content);break;case r.C9.UNBIND_DEVICE:this.auth.logout({message:{title:"提示",type:"warning",message:"抱歉，您的云电脑已被解绑"}}),u.k.info("退出登录，移除账号信息并且提示解绑设备")}else{const e=this.auth.getAuthProfile();e&&this.report.uploadLog(e.userAccount)}}))}exitDesktop(e){this.desktop.disconnectDesktopConnection(e)}confirmExit(e,t,n){o.T.alert(t,e,{type:"warning",dangerouslyUseHTMLString:!0,closeOnClickModal:!1,closeOnPressEscape:!1,showCancelButton:!1,showClose:!1,confirmButtonText:n||"确定"}).then((()=>{this.exitDesktop()}))}handleGPUDisplayStrategy(){return y(this,void 0,void 0,(function*(){if(this.desktop.connection.desktop.isGPU){u.k.info("画面设置-发送GPU桌面显示策略数据给agent");let e=!1,t=!1;const n=this.desktop.connection.id;let r={display_mode:2,stream_max_fps:m.V3.videoFrameRatioGPU,stream_quality:m.V3.videoQualityGPU};const i=yield this.desktop.getDisplayStrategy(n);if(i){u.k.info("画面设置-获取到本地存储的显示策略数据：",JSON.stringify(i));const n=i,{setting:o}=n;t=!0,0===Number(o.mode)&&(e=!0),r.display_mode=Number(o.mode),o.videoFrameRatioGPU&&(r.stream_max_fps=Number(o.videoFrameRatioGPU)),o.videoQualityGPU&&(r.stream_quality=Number(o.videoQualityGPU))}if(e||!t){e&&u.k.info("画面设置-使用默认设置"),t||u.k.info("画面设置-本地没有显示策略数据");const{desktopInfo:n}=this.desktop.connection.connectionInfo;if(null==n?void 0:n.showStartegy){let e=JSON.parse(n.showStrategy);e.flowChartConfig.option&&(r.display_mode=Number(e.flowChartConfig.option)||2),e.gpuVideoFrameRatio.option&&(r.stream_max_fps=Number(e.gpuVideoFrameRatio.option)),e.videoQuality.option&&(r.stream_quality=Number(e.videoQuality.option))}}u.k.info("画面设置-发送的GPU桌面显示策略数据：",r),this.clink.sendGPUDisplayStrategyToVdagent(r)}}))}};v=g([(0,i.b2)()],v);var w=n(10483),k=n(17999);function b(){return new Worker(n.p+"js/audio.worker.184594.worker.js")}function E(e){this.init(e)}E.prototype.init=function(e){this.option=Object.assign({},{encoding:"32bitFloat",channels:2,sampleRate:48e3,flushingTime:30},e),this.samples=new Float32Array,this.flush=this.flush.bind(this),this.interval=setInterval(this.flush,this.option.flushingTime),this.maxValue=this.getMaxValue(),this.typedArray=this.getTypedArray(),this.createContext()},E.prototype.resume=function(){this.audioCtx&&"suspended"===this.audioCtx.state&&this.audioCtx.resume().then((function(){}))},E.prototype.getMaxValue=function(){var e={"8bitInt":128,"16bitInt":32768,"32bitInt":2147483648,"32bitFloat":1};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},E.prototype.getTypedArray=function(){var e={"8bitInt":Int8Array,"16bitInt":Int16Array,"32bitInt":Int32Array,"32bitFloat":Float32Array};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},E.prototype.createContext=function(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.audioCtx.resume(),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=1,this.audioCtx&&(this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime)},E.prototype.isTypedArray=function(e){return e.byteLength&&e.buffer&&e.buffer.constructor==ArrayBuffer},E.prototype.feed=function(e){if(this.isTypedArray(e)&&this.samples){var t=new Float32Array(this.samples.length+e.length);t.set(this.samples,0),t.set(e,this.samples.length),this.samples=t}},E.prototype.getFormatedValue=function(e){e=new this.typedArray(e.buffer);var t,n=new Float32Array(e.length);for(t=0;t<e.length;t++)n[t]=e[t]/this.maxValue;return n},E.prototype.volume=function(e){this.gainNode.gain.value=e},E.prototype.destroy=function(){this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx.close(),this.audioCtx=null},E.prototype.flush=function(){if(this.samples.length){var e,t,n,r,i,o=this.audioCtx.createBufferSource(),s=this.samples.length/this.option.channels,a=this.audioCtx.createBuffer(this.option.channels,s,this.option.sampleRate);for(t=0;t<this.option.channels;t++)for(e=a.getChannelData(t),n=t,i=50,r=0;r<s;r++)e[r]=this.samples[n],r<50&&(e[r]=e[r]*r/50),r>=s-51&&(e[r]=e[r]*i--/50),n+=this.option.channels;this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),o.buffer=a,o.connect(this.gainNode),o.start(this.startTime),this.startTime+=a.duration,this.samples=new Float32Array}};const _=E;var S=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};let D=class extends l.h{constructor(){super(...arguments),this.clink=i.nC.get(r.WY),this.desktop=i.nC.get(a.hD),this.env=i.nC.get(c.Xb),this.auth=i.nC.get(s.g),this.useRoute=(0,k.yj)(),this.eventDispatcher=new f.pB,this.audio=new Audio,this.streamBufferQueue=[],this.sourceBuffer=null,this.readyAppend=!0,this.volumeValue=0}init(){this.isUseNativeAudio()?this.buildMideaSource():(this.worker=new b,this.pcm=new _,this.registerWorkerListener()),this.registerListeners()}connecting(){}connected(){}exit(){this.pcm.destroy(),this.eventDispatcher.dispose()}registerListeners(){this.clink.onAudioStateChange.on((e=>e.state===r.Zv.OPEN?(u.k.log("开启音频播放"),void this.initAudio()):e.state===r.Zv.CLOSE?(u.k.log("关闭音频播放"),this.mediaSource.endOfStream(),this.mediaSource.this.audio.src="",void this.pcm.destroy()):void 0)),h.$x.on(h.eM.DOCUMENT_TOUCH_START,(()=>{this.pcm&&this.pcm.resume()})),this.clink.onAudioUpdate.on((e=>{!e.opusBuffer||this.isUseNativeAudio()?(u.k.debug("audio update"),this.sourceBuffer&&this.readyAppend?(this.readyAppend=!1,this.sourceBuffer.appendBuffer(e.data)):this.streamBufferQueue.push(e.data)):this.worker.postMessage(e.opusBuffer,[e.opusBuffer])})),this.clink.onClinkStateChange.on((e=>{e.state,r.j4.CONNECTFAILED})),this.clink.onAudioVolumeChange.on((e=>{this.setAudioVolume(e)})),this.clink.onAudioMuteChange.on((e=>{this.setAudioMute(e)}))}buildMideaSource(){return new Promise(((e,t)=>{const n=new MediaSource;this.sourceBuffer=null,this.streamBufferQueue=[],this.mediaSource=n,n.addEventListener("sourceopen",(()=>{u.k.info("audio sourceopen"),this.audio.muted=!1,this.audio.play().catch((e=>u.k.error(e)));let t=this.sourceBuffer=n.addSourceBuffer('audio/webm; codecs="opus"');this.sourceBuffer,t.addEventListener("update",(()=>{this.onSourceBufferUpdate(t)})),t.addEventListener("error",(()=>{u.k.error("sourceBuffer error")})),e(t),this.onSourceBufferUpdate(t)})),n.addEventListener("sourceclose",(()=>{u.k.info("audio sourceclose")})),n.addEventListener("sourceended",(()=>{u.k.info("audio sourceended")}));try{this.audio.muted=!0,this.audio.autoplay=!0,this.audio.src=URL.createObjectURL(n)}catch(e){t(e),u.k.error(e)}}))}onSourceBufferUpdate(e){if(this.readyAppend=this.checkSourceBufferCache(),!this.readyAppend)return;let t=this.streamBufferQueue.shift();t?(this.readyAppend=!1,e.appendBuffer(t)):this.readyAppend=!0}checkSourceBufferCache(){if(!this.sourceBuffer)return!1;let e=this.sourceBuffer.buffered;if(e.length<1)return!0;let t=e.start(0),n=e.end(0),r=this.audio.currentTime,i=0;return r<t||n-r>.8?(u.k.info("audio set currentTime "+(n-.3)),this.audio.currentTime=n-.3,!0):(r-t>10&&(i=r-5),0===i||(u.k.debug(`remove audio cache ${t}, ${i}`),this.sourceBuffer.remove(t,i),!1))}initAudio(){this.isUseNativeAudio()&&(this.audio.src&&URL.revokeObjectURL(this.audio.src),this.streamBufferQueue=[],this.buildMideaSource())}setAudioVolume(e){e.type===r.ww.OUTPUT&&(this.volumeValue=e.vol,this.audio.volume=e.vol,this.pcm&&this.pcm.volume(e.vol))}setAudioMute(e){e.type===r.ww.OUTPUT&&(this.pcm&&this.pcm.volume(e.mute?0:this.volumeValue),this.audio.muted=e.mute)}registerWorkerListener(){this.worker.onmessage=e=>{const{audio32Buffer:t}=e.data;this.pcm.feed(t)},this.worker.onerror=e=>{u.k.error(e)}}isUseNativeAudio(){if(!window.MediaSource)return!1;const e=navigator.userAgent.toLowerCase();return!(/(safari)/.test(e)&&!/(chrome)/.test(e))}};D=S([(0,i.b2)()],D);var C=n(11299),R=n(97471),M=n(76946),P=n(18883),T=n(60364),A=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},x=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let F=class extends l.h{constructor(){super(...arguments),this.messageService=i.nC.get(T.v),this.clink=i.nC.get(r.WY),this.agentCallers=new Map,this.idGenerator=new P.R("message#")}init(){}connecting(){}connected(){return x(this,void 0,void 0,(function*(){this.initMessageCenterListener(),this.messageService.getMessageData()}))}exit(){}initMessageCenterListener(){return x(this,void 0,void 0,(function*(){this.clink.onMessageUpdate.on((e=>x(this,void 0,void 0,(function*(){"message_center"===e.type&&e.body.messageChange&&this.messageService.getMessageData()})))),this.clink.onAgentData.on((e=>x(this,void 0,void 0,(function*(){if(e.type===r.je.MESSAGE_FROM_AGENT)this.messageService.receiveAgentMessage(e.data)}))))}))}};F=A([(0,i.b2)()],F);var O=n(3048),I=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},U=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let B=class extends l.h{constructor(){super(...arguments),this.autoTak=i.nC.get(O.rA)}connected(){return U(this,void 0,void 0,(function*(){this.autoTak.initDesktopTask()}))}exit(){this.autoTak.clearDesktopTask()}};B=I([(0,i.b2)()],B);var N=n(99465);var j=n(73827);const L=n(25448);const z=class{constructor(e,t,n,r,i,o){L().then((s=>{s?(this.libModule=s,this.encoder=s._Encoder_new(e,t,n,r,i),this.out=s._String_new()):(u.k.error("初始化编码器失败"),setTimeout((()=>{j.z8.error("音频通话功能异常，请刷新重试~"),o()}),500))}))}input(e){if(!this.libModule)return;const t=this.libModule._malloc(e.length*e.BYTES_PER_ELEMENT);new Uint8Array(this.libModule.HEAPU8.buffer,t,e.length*e.BYTES_PER_ELEMENT).set(new Uint8Array(e.buffer,e.byteOffset,e.length*e.BYTES_PER_ELEMENT)),this.libModule._Encoder_input(this.encoder,t,e.length),this.libModule._free(t)}output(){if(this.libModule)return this.libModule._Encoder_output(this.encoder,this.out)?new Uint8Array(this.libModule.HEAPU8.buffer,this.libModule._String_data(this.out),this.libModule._String_size(this.out)):void 0}destroy(){this.libModule&&(this.libModule._Encoder_delete(this.encoder),this.libModule._String_delete(this.out))}};var W=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};class H{constructor(e){this.audioStream=null,this.pcmBuffer=new Int16Array(0),e||(this.config={sampleRate:48e3,numberChannels:2,bitDepth:16,splitBytes:1920})}onaudioprocess(e){if(2===this.config.numberChannels){const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1);this.handlePcm(new Float32Array(t),new Float32Array(n))}}handlePcm(e,t){if(0===e[0]&&0===e[1]&&0===t[0]&&0===t[1])return;const n=this.config.splitBytes/Int16Array.BYTES_PER_ELEMENT;let r=this.compress(e,t),i=this.encodePCM(r,this.config.bitDepth,!0);for(this.pcmBuffer=this.appendBuffer(this.pcmBuffer,new Int16Array(i.buffer));this.pcmBuffer.byteLength>=this.config.splitBytes;){const e=this.pcmBuffer.slice(0,n);this.pcmBuffer=this.pcmBuffer.slice(n);try{if(!this.encoder)return;this.encoder.input(e);const t=this.encoder.output();if(!t)return;this.callback(t)}catch(e){u.k.error(e)}u.k.debug("当前pcmBuffer缓存int16长度",this.pcmBuffer.length)}}init(){return new Promise((e=>{this.context=new window.AudioContext;const t=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=t.apply(this.context,[512,this.config.numberChannels,this.config.numberChannels]),u.k.info("开启音频采集"),this.recorder.onaudioprocess=this.onaudioprocess.bind(this),this.encoder=this.encoder?this.encoder:new z(2,48e3,16e3,10,!1,this.close.bind(this))}))}open(){return new Promise((e=>W(this,void 0,void 0,(function*(){try{const t=yield navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}});this.audioStream&&this.close(),this.audioStream=t,this.audioInput=this.context.createMediaStreamSource(t),this.audioInput.connect(this.recorder),this.recorder.connect(this.context.destination),e(t)}catch(e){}}))))}close(){this.audioInput&&this.audioInput.disconnect(),this.recorder&&this.recorder.disconnect(),this.audioStream&&(this.audioStream.getAudioTracks().forEach((e=>e.stop())),this.audioStream=null,u.k.info("关闭音频采集"))}OnFrame(e){this.callback=e}appendBuffer(e,t){try{const n=new Int16Array(e.length+t.length);return n.set(new Int16Array(e),0),n.set(new Int16Array(t),e.length),n}catch(e){return u.k.error(e),new Int16Array}}compress(e,t){let n=e.length+t.length,r=new Float32Array(n),i=0,o=0;for(;i<n;){let n=o;r[i]=e[n],i++,t.length&&(r[i]=t[n],i++),o+=1}return r}encodePCM(e,t,n=!0){let r=0,i=e.length*(t/8),o=new ArrayBuffer(i),s=new DataView(o);for(let t=0;t<e.length;t++,r+=2){let i=Math.max(-1,Math.min(1,e[t]));s.setInt16(r,i<0?32768*i:32767*i,n)}return s}destory(){try{this.audioStream&&this.close(),this.encoder&&(this.encoder.destroy&&this.encoder.destroy(),this.encoder=null)}catch(e){u.k.error(e)}}recover(){this.close(),this.init(),this.open()}}function G(){return new Worker(n.p+"js/video.worker.184594.worker.js")}let V=null;var Q=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};class Y{constructor(){this._buf=null,this._y=null,this._u=null,this._v=null,this._width=0,this._height=0,this._first_timestamp=-1,this._next_timestamp=-1,this._prev_frame_index=-1,this._fps=0,this._sec_per_frame=0,this.timmer=1,this.prevTimeStamp=0,this.worker=V||(V=new G),this.callback=()=>{},this.first=1,this._video=document.createElement("video"),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")}open(e){return new Promise(((t,n)=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(e.width&&e.height&&{width:e.width,height:e.height},navigator.mediaDevices.getUserMedia({audio:!1,video:Object.assign(Object.assign({},e),{advanced:[{deviceId:e.deviceId}]})}).then((n=>{this._fps=e.fps||5,this._sec_per_frame=1/this._fps,this._first_timestamp=this._prev_frame_index=-1,this.videoStream=n,this._video.srcObject=n,this._video.playsInline=!0,this._video.play(),this._video.width=e.width,this._video.height=e.height,this._context&&(this._context.scale(-1,1),this._context.translate(-e.width,0)),this.worker.postMessage({initConfig:{width:e.width,height:e.height}}),this.worker.onmessage=e=>{this.callback({timestamp:Date.now(),width:this._canvas.width,height:this._canvas.height,data:e.data})},this._video.addEventListener("loadedmetadata",(n=>{var r=this._width=e.width,i=this._height=e.height;this._canvas.width=r,this._canvas.height=i,t({width:r,height:i})}))}),n))}))}readChunk(){var e=1e3/30;window.requestAnimationFrame?(this.frameStreamId=requestAnimationFrame(this.readChunk.bind(this)),Date.now()-this.prevTimeStamp>=e&&(this.prevTimeStamp=Date.now(),this.draw())):(this.timmer=setTimeout(this.readChunk.bind(this),e),this.draw())}OnFrame(e){this.callback=e}init(e){return Q(this,void 0,void 0,(function*(){yield this.open(e),yield this.readChunk(),u.k.info("开启摄像头采集~")}))}close(){this.videoStream&&this.videoStream.getVideoTracks().forEach((e=>e.stop())),this.videoStream=null,window.cancelAnimationFrame(this.frameStreamId),clearTimeout(this.timmer),u.k.info("关闭摄像头采集~"),this.worker.postMessage({close:!0})}draw(){this._context&&(this.first&&(this._context.scale(-1,1),this._context.translate(-this._canvas.width,0),this.first=0),this._context.drawImage(this._video,0,0,this._width,this._height,0,0,this._width,this._height));const e=this._context&&this._context.getImageData(0,0,this._width,this._height)||{};this.worker.postMessage(e)}}var J=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let q=0,X=!0,$=[];const K=function(e,t){return J(this,void 0,void 0,(function*(){if($=yield function(){return J(this,void 0,void 0,(function*(){const e=[];try{yield navigator.mediaDevices.getUserMedia({audio:!1,video:!0})}catch(e){u.k.info("此电脑无摄像头设备：",e)}try{let t=yield navigator.mediaDevices.enumerateDevices();for(const n of t)"videoinput"===n.kind&&"default"!==n.deviceId&&e.push(n)}catch(e){u.k.error(e)}return e}))}(),X){X=!1;if(window.localStorage.getItem("_no_camera_device"))return;if(0===$.length)return j.z8.warning("您电脑没有可用的摄像头设备,将影响视频通话功能~"),void window.localStorage.setItem("_no_camera_device","1");if(!(yield function(){return J(this,void 0,void 0,(function*(){try{if("denied"===(yield navigator.permissions.query({name:"camera"})).state)return j.z8.warning("申请摄像头权限被拒绝，将会影响到视频通话功能"),!1}catch(e){}try{yield navigator.mediaDevices.getUserMedia({video:!0})}catch(e){if(-1!==String(e).indexOf("not allowed"))return j.z8.warning("申请摄像头权限被拒绝"),!1}return!0}))}()))return}const n=yield function(e){return J(this,void 0,void 0,(function*(){const t=[];for(let n=0;n<e.length;n++){const r=e[n];try{const e=(yield navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:r.deviceId}})).getVideoTracks()[0],n=r.deviceId.toLocaleLowerCase(),i=String(Z(n)).replace(/0/gim,"");let o=e.label,s=o,a=i.slice(0,4),c=i.slice(4,8),d=[],u=[[176,144],[320,240]];const h={width:{max:1920,min:1},height:{max:1080,min:1}};let l=e.getCapabilities?e.getCapabilities():h,f=/(.*)\(([0-9a-zA-Z]{4}):([0-9a-zA-Z]{4})\)/,p=o.match(f);e.stop(),p&&(s=p[1].trim()),u.forEach((e=>{l.width&&l.width.max&&l.width.min&&l.height&&l.height.max&&l.height.min&&(e[0]>l.width.max||e[0]<l.width.min||e[1]<l.height.min||e[1]>l.height.max||d.push({width:e[0],height:e[1]}))})),t.push({device_name:s,vid:a,pid:c,framerate:d,deviceId:r.deviceId})}catch(e){u.k.error(e)}}return t}))}($),r=n[q++];r&&(u.k.info("采集到摄像头列表是：",r),e(r,t))}))};function Z(e){var t,n,r=0;if(0===e.length)return r;for(t=0,n=e.length;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r<0?-r:r}var ee=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ne=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};let re=class extends l.h{constructor(){super(),this.clink=i.nC.get(r.WY),this.desktop=i.nC.get(a.hD),this.env=i.nC.get(c.Xb),this.auth=i.nC.get(s.g),this.useRoute=(0,k.yj)(),this.eventDispatcher=new f.pB,this.recorderInstance=new H,this.registedCameraList=[],this.cameraInstanceMap={},this.cameraInstance=null,this.isReocrding=!1,this.clinkCameraInfo={width:640,height:480}}init(){this.registerListeners()}connecting(){}connected(){}exit(){this.eventDispatcher.dispose(),this.recorderInstance.destory(),this.closeAllCamera(),X=!0,q=0}registerListeners(){this.clink.onVideoPortState.on((e=>ne(this,void 0,void 0,(function*(){u.k.info("onVideoPortState",e),e.state===r.LE.DISCONNECTED&&this.closeAllCamera(),e.state===r.LE.CONNECTED&&(yield this.clink.whenAgentConnected(),K(this.addCameraInfo.bind(this),e.index))})))),this.clink.onVideoStartCapture.on((e=>ne(this,void 0,void 0,(function*(){const t=`${e.vid}:${e.pid}`;this.cameraInstanceMap[t].width=e.width,this.cameraInstanceMap[t].height=e.height,this.sendVideoFrame(t)})))),this.clink.onVideoStopCapture.on((e=>ne(this,void 0,void 0,(function*(){const t=`${e.vid}:${e.pid}`;this.closeCamera(t)})))),this.clink.onAudioStartCapture.on((e=>ne(this,void 0,void 0,(function*(){this.isReocrding=!0,this.clink.sendMicorPhoneMode(),this.clink.sendMicorPhoneMark(),this.recorderInstance.init(),this.recorderInstance.OnFrame((e=>{this.clink.sendMicroPhoneData(e)})),this.recorderInstance.open()})))),this.clink.onAudioStopCapture.on((e=>ne(this,void 0,void 0,(function*(){this.recorderInstance.close(),this.isReocrding=!1}))));const e=this;navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=function(t){return ne(this,void 0,void 0,(function*(){e.isReocrding&&e.handleDeviceChange()}))})}handleDeviceChange(){return ne(this,void 0,void 0,(function*(){this.recorderInstance.recover()}))}addCameraInfo(e,t){return ne(this,void 0,void 0,(function*(){try{e&&(this.cameraInstanceMap[`${e.vid}:${e.pid}`]={series:t,deviceId:e.deviceId},this.clink.addCamera(e,t))}catch(e){u.k.error(e)}}))}sendVideoFrame(e){return ne(this,void 0,void 0,(function*(){const t=new Y;this.cameraInstanceMap[e].instance=t,yield t.init(this.cameraInstanceMap[e]),t.OnFrame((t=>{const n=51200;let r=t.data.byteLength,i=0,o=r;for(;o>=n;)this.clink.sendCameraData(t.data.slice(i*n,(i+1)*n),this.cameraInstanceMap[e].series),o-=n,i+=1;if(r<n){let r=t.data;if(0!==i)return void(r=t.data.slice(i*n,o));this.clink.sendCameraData(r,this.cameraInstanceMap[e].series)}}))}))}closeCamera(e){if(this.cameraInstanceMap[e]){const t=this.cameraInstanceMap[e].instance;t&&t.close(),delete this.cameraInstanceMap[e].instance}}destoryVideoStream(){}closeAllCamera(){Object.keys(this.cameraInstanceMap).forEach((e=>{const t=this.cameraInstanceMap[e];t.instance&&t.instance.close()}))}};ee([(0,N.Ds)(500),te("design:type",Function),te("design:paramtypes",[]),te("design:returntype",Promise)],re.prototype,"handleDeviceChange",null),re=ee([(0,i.b2)(),te("design:paramtypes",[])],re);var ie=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};let oe=class extends l.h{constructor(){super(...arguments),this.desktop=i.nC.get(a.hD),this.clink=i.nC.get(r.WY),this.isGPU=this.desktop.connection.desktop.isGPU}agentConnected(){this.isGPU&&this.sendMaxResolutionToAgent()}sendMaxResolutionToAgent(){let e=(this.desktop.connection.desktop.upperResolution||"1920x1080").toLocaleLowerCase().split("x");const t=Number(e[0]),n=Number(e[1]);u.k.info("[module][screen] sendMaxResolutionToAgent ",n),this.clink.sendMaxResolutionToVdagent({maxheight:n,maxwidth:t})}};oe=ie([(0,i.b2)()],oe);const se=new l.q;se.add(v),se.add(w.C),se.add(D),se.add(R.g),se.add(C.I),se.add(M.Q),se.add(F),se.add(B),se.add(re),se.add(oe)},97471:(e,t,n)=>{"use strict";n.d(t,{g:()=>y});var r,i=n(14334),o=n(48402),s=n(6298),a=n(55304),c=n(6522),d=n(74178),u=n(20490),h=n(17999),l=n(10483),f=n(63102),p=n(5341),m=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let y=class extends u.h{constructor(e){super(),this.display=e,this.clink=o.nC.get(i.WY),this.desktop=o.nC.get(a.hD),this.env=o.nC.get(c.Xb),this.auth=o.nC.get(s.g),this.useRoute=(0,h.yj)(),this.eventDispatcher=new d.pB,this.modifierThrottle=null,this.enableDurationLog=!1,this.durations=new Map}init(){}connecting(){}connected(){}sendMouseEvent(e,t){let n=0;if(t===i.PO.MOVE)switch(e.which){case 1:n=i.tc.LEFT;break;case 2:n=i.tc.MIDDLE;break;case 3:n=i.tc.RIGHT}else switch(e.button){case 0:n=i.tc.LEFT;break;case 1:n=i.tc.MIDDLE;break;case 2:n=i.tc.RIGHT;break;case 3:n=i.tc.X_BUTTON_BACK;break;case 4:n=i.tc.X_BUTTON_FORWARD}let[r,o]=this.display.adjustCursorCoordinate(e.offsetX,e.offsetY);p.tq&&([r,o]=this.display.adjustCursorCoordinate(e.clientX,e.clientY));let s={type:t,button:n,display_id:0,x:r,y:o};this.enableDurationLog&&t===i.PO.UP&&this.durations.set(`${r}_${o}`,Date.now()),this.clink.mouse(s)}sendKeyboardEvent(e,t){let n=e.keyCode;229===n&&f.aT[e.code]&&(n=f.aT[e.code]),this.syncModifiers(e),p.V5&&t===i.Jz.UP&&20===e.keyCode&&this.clink.keyboard({type:i.Jz.DOWN,key:e.keyCode}),this.clink.keyboard({type:t,key:n}),p.V5&&t===i.Jz.DOWN&&20===e.keyCode&&this.clink.keyboard({type:i.Jz.UP,key:e.keyCode})}syncModifiers(e){if(this.modifierThrottle)return clearTimeout(this.modifierThrottle),void(this.modifierThrottle=setTimeout((()=>{this.modifierThrottle=null}),800));if([20,145,144].includes(e.keyCode))return;let t=this.clink.getKeyboardModifiers();e.getModifierState("CapsLock")!==(t&i.gT.SPICE_KEYBOARD_MODIFIER_FLAGS_CAPS_LOCK)>0&&this.sendCapsLock(),e.getModifierState("ScrollLock")!==(t&i.gT.SPICE_KEYBOARD_MODIFIER_FLAGS_SCROLL_LOCK)>0&&this.sendScrollLock(),e.getModifierState("NumLock")!==(t&i.gT.SPICE_KEYBOARD_MODIFIER_FLAGS_NUM_LOCK)>0&&this.sendNumLock(),this.modifierThrottle=setTimeout((()=>{this.modifierThrottle=null}),800)}sendCapsLock(){this.clink.keyboard({type:i.Jz.DOWN,key:20}),this.clink.keyboard({type:i.Jz.UP,key:20})}sendScrollLock(){this.clink.keyboard({type:i.Jz.DOWN,key:145}),this.clink.keyboard({type:i.Jz.UP,key:145})}sendNumLock(){this.clink.keyboard({type:i.Jz.DOWN,key:144}),this.clink.keyboard({type:i.Jz.UP,key:144})}sendShortcutCrtlV(){this.clink.keyboard({type:i.Jz.DOWN,key:17}),this.clink.keyboard({type:i.Jz.DOWN,key:86}),this.clink.keyboard({type:i.Jz.UP,key:86}),this.clink.keyboard({type:i.Jz.UP,key:17})}sendShortcutWinD(){this.clink.keyboard({type:i.Jz.DOWN,key:91}),this.clink.keyboard({type:i.Jz.DOWN,key:68}),this.clink.keyboard({type:i.Jz.UP,key:68}),this.clink.keyboard({type:i.Jz.UP,key:91})}sendShortcutPrintScreen(){this.clink.keyboard({type:i.Jz.DOWN,key:44}),this.clink.keyboard({type:i.Jz.UP,key:44})}sendShortcutCtrlAltDel(){this.clink.keyboard({type:i.Jz.DOWN,key:17}),this.clink.keyboard({type:i.Jz.DOWN,key:18}),this.clink.keyboard({type:i.Jz.DOWN,key:46}),this.clink.keyboard({type:i.Jz.UP,key:46}),this.clink.keyboard({type:i.Jz.UP,key:18}),this.clink.keyboard({type:i.Jz.UP,key:17})}sendShortcutCtrlShiftEsc(){this.clink.keyboard({type:i.Jz.DOWN,key:17}),this.clink.keyboard({type:i.Jz.DOWN,key:16}),this.clink.keyboard({type:i.Jz.DOWN,key:27}),this.clink.keyboard({type:i.Jz.UP,key:27}),this.clink.keyboard({type:i.Jz.UP,key:16}),this.clink.keyboard({type:i.Jz.UP,key:17})}sendShortcutAltTab(){this.clink.keyboard({type:i.Jz.DOWN,key:18}),this.clink.keyboard({type:i.Jz.DOWN,key:9}),this.clink.keyboard({type:i.Jz.UP,key:9}),this.clink.keyboard({type:i.Jz.UP,key:18})}};y=m([(0,o.b2)(),g("design:paramtypes",["function"==typeof(r=void 0!==l.C&&l.C)?r:Object])],y)},20490:(e,t,n)=>{"use strict";n.d(t,{h:()=>d,q:()=>u});var r=n(14334),i=n(19816),o=n(78086),s=n(88694),a=n(48402),c=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};let d=class{constructor(){this.clink=a.nC.get(r.WY)}init(){}connecting(){}connected(){}connectFailed(){}agentConnected(){}exit(){}};d=c([(0,o.b)()],d);class u extends s.W{constructor(){super(...arguments),this.list=new Set}add(e){this.list.add(e),this.bind(e).toSelf().inSingletonScope()}init(){this.list.forEach((e=>{try{this.get(e).init()}catch(e){i.k.error(e.message)}}))}connecting(){this.list.forEach((e=>{try{this.get(e).connecting()}catch(e){i.k.error(e.message)}}))}connected(){this.list.forEach((e=>{try{this.get(e).connected()}catch(e){i.k.error(e.message)}}))}agentConnected(){this.list.forEach((e=>{try{this.get(e).agentConnected()}catch(e){i.k.error(e.message)}}))}connectFailed(){this.list.forEach((e=>{try{this.get(e).connectFailed()}catch(e){i.k.error(e.message)}}))}exit(){this.list.forEach((e=>{try{this.get(e).exit()}catch(e){i.k.error(e.message)}}))}}}}]);