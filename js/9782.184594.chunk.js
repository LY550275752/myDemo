(self.webpackChunkclink_web=self.webpackChunkclink_web||[]).push([[9782],{77140:t=>{t.exports="object"==typeof self?self.FormData:window.FormData},51882:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});var o=i(48402),r=i(44876);function n(){return o.nC.get(r.yG)}},44876:(t,e,i)=>{"use strict";i.d(e,{yG:()=>g});var o,r,n,a=i(48402),s=i(88538),d=i(52134),u=i(59927),l=i(19816),h=i(77140),p=i(6298),c=i(54478),f=i(47690),v=i.n(f),m=function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},b=function(t,e,i,o){return new(i||(i=Promise))((function(r,n){function a(t){try{d(o.next(t))}catch(t){n(t)}}function s(t){try{d(o.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}d((o=o.apply(t,e||[])).next())}))};let g=class{constructor(t,e,i){this.request=t,this.auth=e,this.database=i,this.ack="QDE5LXl1bmRpYW5uYW8=Q0xPVURfREVTS1RPUC0y",this.reportUser=null,this.table="reporter",this.reportPhones="reportPhones",this.reportEmails="reportEmails",this.reportContacts="reportContacts"}getAllReportUsers(){return b(this,void 0,void 0,(function*(){return yield this.database.find(this.table)}))}getAllReportPhones(){return b(this,void 0,void 0,(function*(){return yield this.database.find(this.reportPhones)}))}getAllReportEmails(){return b(this,void 0,void 0,(function*(){return yield this.database.find(this.reportEmails)}))}getAllReportContacts(){return b(this,void 0,void 0,(function*(){return yield this.database.find(this.reportContacts)}))}saveReportUser(t){return b(this,void 0,void 0,(function*(){if(!t||!t.username)return;l.k.info("save report user: ",t.username);const e=yield this.database.find(this.table);let i={[t.username]:t};e&&(i=Object.assign(e,i)),this.database.update(this.table,i)}))}saveReportContact(t){return b(this,void 0,void 0,(function*(){if(!t)return;l.k.info("save report contact: ",t);let e=yield this.database.find(this.reportContacts);e?e.includes(t)||e.push(t):e=[t],this.database.update(this.reportContacts,e)}))}saveReportPhone(t){return b(this,void 0,void 0,(function*(){if(!t)return;l.k.info("save report phone: ",t);let e=yield this.database.find(this.reportPhones);e?e.includes(t)||e.push(t):e=[t],this.database.update(this.reportPhones,e)}))}saveReportEmail(t){return b(this,void 0,void 0,(function*(){if(!t)return;l.k.info("save report email: ",t);let e=yield this.database.find(this.reportEmails);e?e.includes(t)||e.push(t):e=[t],this.database.update(this.reportEmails,e)}))}removeReportUser(t){return b(this,void 0,void 0,(function*(){l.k.info("remove report user: ",t);let e=yield this.database.find(this.table);e&&(delete e[t],this.database.update(this.table,e))}))}removeReportContact(t){return b(this,void 0,void 0,(function*(){l.k.info("remove report contact: ",t);let e=yield this.database.find(this.reportContacts);if(e){const i=e.indexOf(t);e.splice(i,1),this.database.update(this.reportContacts,e)}}))}removeReportPhone(t){return b(this,void 0,void 0,(function*(){l.k.info("remove report phone: ",t);let e=yield this.database.find(this.reportPhones);if(e){const i=e.indexOf(t);e.splice(i,1),this.database.update(this.reportPhones,e)}}))}removeReportEmail(t){return b(this,void 0,void 0,(function*(){l.k.info("remove report email: ",t);let e=yield this.database.find(this.reportEmails);if(e){const i=e.indexOf(t);e.splice(i,1),this.database.update(this.reportEmails,e)}}))}uploadReportImage(t){return b(this,void 0,void 0,(function*(){l.k.info("upload report image: ",t.files.path);let e=this.auth.getAuthProfile();const i=new h,o=Date.now();let r={appInfo:{appId:d.kJ,operStaff:d.eW,orgId:d.TY,sign:"",tenantId:(null==e?void 0:e.tenantId)||-2,timeStamp:o}};r.appInfo.sign=(0,d.gw)(o,d.eW,r.appInfo.tenantId);for(let t in r.appInfo)i.append(t,r.appInfo[t]);i.append("files",null,{filename:t.files.name,contentType:t.files.type});return yield this.request.api({url:"api/v2/client/uploadWsheetFile",method:"post",headers:i.getHeaders(),data:i})}))}submitReport(t){return b(this,void 0,void 0,(function*(){l.k.info("create worksheet",t);const e=yield this.request.api({url:"api/wsheet/client/createWorkSheet",method:"post",data:t});let i=t.wheetInfo.mobilePhone;const o=yield this.auth.getAuthProfile();return o&&(i=o.userAccount),e.data}))}setEvaluation(t){return b(this,void 0,void 0,(function*(){const t=yield this.auth.getAuthProfile();if(t){t.userAccount}}))}getEvaluation(t){return b(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}setUrge(t){return b(this,void 0,void 0,(function*(){const t=yield this.auth.getAuthProfile();if(t){t.userAccount}}))}getUrge(t){return b(this,void 0,void 0,(function*(){yield this.auth.getAuthProfile();return{}}))}uploadReportFeedback(t){return b(this,void 0,void 0,(function*(){const e=new h;e.append("files",t.files,t.files.name);return(yield this.request.api({method:"post",url:"api/wsheet/client/uploadFeedbackFile",headers:{"Content-Type":"multipart/form-data,multipart/*"},params:{wsheetId:t.wsheetId},data:e})).data}))}downloadFile(t){return b(this,void 0,void 0,(function*(){const e=(yield this.request.api({url:"api/v2/client/downloadWsheetFile",method:"get",params:t,responseType:"stream"})).data;return e.pipe(null),l.k.info(e),e}))}getDownloadItemInfo(t){return b(this,void 0,void 0,(function*(){}))}getHistoryReport(t){return b(this,void 0,void 0,(function*(){return yield this.request.api({url:"api/v2/client/qryWorkSheet",method:"post",data:t})}))}getFeedback(t){return b(this,void 0,void 0,(function*(){return(yield this.request.api({url:"api/wsheet/client/qryFeedbackMsg",method:"get",params:t})).data}))}replyReportFeedback(t){return b(this,void 0,void 0,(function*(){return(yield this.request.api({method:"post",url:"api/wsheet/client/replyWorkSheet",data:t})).data}))}getkey(){return window.atob(this.ack.slice(20)+this.ack.slice(0,20))}uploadLog(t,e){return b(this,void 0,void 0,(function*(){let i=l.k.getLogs();if(0!==i.length)try{let o=v()().format("YYYY-MM-DD-HH-mm-ss"),r=`web-${t}-${o}.log`,n=(0,c.JQ)(`${r}${t}${this.getkey()}`),a={url:"api/cdserv/client/clientlog/genReportUrl",method:"get",params:{fileName:r,account:t,checksum:n}};e&&(a.params.wsheetId=e);let s=new File(i,r),d=yield this.request.api(a);yield this.request.send({url:decodeURIComponent(d.data),method:"put",data:s,headers:{"Content-Type":"application/octet-stream"},maxContentLength:1/0}),l.k.cleanLogs()}catch(t){l.k.error(`日志上传失败:${t.message}`)}}))}};g=m([(0,a.Xn)(),y("design:paramtypes",["function"==typeof(o=void 0!==s.cf&&s.cf)?o:Object,"function"==typeof(r=void 0!==p.g&&p.g)?r:Object,"function"==typeof(n=void 0!==u.v&&u.v)?n:Object])],g)}}]);